var Pn=Object.defineProperty;var In=(i,e,t)=>e in i?Pn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Ot=(i,e,t)=>(In(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function D(){}function tt(i,e){for(const t in e)i[t]=e[t];return i}function nn(i){return i()}function ir(){return Object.create(null)}function We(i){i.forEach(nn)}function Oe(i){return typeof i=="function"}function N(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}function Rn(i){return Object.keys(i).length===0}function sn(i,...e){if(i==null){for(const r of e)r(void 0);return D}const t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ln(i,e,t){i.$$.on_destroy.push(sn(e,t))}function Te(i,e,t,r){if(i){const s=on(i,e,t,r);return i[0](s)}}function on(i,e,t,r){return i[1]&&r?tt(t.ctx.slice(),i[1](r(e))):t.ctx}function Ae(i,e,t,r){if(i[2]&&r){const s=i[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const n=[],o=Math.max(e.dirty.length,s.length);for(let a=0;a<o;a+=1)n[a]=e.dirty[a]|s[a];return n}return e.dirty|s}return e.dirty}function je(i,e,t,r,s,n){if(s){const o=on(e,t,r,n);i.p(o,s)}}function Pe(i){if(i.ctx.length>32){const e=[],t=i.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function b(i,e){i.appendChild(e)}function S(i,e,t){i.insertBefore(e,t||null)}function k(i){i.parentNode&&i.parentNode.removeChild(i)}function Ve(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function O(i){return document.createElement(i)}function be(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function R(i){return document.createTextNode(i)}function E(){return R(" ")}function se(){return R("")}function Ie(i,e,t,r){return i.addEventListener(e,t,r),()=>i.removeEventListener(e,t,r)}function Dn(i){return function(e){return e.preventDefault(),i.call(this,e)}}function C(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function Un(i){return Array.from(i.childNodes)}function U(i,e){e=""+e,i.data!==e&&(i.data=e)}function Je(i,e){i.value=e??""}function or(i,e,t){for(let r=0;r<i.options.length;r+=1){const s=i.options[r];if(s.__value===e){s.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function Nn(i){const e=i.querySelector(":checked");return e&&e.__value}function qn(i,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(i,{detail:e,bubbles:t,cancelable:r})}function pt(i,e){return new i(e)}let rt;function Ze(i){rt=i}function $t(){if(!rt)throw new Error("Function called outside component initialization");return rt}function de(i){$t().$$.on_mount.push(i)}function Bn(i){$t().$$.after_update.push(i)}function Fn(i){$t().$$.on_destroy.push(i)}function Mn(){const i=$t();return(e,t,{cancelable:r=!1}={})=>{const s=i.$$.callbacks[e];if(s){const n=qn(e,t,{cancelable:r});return s.slice().forEach(o=>{o.call(i,n)}),!n.defaultPrevented}return!0}}function ar(i,e){const t=i.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const Fe=[],Z=[];let ze=[];const Dt=[],an=Promise.resolve();let Ut=!1;function ln(){Ut||(Ut=!0,an.then(cn))}function un(){return ln(),an}function mt(i){ze.push(i)}function x(i){Dt.push(i)}const Tt=new Set;let De=0;function cn(){if(De!==0)return;const i=rt;do{try{for(;De<Fe.length;){const e=Fe[De];De++,Ze(e),zn(e.$$)}}catch(e){throw Fe.length=0,De=0,e}for(Ze(null),Fe.length=0,De=0;Z.length;)Z.pop()();for(let e=0;e<ze.length;e+=1){const t=ze[e];Tt.has(t)||(Tt.add(t),t())}ze.length=0}while(Fe.length);for(;Dt.length;)Dt.pop()();Ut=!1,Tt.clear(),Ze(i)}function zn(i){if(i.fragment!==null){i.update(),We(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(mt)}}function Hn(i){const e=[],t=[];ze.forEach(r=>i.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ze=e}const dt=new Set;let Ee;function Q(){Ee={r:0,c:[],p:Ee}}function Y(){Ee.r||We(Ee.c),Ee=Ee.p}function m(i,e){i&&i.i&&(dt.delete(i),i.i(e))}function _(i,e,t,r){if(i&&i.o){if(dt.has(i))return;dt.add(i),Ee.c.push(()=>{dt.delete(i),r&&(t&&i.d(1),r())}),i.o(e)}else r&&r()}function ce(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}function _t(i,e){const t={},r={},s={$$scope:1};let n=i.length;for(;n--;){const o=i[n],a=e[n];if(a){for(const l in o)l in a||(r[l]=1);for(const l in a)s[l]||(t[l]=a[l],s[l]=1);i[n]=a}else for(const l in o)s[l]=1}for(const o in r)o in t||(t[o]=void 0);return t}function gt(i){return typeof i=="object"&&i!==null?i:{}}function ee(i,e,t){const r=i.$$.props[e];r!==void 0&&(i.$$.bound[r]=t,t(i.$$.ctx[r]))}function y(i){i&&i.c()}function v(i,e,t){const{fragment:r,after_update:s}=i.$$;r&&r.m(e,t),mt(()=>{const n=i.$$.on_mount.map(nn).filter(Oe);i.$$.on_destroy?i.$$.on_destroy.push(...n):We(n),i.$$.on_mount=[]}),s.forEach(mt)}function w(i,e){const t=i.$$;t.fragment!==null&&(Hn(t.after_update),We(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Jn(i,e){i.$$.dirty[0]===-1&&(Fe.push(i),ln(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function q(i,e,t,r,s,n,o=null,a=[-1]){const l=rt;Ze(i);const c=i.$$={fragment:null,ctx:[],props:n,update:D,not_equal:s,bound:ir(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:ir(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let f=!1;if(c.ctx=t?t(i,e.props||{},(h,d,...u)=>{const p=u.length?u[0]:d;return c.ctx&&s(c.ctx[h],c.ctx[h]=p)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](p),f&&Jn(i,h)),d}):[],c.update(),f=!0,We(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const h=Un(e.target);c.fragment&&c.fragment.l(h),h.forEach(k)}else c.fragment&&c.fragment.c();e.intro&&m(i.$$.fragment),v(i,e.target,e.anchor),cn()}Ze(l)}class B{constructor(){Ot(this,"$$");Ot(this,"$$set")}$destroy(){w(this,1),this.$destroy=D}$on(e,t){if(!Oe(t))return D;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!Rn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Kn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Kn);const Ue=[];function fn(i,e){return{subscribe:Ht(i,e).subscribe}}function Ht(i,e=D){let t;const r=new Set;function s(a){if(N(i,a)&&(i=a,t)){const l=!Ue.length;for(const c of r)c[1](),Ue.push(c,i);if(l){for(let c=0;c<Ue.length;c+=2)Ue[c][0](Ue[c+1]);Ue.length=0}}}function n(a){s(a(i))}function o(a,l=D){const c=[a,l];return r.add(c),r.size===1&&(t=e(s,n)||D),a(i),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:s,update:n,subscribe:o}}function hn(i,e,t){const r=!Array.isArray(i),s=r?[i]:i;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const n=e.length<2;return fn(t,(o,a)=>{let l=!1;const c=[];let f=0,h=D;const d=()=>{if(f)return;h();const p=e(r?c[0]:c,o,a);n?o(p):h=Oe(p)?p:D},u=s.map((p,g)=>sn(p,$=>{c[g]=$,f&=~(1<<g),l&&d()},()=>{f|=1<<g}));return l=!0,d(),function(){We(u),h(),l=!1}})}function Gn(i,e){if(i instanceof RegExp)return{keys:!1,pattern:i};var t,r,s,n,o=[],a="",l=i.split("/");for(l[0]||l.shift();s=l.shift();)t=s[0],t==="*"?(o.push("wild"),a+="/(.*)"):t===":"?(r=s.indexOf("?",1),n=s.indexOf(".",1),o.push(s.substring(1,~r?r:~n?n:s.length)),a+=~r&&!~n?"(?:/([^/]+?))?":"/([^/]+?)",~n&&(a+=(~r?"?":"")+"\\"+s.substring(n))):a+="/"+s;return{keys:o,pattern:new RegExp("^"+a+"/?$","i")}}function Wn(i){let e,t,r;const s=[i[2]];var n=i[0];function o(a,l){let c={};for(let f=0;f<s.length;f+=1)c=tt(c,s[f]);return l!==void 0&&l&4&&(c=tt(c,_t(s,[gt(a[2])]))),{props:c}}return n&&(e=pt(n,o(i)),e.$on("routeEvent",i[7])),{c(){e&&y(e.$$.fragment),t=se()},m(a,l){e&&v(e,a,l),S(a,t,l),r=!0},p(a,l){if(l&1&&n!==(n=a[0])){if(e){Q();const c=e;_(c.$$.fragment,1,0,()=>{w(c,1)}),Y()}n?(e=pt(n,o(a,l)),e.$on("routeEvent",a[7]),y(e.$$.fragment),m(e.$$.fragment,1),v(e,t.parentNode,t)):e=null}else if(n){const c=l&4?_t(s,[gt(a[2])]):{};e.$set(c)}},i(a){r||(e&&m(e.$$.fragment,a),r=!0)},o(a){e&&_(e.$$.fragment,a),r=!1},d(a){a&&k(t),e&&w(e,a)}}}function Vn(i){let e,t,r;const s=[{params:i[1]},i[2]];var n=i[0];function o(a,l){let c={};for(let f=0;f<s.length;f+=1)c=tt(c,s[f]);return l!==void 0&&l&6&&(c=tt(c,_t(s,[l&2&&{params:a[1]},l&4&&gt(a[2])]))),{props:c}}return n&&(e=pt(n,o(i)),e.$on("routeEvent",i[6])),{c(){e&&y(e.$$.fragment),t=se()},m(a,l){e&&v(e,a,l),S(a,t,l),r=!0},p(a,l){if(l&1&&n!==(n=a[0])){if(e){Q();const c=e;_(c.$$.fragment,1,0,()=>{w(c,1)}),Y()}n?(e=pt(n,o(a,l)),e.$on("routeEvent",a[6]),y(e.$$.fragment),m(e.$$.fragment,1),v(e,t.parentNode,t)):e=null}else if(n){const c=l&6?_t(s,[l&2&&{params:a[1]},l&4&&gt(a[2])]):{};e.$set(c)}},i(a){r||(e&&m(e.$$.fragment,a),r=!0)},o(a){e&&_(e.$$.fragment,a),r=!1},d(a){a&&k(t),e&&w(e,a)}}}function Qn(i){let e,t,r,s;const n=[Vn,Wn],o=[];function a(l,c){return l[1]?0:1}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,c){o[e].m(l,c),S(l,r,c),s=!0},p(l,[c]){let f=e;e=a(l),e===f?o[e].p(l,c):(Q(),_(o[f],1,1,()=>{o[f]=null}),Y(),t=o[e],t?t.p(l,c):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&k(r),o[e].d(l)}}}function lr(){const i=window.location.href.indexOf("#/");let e=i>-1?window.location.href.substr(i+1):"/";const t=e.indexOf("?");let r="";return t>-1&&(r=e.substr(t+1),e=e.substr(0,t)),{location:e,querystring:r}}const Jt=fn(null,function(e){e(lr());const t=()=>{e(lr())};return window.addEventListener("hashchange",t,!1),function(){window.removeEventListener("hashchange",t,!1)}});hn(Jt,i=>i.location);hn(Jt,i=>i.querystring);const ur=Ht(void 0);async function J(i){if(!i||i.length<1||i.charAt(0)!="/"&&i.indexOf("#/")!==0)throw Error("Invalid parameter location");await un(),history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=(i.charAt(0)=="#"?"":"#")+i}function Yn(i){i?window.scrollTo(i.__svelte_spa_router_scrollX,i.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Xn(i,e,t){let{routes:r={}}=e,{prefix:s=""}=e,{restoreScrollState:n=!1}=e;class o{constructor(j,I){if(!I||typeof I!="function"&&(typeof I!="object"||I._sveltesparouter!==!0))throw Error("Invalid component object");if(!j||typeof j=="string"&&(j.length<1||j.charAt(0)!="/"&&j.charAt(0)!="*")||typeof j=="object"&&!(j instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:H,keys:K}=Gn(j);this.path=j,typeof I=="object"&&I._sveltesparouter===!0?(this.component=I.component,this.conditions=I.conditions||[],this.userData=I.userData,this.props=I.props||{}):(this.component=()=>Promise.resolve(I),this.conditions=[],this.props={}),this._pattern=H,this._keys=K}match(j){if(s){if(typeof s=="string")if(j.startsWith(s))j=j.substr(s.length)||"/";else return null;else if(s instanceof RegExp){const ae=j.match(s);if(ae&&ae[0])j=j.substr(ae[0].length)||"/";else return null}}const I=this._pattern.exec(j);if(I===null)return null;if(this._keys===!1)return I;const H={};let K=0;for(;K<this._keys.length;){try{H[this._keys[K]]=decodeURIComponent(I[K+1]||"")||null}catch{H[this._keys[K]]=null}K++}return H}async checkConditions(j){for(let I=0;I<this.conditions.length;I++)if(!await this.conditions[I](j))return!1;return!0}}const a=[];r instanceof Map?r.forEach((A,j)=>{a.push(new o(j,A))}):Object.keys(r).forEach(A=>{a.push(new o(A,r[A]))});let l=null,c=null,f={};const h=Mn();async function d(A,j){await un(),h(A,j)}let u=null,p=null;n&&(p=A=>{A.state&&(A.state.__svelte_spa_router_scrollY||A.state.__svelte_spa_router_scrollX)?u=A.state:u=null},window.addEventListener("popstate",p),Bn(()=>{Yn(u)}));let g=null,$=null;const T=Jt.subscribe(async A=>{g=A;let j=0;for(;j<a.length;){const I=a[j].match(A.location);if(!I){j++;continue}const H={route:a[j].path,location:A.location,querystring:A.querystring,userData:a[j].userData,params:I&&typeof I=="object"&&Object.keys(I).length?I:null};if(!await a[j].checkConditions(H)){t(0,l=null),$=null,d("conditionsFailed",H);return}d("routeLoading",Object.assign({},H));const K=a[j].component;if($!=K){K.loading?(t(0,l=K.loading),$=K,t(1,c=K.loadingParams),t(2,f={}),d("routeLoaded",Object.assign({},H,{component:l,name:l.name,params:c}))):(t(0,l=null),$=null);const ae=await K();if(A!=g)return;t(0,l=ae&&ae.default||ae),$=K}I&&typeof I=="object"&&Object.keys(I).length?t(1,c=I):t(1,c=null),t(2,f=a[j].props),d("routeLoaded",Object.assign({},H,{component:l,name:l.name,params:c})).then(()=>{ur.set(c)});return}t(0,l=null),$=null,ur.set(void 0)});Fn(()=>{T(),p&&window.removeEventListener("popstate",p)});function L(A){ar.call(this,i,A)}function P(A){ar.call(this,i,A)}return i.$$set=A=>{"routes"in A&&t(3,r=A.routes),"prefix"in A&&t(4,s=A.prefix),"restoreScrollState"in A&&t(5,n=A.restoreScrollState)},i.$$.update=()=>{i.$$.dirty&32&&(history.scrollRestoration=n?"manual":"auto")},[l,c,f,r,s,n,L,P]}class Zn extends B{constructor(e){super(),q(this,e,Xn,Qn,N,{routes:3,prefix:4,restoreScrollState:5})}}function xn(){const{subscribe:i,set:e,update:t}=Ht(null);return{subscribe:i,setDBError:r=>e({msg:r.message,details:r.details}),setAuthError:r=>{e({msg:r.message})},setString:r=>e({msg:r}),reset:()=>e(null)}}const W=xn(),es="modulepreload",ts=function(i,e){return new URL(i,e).href},cr={},Ke=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const n=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.all(t.map(l=>{if(l=ts(l,r),l in cr)return;cr[l]=!0;const c=l.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const p=n[u];if(p.href===l&&(!c||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":es,c||(d.as="script",d.crossOrigin=""),d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((u,p)=>{d.addEventListener("load",u),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}return s.then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})},rs=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ke(()=>Promise.resolve().then(()=>ot),void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Kt extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ns extends Kt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ss extends Kt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class is extends Kt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Nt;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(Nt||(Nt={}));var os=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};class as{constructor(e,{headers:t={},customFetch:r,region:s=Nt.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=rs(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return os(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const f=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(p=>{throw new ns(p)}),h=f.headers.get("x-relay-error");if(h&&h==="true")throw new ss(f);if(!f.ok)throw new is(f);let d=((r=f.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),u;return d==="application/json"?u=yield f.json():d==="application/octet-stream"?u=yield f.blob():d==="text/event-stream"?u=f:d==="multipart/form-data"?u=yield f.formData():u=yield f.text(),{data:u,error:null}}catch(s){return{data:null,error:s}}})}}var ls=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ge=ls();const us=Ge.fetch,Gt=Ge.fetch.bind(Ge),dn=Ge.Headers,cs=Ge.Request,fs=Ge.Response,ot=Object.freeze(Object.defineProperty({__proto__:null,Headers:dn,Request:cs,Response:fs,default:Gt,fetch:us},Symbol.toStringTag,{value:"Module"}));class hs extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class ds{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Gt:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,l;let c=null,f=null,h=null,d=n.status,u=n.statusText;if(n.ok){if(this.method!=="HEAD"){const T=await n.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?f=T:f=JSON.parse(T))}const g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),$=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&$&&$.length>1&&(h=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(c={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,d=406,u="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const g=await n.text();try{c=JSON.parse(g),Array.isArray(c)&&n.status===404&&(f=[],c=null,d=200,u="OK")}catch{n.status===404&&g===""?(d=204,u="No Content"):c={message:g}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,u="OK"),c&&this.shouldThrowOnError)throw new hs(c)}return{error:c,data:f,count:h,status:d,statusText:u}});return this.shouldThrowOnError||(s=s.catch(n=>{var o,a,l;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class ps extends ds{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Me extends ps{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class ms{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Me({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Me({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,f)=>c.concat(Object.keys(f)),[]);if(l.length>0){const c=[...new Set(l)].map(f=>`"${f}"`);this.url.searchParams.set("columns",c.join(","))}}return new Me({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Me({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Me({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const _s="1.15.2",gs={"X-Client-Info":`postgrest-js/${_s}`};class Wt{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},gs),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new ms(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Wt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{a.searchParams.append(f,h)})):(o="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new Me({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const $s="2.9.5",bs={"X-Client-Info":`realtime-js/${$s}`},vs="1.0.0",pn=1e4,ws=1e3;var He;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(He||(He={}));var le;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(le||(le={}));var he;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(he||(he={}));var qt;(function(i){i.websocket="websocket"})(qt||(qt={}));var Se;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(Se||(Se={}));class mn{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class ys{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const l=r.decode(e.slice(o,o+n));o=o+n;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class At{constructor(e,t,r={},s=pn){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var fr;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(fr||(fr={}));class xe{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xe.syncState(this.state,s,n,o),this.pendingDiffs.forEach(l=>{this.state=xe.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=xe.syncDiff(this.state,s,n,o),a())}),this.onJoin((s,n,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:o})}),this.onLeave((s,n,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(n,(c,f)=>{o[c]||(l[c]=f)}),this.map(o,(c,f)=>{const h=n[c];if(h){const d=f.map($=>$.presence_ref),u=h.map($=>$.presence_ref),p=f.filter($=>u.indexOf($.presence_ref)<0),g=h.filter($=>d.indexOf($.presence_ref)<0);p.length>0&&(a[c]=p),g.length>0&&(l[c]=g)}else a[c]=f}),this.syncDiff(n,{joins:a,leaves:l},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(a,l)=>{var c;const f=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),f.length>0){const h=e[a].map(u=>u.presence_ref),d=f.filter(u=>h.indexOf(u.presence_ref)<0);e[a].unshift(...d)}r(a,f,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const f=l.map(h=>h.presence_ref);c=c.filter(h=>f.indexOf(h.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var G;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(G||(G={}));const hr=(i,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,o)=>(n[o]=ks(o,i,e,s),n),{})},ks=(i,e,t,r)=>{const s=e.find(a=>a.name===i),n=s==null?void 0:s.type,o=t[i];return n&&!r.includes(n)?_n(n,o):Bt(o)},_n=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return Os(e,t)}switch(i){case G.bool:return Ss(e);case G.float4:case G.float8:case G.int2:case G.int4:case G.int8:case G.numeric:case G.oid:return Es(e);case G.json:case G.jsonb:return Cs(e);case G.timestamp:return Ts(e);case G.abstime:case G.date:case G.daterange:case G.int4range:case G.int8range:case G.money:case G.reltime:case G.text:case G.time:case G.timestamptz:case G.timetz:case G.tsrange:case G.tstzrange:return Bt(e);default:return Bt(e)}},Bt=i=>i,Ss=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Es=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Cs=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},Os=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let n;const o=i.slice(1,t);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>_n(e,a))}return i},Ts=i=>typeof i=="string"?i.replace(" ","T"):i;var dr;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(dr||(dr={}));var pr;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes"})(pr||(pr={}));var mr;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(mr||(mr={}));class Vt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=le.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new At(this,he.join,this.params,this.timeout),this.rejoinTimer=new mn(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=le.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=le.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this._on(he.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new xe(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const a={},l={broadcast:n,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var f;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,d=(f=h==null?void 0:h.length)!==null&&f!==void 0?f:0,u=[];for(let p=0;p<d;p++){const g=h[p],{filter:{event:$,schema:T,table:L,filter:P}}=g,A=c&&c[p];if(A&&A.event===$&&A.schema===T&&A.table===L&&A.filter===P)u.push(Object.assign(Object.assign({},g),{id:A.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=u,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:o}=e,a={method:"POST",headers:{apikey:(r=this.socket.apiKey)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=t.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("error",()=>n("error")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=le.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(he.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new At(this,he.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new At(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:f}=he;if(r&&[a,l,c,f].indexOf(o)>=0&&r!==this._joinRef())return;let d=this._onMessage(o,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(u=>{var p,g,$;return((p=u.filter)===null||p===void 0?void 0:p.event)==="*"||(($=(g=u.filter)===null||g===void 0?void 0:g.event)===null||$===void 0?void 0:$.toLocaleLowerCase())===o}).map(u=>u.callback(d,r)):(n=this.bindings[o])===null||n===void 0||n.filter(u=>{var p,g,$,T,L,P;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in u){const A=u.id,j=(p=u.filter)===null||p===void 0?void 0:p.event;return A&&((g=t.ids)===null||g===void 0?void 0:g.includes(A))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===(($=t.data)===null||$===void 0?void 0:$.type.toLocaleLowerCase()))}else{const A=(L=(T=u==null?void 0:u.filter)===null||T===void 0?void 0:T.event)===null||L===void 0?void 0:L.toLocaleLowerCase();return A==="*"||A===((P=t==null?void 0:t.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return u.type.toLocaleLowerCase()===o}).map(u=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:g,table:$,commit_timestamp:T,type:L,errors:P}=p;d=Object.assign(Object.assign({},{schema:g,table:$,commit_timestamp:T,eventType:L,new:{},old:{},errors:P}),this._getPayloadRecords(p))}u.callback(d,r)})}_isClosed(){return this.state===le.closed}_isJoined(){return this.state===le.joined}_isJoining(){return this.state===le.joining}_isLeaving(){return this.state===le.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&Vt.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(he.close,{},e)}_onError(e){this._on(he.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=le.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=hr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=hr(e.columns,e.old_record)),t}}const As=()=>{},js=typeof WebSocket<"u";class Ps{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=bs,this.params={},this.timeout=pn,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=As,this.conn=null,this.sendBuffer=[],this.serializer=new ys,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>Ke(()=>Promise.resolve().then(()=>ot),void 0,import.meta.url).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${qt.websocket}`,t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,o)=>o(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new mn(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(js){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Is(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),Ke(()=>import("./browser-BImCA5dO.js").then(e=>e.b),[],import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case He.connecting:return Se.Connecting;case He.open:return Se.Open;case He.closing:return Se.Closing;default:return Se.Closed}}isConnected(){return this.connectionState()===Se.Open}channel(e,t={config:{}}){const r=new Vt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:n}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(he.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:vs}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:n,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===(n==null?void 0:n.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(he.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(ws,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Is{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=He.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Qt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function te(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Rs extends Qt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class _r extends Qt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ls=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};const gn=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ke(()=>Promise.resolve().then(()=>ot),void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ds=()=>Ls(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ke(()=>Promise.resolve().then(()=>ot),void 0,import.meta.url)).Response:Response});var Qe=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};const jt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Us=(i,e)=>Qe(void 0,void 0,void 0,function*(){const t=yield Ds();i instanceof t?i.json().then(r=>{e(new Rs(jt(r),i.status||500))}).catch(r=>{e(new _r(jt(r),r))}):e(new _r(jt(i),i))}),Ns=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function bt(i,e,t,r,s,n){return Qe(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(t,Ns(e,r,s,n)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Us(l,a))})})}function Ft(i,e,t,r){return Qe(this,void 0,void 0,function*(){return bt(i,"GET",e,t,r)})}function ge(i,e,t,r,s){return Qe(this,void 0,void 0,function*(){return bt(i,"POST",e,r,s,t)})}function qs(i,e,t,r,s){return Qe(this,void 0,void 0,function*(){return bt(i,"PUT",e,r,s,t)})}function $n(i,e,t,r,s){return Qe(this,void 0,void 0,function*(){return bt(i,"DELETE",e,r,s,t)})}var ue=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};const Bs={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},gr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Fs{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=gn(s)}uploadOrUpdate(e,t,r,s){return ue(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},gr),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl)):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),f=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),h=yield f.json();return f.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(n){if(te(n))return{data:null,error:n};throw n}})}upload(e,t,r){return ue(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return ue(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:gr.upsert},s),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,f["cache-control"]=`max-age=${c.cacheControl}`,f["content-type"]=c.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:f}),d=yield h.json();return h.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(te(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return ue(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield ge(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),n=s.searchParams.get("token");if(!n)throw new Qt("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:n},error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}update(e,t,r){return ue(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return ue(this,void 0,void 0,function*(){try{return{data:yield ge(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}})}copy(e,t){return ue(this,void 0,void 0,function*(){try{return{data:{path:(yield ge(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return ue(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield ge(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(s){if(te(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return ue(this,void 0,void 0,function*(){try{const s=yield ge(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(s){if(te(s))return{data:null,error:s};throw s}})}download(e,t){return ue(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Ft(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(te(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&s.push(n);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return ue(this,void 0,void 0,function*(){try{return{data:yield $n(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}list(e,t,r){return ue(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Bs),t),{prefix:e||""});return{data:yield ge(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(te(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ms="2.5.5",zs={"X-Client-Info":`storage-js/${Ms}`};var Ne=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};class Hs{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},zs),t),this.fetch=gn(r)}listBuckets(){return Ne(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}})}getBucket(e){return Ne(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ne(this,void 0,void 0,function*(){try{return{data:yield ge(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Ne(this,void 0,void 0,function*(){try{return{data:yield qs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ne(this,void 0,void 0,function*(){try{return{data:yield ge(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ne(this,void 0,void 0,function*(){try{return{data:yield $n(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}})}}class Js extends Hs{constructor(e,t={},r){super(e,t,r)}from(e){return new Fs(this.url,this.headers,e,this.fetch)}}const Ks="2.43.4";let Xe="";typeof Deno<"u"?Xe="deno":typeof document<"u"?Xe="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Xe="react-native":Xe="node";const Gs={"X-Client-Info":`supabase-js-${Xe}/${Ks}`},Ws={headers:Gs},Vs={schema:"public"},Qs={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ys={};var Xs=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};const Zs=i=>{let e;return i?e=i:typeof fetch>"u"?e=Gt:e=fetch,(...t)=>e(...t)},xs=()=>typeof Headers>"u"?dn:Headers,ei=(i,e,t)=>{const r=Zs(t),s=xs();return(n,o)=>Xs(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:i;let c=new s(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},o),{headers:c}))})};function ti(i){return i.replace(/\/$/,"")}function ri(i,e){const{db:t,auth:r,realtime:s,global:n}=i,{db:o,auth:a,realtime:l,global:c}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},c),n)}}const bn="2.64.2",ni="http://localhost:9999",si="supabase.auth.token",ii={"X-Client-Info":`gotrue-js/${bn}`},$r=10,Mt="X-Supabase-Api-Version",vn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function oi(i){return Math.round(Date.now()/1e3)+i}function ai(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const fe=()=>typeof document<"u",we={tested:!1,writable:!1},et=()=>{if(!fe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(we.tested)return we.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),we.tested=!0,we.writable=!0}catch{we.tested=!0,we.writable=!1}return we.writable};function Pt(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,n)=>{e[n]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const wn=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ke(()=>Promise.resolve().then(()=>ot),void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},li=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",yn=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},ct=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},It=async(i,e)=>{await i.removeItem(e)};function ui(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,n,o,a,l,c,f=0;for(i=i.replace("-","+").replace("_","/");f<i.length;)o=e.indexOf(i.charAt(f++)),a=e.indexOf(i.charAt(f++)),l=e.indexOf(i.charAt(f++)),c=e.indexOf(i.charAt(f++)),r=o<<2|a>>4,s=(a&15)<<4|l>>2,n=(l&3)<<6|c,t=t+String.fromCharCode(r),l!=64&&s!=0&&(t=t+String.fromCharCode(s)),c!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class vt{constructor(){this.promise=new vt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}vt.promiseConstructor=Promise;function br(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(ui(r))}async function ci(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function fi(i,e){return new Promise((r,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await i(n);if(!e(n,null,o)){r(o);return}}catch(o){if(!e(n,o)){s(o);return}}})()})}function hi(i){return("0"+i.toString(16)).substr(-2)}function di(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let n=0;n<56;n++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,hi).join("")}async function pi(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}function mi(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function _i(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await pi(i);return mi(t)}async function qe(i,e,t=!1){const r=di();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await yn(i,`${e}-code-verifier`,s);const n=await _i(r);return[n,r===n?"plain":"s256"]}const gi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $i(i){const e=i.headers.get(Mt);if(!e||!e.match(gi))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Yt extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function F(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class bi extends Yt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function vi(i){return F(i)&&i.name==="AuthApiError"}class kn extends Yt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Re extends Yt{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class ye extends Re{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Rt extends Re{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ft extends Re{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ht extends Re{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class vr extends Re{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zt extends Re{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Lt(i){return F(i)&&i.name==="AuthRetryableFetchError"}class wr extends Re{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var wi=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};const ke=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),yi=[502,503,504];async function yr(i){var e;if(!li(i))throw new zt(ke(i),0);if(yi.includes(i.status))throw new zt(ke(i),i.status);let t;try{t=await i.json()}catch(n){throw new kn(ke(n),n)}let r;const s=$i(i);if(s&&s.getTime()>=vn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new wr(ke(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new wr(ke(t),i.status,t.weak_password.reasons);throw new bi(ke(t),i.status||500,r)}const ki=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function M(i,e,t,r){var s;const n=Object.assign({},r==null?void 0:r.headers);n[Mt]||(n[Mt]=vn["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Si(i,e,t+a,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Si(i,e,t,r,s,n){const o=ki(e,r,s,n);let a;try{a=await i(t,Object.assign({},o))}catch(l){throw console.error(l),new zt(ke(l),0)}if(a.ok||await yr(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await yr(l)}}function _e(i){var e;let t=null;Ti(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=oi(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function kr(i){const e=_e(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function $e(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Ei(i){return{data:i,error:null}}function Ci(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n}=i,o=wi(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Oi(i){return i}function Ti(i){return i.access_token&&i.refresh_token&&i.expires_in}var Ai=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};class ji{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=wn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await M(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await M(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:$e})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ai(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await M(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Ci,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(F(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await M(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$e})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},f=await M(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:Oi});if(f.error)throw f.error;const h=await f.json(),d=(o=f.headers.get("x-total-count"))!==null&&o!==void 0?o:0,u=(l=(a=f.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return u.length>0&&(u.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),$=JSON.parse(p.split(";")[1].split("=")[1]);c[`${$}Page`]=g}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(F(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await M(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$e})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await M(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:$e})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await M(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:$e})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await M(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(F(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await M(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}}}const Pi={getItem:i=>et()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{et()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{et()&&globalThis.localStorage.removeItem(i)}};function Sr(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function Ii(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Be={debug:!!(globalThis&&et()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Sn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ri extends Sn{}async function Li(i,e,t){Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Be.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Ri(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Be.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Ii();const Di={url:ni,storageKey:si,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ii,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Ye=30*1e3,Er=3;async function Cr(i,e,t){return await t()}class nt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=nt.nextInstanceID,nt.nextInstanceID+=1,this.instanceID>0&&fe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Di),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new ji({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=wn(s.fetch),this.lock=s.lock||Cr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:fe()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Li:this.lock=Cr,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:et()?this.storage=Pi:(this.memoryStorage={},this.storage=Sr(this.memoryStorage)):(this.memoryStorage={},this.storage=Sr(this.memoryStorage)),fe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${bn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=fe()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),(r==null?void 0:r.message)==="Identity is already linked"||(r==null?void 0:r.message)==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return F(e)?{error:e}:{error:new kn("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{await this._removeSession();const n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:_e}),{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{await this._removeSession();let n;if("email"in e){const{email:f,password:h,options:d}=e;let u=null,p=null;this.flowType==="pkce"&&([u,p]=await qe(this.storage,this.storageKey)),n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:f,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:u,code_challenge_method:p},xform:_e})}else if("phone"in e){const{phone:f,password:h,options:d}=e;n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:f,password:h,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:_e})}else throw new ft("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:n,password:o,options:a}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:kr})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:kr})}else throw new ft("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Rt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await ct(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/"),{data:n,error:o}=await M(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:_e});return await It(this.storage,`${this.storageKey}-code-verifier`),o?{data:{user:null,session:null,redirectType:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Rt}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:o})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:n,nonce:o}=e,a=await M(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:_e}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Rt}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,o;try{if(await this._removeSession(),"email"in e){const{email:a,options:l}=e;let c=null,f=null;this.flowType==="pkce"&&([c,f]=await qe(this.storage,this.storageKey));const{error:h}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:f},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:f}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:f}}throw new ft("You must provide either an email or phone number.")}catch(a){if(F(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,n;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await M(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:_e});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(F(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{await this._removeSession();let n=null,o=null;return this.flowType==="pkce"&&([n,o]=await qe(this.storage,this.storageKey)),await M(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:Ei})}catch(n){if(F(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ye;const{error:s}=await M(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(F(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:o}=await M(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:n}=e,{data:o,error:a}=await M(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new ft("You must provide either an email or phone number and a type")}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ct(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){const o=this.suppressGetSessionWarning;e=new Proxy(e,{get(l,c,f){return!o&&c==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(l,c,f)}})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$e}):await this._useSession(async t=>{var r,s,n;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ye}:await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0,xform:$e})})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new ye;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await qe(this.storage,this.storageKey));const{data:c,error:f}=await M(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:$e});if(f)throw f;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return br(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ye;const t=Date.now()/1e3;let r=t,s=!0,n=null;const o=br(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(F(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new ye;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!fe())throw new ht("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new ht("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new vr("Not a valid PKCE flow url.");const t=Pt(window.location.href);if(e){if(!t.code)throw new vr("No code detected.");const{data:L,error:P}=await this._exchangeCodeForSession(t.code);if(P)throw P;const A=new URL(window.location.href);return A.searchParams.delete("code"),window.history.replaceState(window.history.state,"",A.toString()),{data:{session:L.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new ht(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!n||!a||!o||!c)throw new ht("No session defined in URL");const f=Math.round(Date.now()/1e3),h=parseInt(a);let d=f+h;l&&(d=parseInt(l));const u=d-f;u*1e3<=Ye&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${u}s, should have been closer to ${h}s`);const p=d-h;f-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,f):f-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,d,f);const{data:g,error:$}=await this._getUser(n);if($)throw $;const T={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:d,refresh_token:o,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:T,redirectType:t.type},error:null}}catch(t){if(F(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Pt(window.location.href);return!!(fe()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Pt(window.location.href),t=await ct(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(vi(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await It(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=ai(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:n},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await qe(this.storage,this.storageKey,!0));try{return await M(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(F(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async n=>{var o,a,l,c,f;const{data:h,error:d}=n;if(d)throw d;const u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await M(this.fetch,"GET",u,{headers:this.headers,jwt:(f=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&f!==void 0?f:void 0})});if(s)throw s;return fe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(F(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:o}=t;if(o)throw o;return await M(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(F(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await fi(async s=>(s>0&&await ci(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await M(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_e})),(s,n)=>{const o=200*Math.pow(2,s);return n&&Lt(n)&&Date.now()+o-r<Ye})}catch(r){if(this._debug(t,"error",r),F(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),fe()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await ct(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+$r;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${$r}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Lt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ye;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new vt;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new ye;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(s,"error",n),F(n)){const o={session:null,error:n};return Lt(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await yn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await It(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&fe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ye);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ye);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ye}ms, refresh threshold is ${Er} ticks`),s<=Er&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Sn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,o]=await qe(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);s.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await M(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(F(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:l}=await M(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(!((s=a==null?void 0:a.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(F(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(F(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(F(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const f=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:f},error:null}}))}}nt.nextInstanceID=0;const Ui=nt;class Ni extends Ui{constructor(e){super(e)}}var qi=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{c(r.next(f))}catch(h){o(h)}}function l(f){try{c(r.throw(f))}catch(h){o(h)}}function c(f){f.done?n(f.value):s(f.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};class Bi{constructor(e,t,r){var s,n,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=ti(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:Vs,realtime:Ys,auth:Object.assign(Object.assign({},Qs),{storageKey:l}),global:Ws},f=ri(r??{},c);this.storageKey=(s=f.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=f.global.headers)!==null&&n!==void 0?n:{},this.auth=this._initSupabaseAuthClient((o=f.auth)!==null&&o!==void 0?o:{},this.headers,f.global.fetch),this.fetch=ei(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new Wt(`${a}/rest/v1`,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new as(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Js(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return qi(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:o,debug:a},l,c){var f;const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ni({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,debug:a,fetch:c,hasCustomAuthorizationHeader:(f="Authorization"in this.headers)!==null&&f!==void 0?f:!1})}_initRealtimeClient(e){return new Ps(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const En=(i,e,t)=>new Bi(i,e,t),Cn="supabase-config",Fi=()=>{const i=localStorage.getItem(Cn);if(!i)return null;const e=JSON.parse(i);return En(e.supabaseUrl,e.supabaseKey)};let V=Fi();const Mi=i=>{V=En(i.supabaseUrl,i.supabaseKey),localStorage.setItem(Cn,JSON.stringify(i))};function Or(i,e,t){const r=i.slice();return r[3]=e[t],r}function Tr(i){let e,t=i[3].label+"",r,s;return{c(){e=O("a"),r=R(t),C(e,"href",s=i[3].path),C(e,"class","underline")},m(n,o){S(n,e,o),b(e,r)},p(n,o){o&4&&t!==(t=n[3].label+"")&&U(r,t),o&4&&s!==(s=n[3].path)&&C(e,"href",s)},d(n){n&&k(e)}}}function zi(i){let e,t,r,s=i[0].email+"",n,o,a,l,c,f=ce(i[2]),h=[];for(let d=0;d<f.length;d+=1)h[d]=Tr(Or(i,f,d));return{c(){e=O("nav");for(let d=0;d<h.length;d+=1)h[d].c();t=E(),r=O("div"),n=R(s),o=E(),a=O("a"),a.textContent="Logout",C(a,"href","#/"),C(a,"class","underline"),C(e,"class","flex justify-end items-center gap-2 mb-4")},m(d,u){S(d,e,u);for(let p=0;p<h.length;p+=1)h[p]&&h[p].m(e,null);b(e,t),b(e,r),b(r,n),b(e,o),b(e,a),l||(c=Ie(a,"click",function(){Oe(i[1])&&i[1].apply(this,arguments)}),l=!0)},p(d,[u]){if(i=d,u&4){f=ce(i[2]);let p;for(p=0;p<f.length;p+=1){const g=Or(i,f,p);h[p]?h[p].p(g,u):(h[p]=Tr(g),h[p].c(),h[p].m(e,t))}for(;p<h.length;p+=1)h[p].d(1);h.length=f.length}u&1&&s!==(s=i[0].email+"")&&U(n,s)},i:D,o:D,d(d){d&&k(e),Ve(h,d),l=!1,c()}}}function Hi(i,e,t){let{user:r}=e,{onLogout:s}=e,{navEntries:n=[]}=e;return i.$$set=o=>{"user"in o&&t(0,r=o.user),"onLogout"in o&&t(1,s=o.onLogout),"navEntries"in o&&t(2,n=o.navEntries)},[r,s,n]}class Ji extends B{constructor(e){super(),q(this,e,Hi,zi,N,{user:0,onLogout:1,navEntries:2})}}const re=i=>new Date(i).toLocaleString(),ne=i=>i?"":"Please enter a value!",Ki=(i,e)=>Math.floor(Math.random()*(e-i+1)+i),Gi=i=>{for(let e=0;e<i.length;e++){const t=Ki(0,i.length-1);if(e===t)continue;const r=i[e];i[e]=i[t],i[t]=r}};function Wi(i){let e,t,r,s;return{c(){e=O("button"),t=R(i[0]),C(e,"class","btn"),e.disabled=i[2],C(e,"type","button")},m(n,o){S(n,e,o),b(e,t),r||(s=Ie(e,"click",function(){Oe(i[1])&&i[1].apply(this,arguments)}),r=!0)},p(n,o){i=n,o&1&&U(t,i[0]),o&4&&(e.disabled=i[2])},d(n){n&&k(e),r=!1,s()}}}function Vi(i){let e,t;return{c(){e=O("button"),t=R(i[0]),C(e,"class","btn"),e.disabled=i[2],C(e,"type","submit")},m(r,s){S(r,e,s),b(e,t)},p(r,s){s&1&&U(t,r[0]),s&4&&(e.disabled=r[2])},d(r){r&&k(e)}}}function Qi(i){let e;function t(n,o){return n[1]==null?Vi:Wi}let r=t(i),s=r(i);return{c(){s.c(),e=se()},m(n,o){s.m(n,o),S(n,e,o)},p(n,[o]){r===(r=t(n))&&s?s.p(n,o):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},i:D,o:D,d(n){n&&k(e),s.d(n)}}}function Yi(i,e,t){let{label:r}=e,{onClick:s=null}=e,{disabled:n=!1}=e;return i.$$set=o=>{"label"in o&&t(0,r=o.label),"onClick"in o&&t(1,s=o.onClick),"disabled"in o&&t(2,n=o.disabled)},[r,s,n]}class z extends B{constructor(e){super(),q(this,e,Yi,Qi,N,{label:0,onClick:1,disabled:2})}}function Xi(i){let e,t;const r=i[1].default,s=Te(r,i,i[0],null);return{c(){e=O("div"),s&&s.c(),C(e,"class","flex gap-4")},m(n,o){S(n,e,o),s&&s.m(e,null),t=!0},p(n,[o]){s&&s.p&&(!t||o&1)&&je(s,r,n,n[0],t?Ae(r,n[0],o,null):Pe(n[0]),null)},i(n){t||(m(s,n),t=!0)},o(n){_(s,n),t=!1},d(n){n&&k(e),s&&s.d(n)}}}function Zi(i,e,t){let{$$slots:r={},$$scope:s}=e;return i.$$set=n=>{"$$scope"in n&&t(0,s=n.$$scope)},[s,r]}class X extends B{constructor(e){super(),q(this,e,Zi,Xi,N,{})}}function xi(i){let e,t,r,s;const n=i[2].default,o=Te(n,i,i[1],null);return{c(){e=O("form"),o&&o.c(),C(e,"class","flex flex-col gap-5")},m(a,l){S(a,e,l),o&&o.m(e,null),t=!0,r||(s=Ie(e,"submit",Dn(function(){Oe(i[0])&&i[0].apply(this,arguments)})),r=!0)},p(a,[l]){i=a,o&&o.p&&(!t||l&2)&&je(o,n,i,i[1],t?Ae(n,i[1],l,null):Pe(i[1]),null)},i(a){t||(m(o,a),t=!0)},o(a){_(o,a),t=!1},d(a){a&&k(e),o&&o.d(a),r=!1,s()}}}function eo(i,e,t){let{$$slots:r={},$$scope:s}=e,{onSubmit:n}=e;return i.$$set=o=>{"onSubmit"in o&&t(0,n=o.onSubmit),"$$scope"in o&&t(1,s=o.$$scope)},[n,s,r]}class pe extends B{constructor(e){super(),q(this,e,eo,xi,N,{onSubmit:0})}}function Ar(i){let e,t;return{c(){e=O("p"),t=R(i[2]),C(e,"class","text-red-600 text-sm mt-1")},m(r,s){S(r,e,s),b(e,t)},p(r,s){s&4&&U(t,r[2])},d(r){r&&k(e)}}}function to(i){let e,t,r,s,n,o;const a=i[4].default,l=Te(a,i,i[3],null);let c=i[2]&&Ar(i);return{c(){e=O("div"),t=O("label"),r=R(i[1]),s=E(),l&&l.c(),n=E(),c&&c.c(),C(t,"class","block text-gray-700 text-sm font-bold mb-2"),C(t,"for",i[0])},m(f,h){S(f,e,h),b(e,t),b(t,r),b(e,s),l&&l.m(e,null),b(e,n),c&&c.m(e,null),o=!0},p(f,[h]){(!o||h&2)&&U(r,f[1]),(!o||h&1)&&C(t,"for",f[0]),l&&l.p&&(!o||h&8)&&je(l,a,f,f[3],o?Ae(a,f[3],h,null):Pe(f[3]),null),f[2]?c?c.p(f,h):(c=Ar(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(f){o||(m(l,f),o=!0)},o(f){_(l,f),o=!1},d(f){f&&k(e),l&&l.d(f),c&&c.d()}}}function ro(i,e,t){let{$$slots:r={},$$scope:s}=e,{id:n}=e,{label:o}=e,{error:a}=e;return i.$$set=l=>{"id"in l&&t(0,n=l.id),"label"in l&&t(1,o=l.label),"error"in l&&t(2,a=l.error),"$$scope"in l&&t(3,s=l.$$scope)},[n,o,a,s,r]}class Xt extends B{constructor(e){super(),q(this,e,ro,to,N,{id:0,label:1,error:2})}}function no(i){let e,t,r;return{c(){e=O("input"),C(e,"class","input"),C(e,"id",i[2])},m(s,n){S(s,e,n),Je(e,i[0]),t||(r=Ie(e,"input",i[4]),t=!0)},p(s,n){n&4&&C(e,"id",s[2]),n&1&&e.value!==s[0]&&Je(e,s[0])},d(s){s&&k(e),t=!1,r()}}}function so(i){let e,t;return e=new Xt({props:{id:i[2],label:i[1],error:i[3],$$slots:{default:[no]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&4&&(n.id=r[2]),s&2&&(n.label=r[1]),s&8&&(n.error=r[3]),s&37&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function io(i,e,t){let{label:r}=e,{id:s}=e,{value:n}=e,{error:o}=e;function a(){n=this.value,t(0,n)}return i.$$set=l=>{"label"in l&&t(1,r=l.label),"id"in l&&t(2,s=l.id),"value"in l&&t(0,n=l.value),"error"in l&&t(3,o=l.error)},[n,r,s,o,a]}class Ce extends B{constructor(e){super(),q(this,e,io,so,N,{label:1,id:2,value:0,error:3})}}function oo(i){let e,t;return e=new z({props:{label:"Save"}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p:D,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ao(i){let e,t,r,s,n,o,a,l;function c(u){i[6](u)}let f={id:"url",label:"Supabase URL",error:i[1]};i[0]!==void 0&&(f.value=i[0]),e=new Ce({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[7](u)}let d={id:"key",label:"Supabase key",error:i[3]};return i[2]!==void 0&&(d.value=i[2]),s=new Ce({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[oo]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&2&&(g.error=u[1]),!t&&p&1&&(t=!0,g.value=u[0],x(()=>t=!1)),e.$set(g);const $={};p&8&&($.error=u[3]),!n&&p&4&&(n=!0,$.value=u[2],x(()=>n=!1)),s.$set($);const T={};p&256&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function lo(i){let e,t;return e=new pe({props:{onSubmit:i[4],$$slots:{default:[ao]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&271&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function uo(i,e,t){let{onConfig:r}=e,s="",n="",o="",a="";const l=()=>{t(1,n=ne(s)),t(3,a=ne(o)),!(n||a)&&r({supabaseUrl:s,supabaseKey:o})};function c(h){s=h,t(0,s)}function f(h){o=h,t(2,o)}return i.$$set=h=>{"onConfig"in h&&t(5,r=h.onConfig)},[s,n,o,a,l,r,c,f]}class co extends B{constructor(e){super(),q(this,e,uo,lo,N,{onConfig:5})}}function fo(i){let e,t;return e=new pe({props:{onSubmit:i[4],$$slots:{default:[mo]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,s){const n={};s&71&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ho(i){let e,t,r;return{c(){e=O("div"),e.textContent="Magic link was successfully send!",t=E(),r=O("div"),r.textContent="Please check your E-Mail"},m(s,n){S(s,e,n),S(s,t,n),S(s,r,n)},p:D,i:D,o:D,d(s){s&&(k(e),k(t),k(r))}}}function po(i){let e,t;return e=new z({props:{disabled:i[2],label:"Magic Link"}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,s){const n={};s&4&&(n.disabled=r[2]),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function mo(i){let e,t,r,s,n;function o(l){i[5](l)}let a={id:"email",label:"E-Mail",error:i[1]};return i[0]!==void 0&&(a.value=i[0]),e=new Ce({props:a}),Z.push(()=>ee(e,"value",o)),s=new X({props:{$$slots:{default:[po]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment)},m(l,c){v(e,l,c),S(l,r,c),v(s,l,c),n=!0},p(l,c){const f={};c&2&&(f.error=l[1]),!t&&c&1&&(t=!0,f.value=l[0],x(()=>t=!1)),e.$set(f);const h={};c&68&&(h.$$scope={dirty:c,ctx:l}),s.$set(h)},i(l){n||(m(e.$$.fragment,l),m(s.$$.fragment,l),n=!0)},o(l){_(e.$$.fragment,l),_(s.$$.fragment,l),n=!1},d(l){l&&k(r),w(e,l),w(s,l)}}}function _o(i){let e,t,r,s;const n=[ho,fo],o=[];function a(l,c){return l[3]?0:1}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,c){o[e].m(l,c),S(l,r,c),s=!0},p(l,[c]){let f=e;e=a(l),e===f?o[e].p(l,c):(Q(),_(o[f],1,1,()=>{o[f]=null}),Y(),t=o[e],t?t.p(l,c):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&k(r),o[e].d(l)}}}function go(i,e,t){let r="",s="",n=!1,o=!1;const a=async()=>{if(t(1,s=ne(r)),s)return;t(2,n=!0);const{data:c,error:f}=await V.auth.signInWithOtp({email:r});if(t(2,n=!1),f){W.setAuthError(f);return}c&&(console.log("data",c),t(3,o=!0))};function l(c){r=c,t(0,r)}return[r,s,n,o,a,l]}class $o extends B{constructor(e){super(),q(this,e,go,_o,N,{})}}function bo(i){let e,t,r;e=new Ji({props:{navEntries:i[0],user:i[1],onLogout:i[5]}});const s=i[7].default,n=Te(s,i,i[6],null);return{c(){y(e.$$.fragment),t=E(),n&&n.c()},m(o,a){v(e,o,a),S(o,t,a),n&&n.m(o,a),r=!0},p(o,a){const l={};a&1&&(l.navEntries=o[0]),a&2&&(l.user=o[1]),e.$set(l),n&&n.p&&(!r||a&64)&&je(n,s,o,o[6],r?Ae(s,o[6],a,null):Pe(o[6]),null)},i(o){r||(m(e.$$.fragment,o),m(n,o),r=!0)},o(o){_(e.$$.fragment,o),_(n,o),r=!1},d(o){o&&k(t),w(e,o),n&&n.d(o)}}}function vo(i){let e,t,r,s;const n=[ko,yo],o=[];function a(l,c){return l[3]?0:1}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,c){o[e].m(l,c),S(l,r,c),s=!0},p(l,c){let f=e;e=a(l),e!==f&&(Q(),_(o[f],1,1,()=>{o[f]=null}),Y(),t=o[e],t||(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&k(r),o[e].d(l)}}}function wo(i){let e,t;return e=new co({props:{onConfig:i[4]}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p:D,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function yo(i){let e;return{c(){e=O("p"),e.textContent="Waiting for server ..."},m(t,r){S(t,e,r)},i:D,o:D,d(t){t&&k(e)}}}function ko(i){let e,t;return e=new $o({}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function So(i){let e,t,r,s;const n=[wo,vo,bo],o=[];function a(l,c){return l[2]?l[1]?2:1:0}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,c){o[e].m(l,c),S(l,r,c),s=!0},p(l,[c]){let f=e;e=a(l),e===f?o[e].p(l,c):(Q(),_(o[f],1,1,()=>{o[f]=null}),Y(),t=o[e],t?t.p(l,c):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&k(r),o[e].d(l)}}}function Eo(i,e,t){let{$$slots:r={},$$scope:s}=e,{navEntries:n}=e,o,a=!1,l=!1;const c=()=>V?(V.auth.onAuthStateChange((d,u)=>{console.log("auth changed:",u==null?void 0:u.user),u!=null&&u.user?t(1,o=u.user):t(1,o=null),t(3,l=!0)}),!0):(console.log("supabase is not initialized!"),!1),f=d=>{Mi(d),t(2,a=c())},h=()=>{V&&o&&V.auth.signOut()};return de(()=>{t(2,a=c())}),i.$$set=d=>{"navEntries"in d&&t(0,n=d.navEntries),"$$scope"in d&&t(6,s=d.$$scope)},[n,o,a,l,f,h,s,r]}class Co extends B{constructor(e){super(),q(this,e,Eo,So,N,{navEntries:0})}}function jr(i){let e,t=i[0].msg+"",r;return{c(){e=O("p"),r=R(t),C(e,"class","text-sm")},m(s,n){S(s,e,n),b(e,r)},p(s,n){n&1&&t!==(t=s[0].msg+"")&&U(r,t)},d(s){s&&k(e)}}}function Oo(i){let e,t;return e=new z({props:{label:"OK",onClick:i[1]}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p:D,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function To(i){let e,t,r,s,n=i[0].msg+"",o,a,l,c,f,h=i[0].details&&jr(i);return c=new X({props:{$$slots:{default:[Oo]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("h3"),t.textContent="Error",r=E(),s=O("p"),o=R(n),a=E(),h&&h.c(),l=E(),y(c.$$.fragment),C(t,"class","text-lg font-bold text-red-900 mb-2"),C(s,"class",""),C(e,"class","card-error mb-4")},m(d,u){S(d,e,u),b(e,t),b(e,r),b(e,s),b(s,o),b(e,a),h&&h.m(e,null),b(e,l),v(c,e,null),f=!0},p(d,[u]){(!f||u&1)&&n!==(n=d[0].msg+"")&&U(o,n),d[0].details?h?h.p(d,u):(h=jr(d),h.c(),h.m(e,l)):h&&(h.d(1),h=null);const p={};u&4&&(p.$$scope={dirty:u,ctx:d}),c.$set(p)},i(d){f||(m(c.$$.fragment,d),f=!0)},o(d){_(c.$$.fragment,d),f=!1},d(d){d&&k(e),h&&h.d(),w(c)}}}function Ao(i,e,t){let{error:r}=e;const s=()=>W.reset();return i.$$set=n=>{"error"in n&&t(0,r=n.error)},[r,s]}let jo=class extends B{constructor(e){super(),q(this,e,Ao,To,N,{error:0})}};function Po(i){let e,t;return{c(){e=O("h2"),t=R(i[0]),C(e,"class","text-2xl font-extrabold")},m(r,s){S(r,e,s),b(e,t)},p(r,[s]){s&1&&U(t,r[0])},i:D,o:D,d(r){r&&k(e)}}}function Io(i,e,t){let{header:r}=e;return i.$$set=s=>{"header"in s&&t(0,r=s.header)},[r]}class ie extends B{constructor(e){super(),q(this,e,Io,Po,N,{header:0})}}const st="session",Ro=(i,e,t)=>{if(i.length==0)return;const r=i.map(n=>({question:n,progress:e}));Gi(r);const s={learning:r,learned:[],reverse:t};localStorage.setItem(st,JSON.stringify(s))},On=()=>{const i=localStorage.getItem(st);return i?JSON.parse(i):null},Lo=i=>i.learning.length>0?(localStorage.setItem(st,JSON.stringify(i)),!0):(localStorage.removeItem(st),!1),Do=()=>{localStorage.removeItem(st)},Pr=i=>{const e=[0,0,0,i.learned.length];return i.learning.forEach(t=>{if(t.progress>2)throw Error(`Invalid progress ${t.progress}`);e[t.progress]++}),e};function Uo(i){let e,t;const r=i[1].default,s=Te(r,i,i[0],null);return{c(){e=O("div"),s&&s.c(),C(e,"class","flex flex-col gap-5")},m(n,o){S(n,e,o),s&&s.m(e,null),t=!0},p(n,[o]){s&&s.p&&(!t||o&1)&&je(s,r,n,n[0],t?Ae(r,n[0],o,null):Pe(n[0]),null)},i(n){t||(m(s,n),t=!0)},o(n){_(s,n),t=!1},d(n){n&&k(e),s&&s.d(n)}}}function No(i,e,t){let{$$slots:r={},$$scope:s}=e;return i.$$set=n=>{"$$scope"in n&&t(0,s=n.$$scope)},[s,r]}class oe extends B{constructor(e){super(),q(this,e,No,Uo,N,{})}}function Ir(i){let e,t;return e=new X({props:{$$slots:{default:[qo]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,s){const n={};s&8&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function qo(i){let e,t,r,s;return e=new z({props:{label:"Continue",onClick:i[1]}}),r=new z({props:{label:"End",onClick:i[2]}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p:D,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Bo(i){let e,t,r,s;e=new ie({props:{header:"Home"}});let n=i[0]&&Ir(i);return{c(){y(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){v(e,o,a),S(o,t,a),n&&n.m(o,a),S(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=Ir(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Q(),_(n,1,1,()=>{n=null}),Y())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(k(t),k(r)),w(e,o),n&&n.d(o)}}}function Fo(i){let e,t;return e=new oe({props:{$$slots:{default:[Bo]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&9&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Mo(i,e,t){let r=!1;const s=()=>{J("/lession/process")},n=()=>{Do(),t(0,r=!1)};return de(()=>{On()&&t(0,r=!0)}),[r,s,n]}class zo extends B{constructor(e){super(),q(this,e,Mo,Fo,N,{})}}const at="cache-",Tn=()=>{const i=[];for(let e in localStorage)e.startsWith(at)&&i.push(e);return i.sort()},Ho=()=>{const i=[];for(let e in localStorage)e.startsWith(at)&&localStorage.removeItem(e);return i},Jo=i=>(localStorage.removeItem(i),Tn());function Rr(i,e,t){const r=i.slice();return r[4]=e[t],r}function Ko(i){let e;return{c(){e=R("Cache is empty!")},m(t,r){S(t,e,r)},p:D,i:D,o:D,d(t){t&&k(e)}}}function Go(i){let e,t,r,s,n,o,a,l=ce(i[0]),c=[];for(let h=0;h<l.length;h+=1)c[h]=Lr(Rr(i,l,h));const f=h=>_(c[h],1,1,()=>{c[h]=null});return o=new X({props:{$$slots:{default:[Vo]},$$scope:{ctx:i}}}),{c(){e=O("table"),t=O("thead"),t.innerHTML='<tr class="tb-head"><th>Cache Key</th> <th></th></tr>',r=E(),s=O("tbody");for(let h=0;h<c.length;h+=1)c[h].c();n=E(),y(o.$$.fragment),C(e,"class","bg-white shadow w-full")},m(h,d){S(h,e,d),b(e,t),b(e,r),b(e,s);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(s,null);S(h,n,d),v(o,h,d),a=!0},p(h,d){if(d&1){l=ce(h[0]);let p;for(p=0;p<l.length;p+=1){const g=Rr(h,l,p);c[p]?(c[p].p(g,d),m(c[p],1)):(c[p]=Lr(g),c[p].c(),m(c[p],1),c[p].m(s,null))}for(Q(),p=l.length;p<c.length;p+=1)f(p);Y()}const u={};d&129&&(u.$$scope={dirty:d,ctx:h}),o.$set(u)},i(h){if(!a){for(let d=0;d<l.length;d+=1)m(c[d]);m(o.$$.fragment,h),a=!0}},o(h){c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)_(c[d]);_(o.$$.fragment,h),a=!1},d(h){h&&(k(e),k(n)),Ve(c,h),w(o,h)}}}function Wo(i){let e,t;function r(){return i[1](i[4])}return e=new z({props:{label:"Delete",onClick:r}}),{c(){y(e.$$.fragment)},m(s,n){v(e,s,n),t=!0},p(s,n){i=s;const o={};n&1&&(o.onClick=r),e.$set(o)},i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){_(e.$$.fragment,s),t=!1},d(s){w(e,s)}}}function Lr(i){let e,t,r=i[4]+"",s,n,o,a,l,c;return a=new X({props:{$$slots:{default:[Wo]},$$scope:{ctx:i}}}),{c(){e=O("tr"),t=O("td"),s=R(r),n=E(),o=O("td"),y(a.$$.fragment),l=E()},m(f,h){S(f,e,h),b(e,t),b(t,s),b(e,n),b(e,o),v(a,o,null),b(e,l),c=!0},p(f,h){(!c||h&1)&&r!==(r=f[4]+"")&&U(s,r);const d={};h&129&&(d.$$scope={dirty:h,ctx:f}),a.$set(d)},i(f){c||(m(a.$$.fragment,f),c=!0)},o(f){_(a.$$.fragment,f),c=!1},d(f){f&&k(e),w(a)}}}function Vo(i){let e,t,r,s;return e=new z({props:{onClick:i[2],label:"Cancel"}}),r=new z({props:{onClick:i[3],label:"Delete all"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[3]),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Qo(i){let e,t,r,s,n,o;e=new ie({props:{header:"Cache"}});const a=[Go,Ko],l=[];function c(f,h){return f[0].length>0?0:1}return r=c(i),s=l[r]=a[r](i),{c(){y(e.$$.fragment),t=E(),s.c(),n=se()},m(f,h){v(e,f,h),S(f,t,h),l[r].m(f,h),S(f,n,h),o=!0},p(f,h){let d=r;r=c(f),r===d?l[r].p(f,h):(Q(),_(l[d],1,1,()=>{l[d]=null}),Y(),s=l[r],s?s.p(f,h):(s=l[r]=a[r](f),s.c()),m(s,1),s.m(n.parentNode,n))},i(f){o||(m(e.$$.fragment,f),m(s),o=!0)},o(f){_(e.$$.fragment,f),_(s),o=!1},d(f){f&&(k(t),k(n)),w(e,f),l[r].d(f)}}}function Yo(i){let e,t;return e=new oe({props:{$$slots:{default:[Qo]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&129&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Xo(i,e,t){let r=[];return de(()=>{t(0,r=Tn())}),[r,a=>{t(0,r=Jo(a))},()=>J("/"),()=>t(0,r=Ho())]}class Zo extends B{constructor(e){super(),q(this,e,Xo,Yo,N,{})}}function xo(i){let e,t,r,s;return e=new ie({props:{header:"Not Found"}}),{c(){y(e.$$.fragment),t=E(),r=O("div"),r.textContent="Not Found"},m(n,o){v(e,n,o),S(n,t,o),S(n,r,o),s=!0},p:D,i(n){s||(m(e.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),s=!1},d(n){n&&(k(t),k(r)),w(e,n)}}}function ea(i){let e,t;return e=new oe({props:{$$slots:{default:[xo]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}class ta extends B{constructor(e){super(),q(this,e,null,ea,N,{})}}const it=at+"books",wt=async i=>{let{data:e,error:t}=await V.from("books").select("*").eq("id",i).single();return t&&W.setDBError(t),e||null},Zt=async()=>{const i=localStorage.getItem(it);if(i)return JSON.parse(i);let{data:e,error:t}=await V.from("books").select("*");return t&&W.setDBError(t),e?(localStorage.setItem(it,JSON.stringify(e)),e):[]},ra=async i=>{const{error:e}=await V.from("books").delete().eq("id",i);return e?(W.setDBError(e),[]):(localStorage.removeItem(it),Zt())},na=async(i,e)=>{const{error:t}=await V.from("books").insert([{name:i,description:e}]);if(t)return W.setDBError(t),[];localStorage.removeItem(it)},sa=async(i,e,t)=>{const{error:r}=await V.from("books").update({name:e,description:t}).eq("id",i);return r?(W.setDBError(r),[]):(localStorage.removeItem(it),Zt())};function ia(i){let e,t,r,s;const n=i[2].default,o=Te(n,i,i[1],null);return{c(){e=O("button"),o&&o.c(),C(e,"class","text-blue-600 hover:text-blue-700")},m(a,l){S(a,e,l),o&&o.m(e,null),t=!0,r||(s=Ie(e,"click",function(){Oe(i[0])&&i[0].apply(this,arguments)}),r=!0)},p(a,[l]){i=a,o&&o.p&&(!t||l&2)&&je(o,n,i,i[1],t?Ae(n,i[1],l,null):Pe(i[1]),null)},i(a){t||(m(o,a),t=!0)},o(a){_(o,a),t=!1},d(a){a&&k(e),o&&o.d(a),r=!1,s()}}}function oa(i,e,t){let{$$slots:r={},$$scope:s}=e,{onClick:n}=e;return i.$$set=o=>{"onClick"in o&&t(0,n=o.onClick),"$$scope"in o&&t(1,s=o.$$scope)},[n,s,r]}class yt extends B{constructor(e){super(),q(this,e,oa,ia,N,{onClick:0})}}function aa(i){let e,t;return{c(){e=be("svg"),t=be("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){S(r,e,s),b(e,t)},p:D,d(r){r&&k(e)}}}function la(i){let e,t;return e=new yt({props:{onClick:i[0],$$slots:{default:[aa]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ua(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class xt extends B{constructor(e){super(),q(this,e,ua,la,N,{onClick:0})}}function ca(i){let e,t;return{c(){e=be("svg"),t=be("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){S(r,e,s),b(e,t)},p:D,d(r){r&&k(e)}}}function fa(i){let e,t;return e=new yt({props:{onClick:i[0],$$slots:{default:[ca]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ha(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class An extends B{constructor(e){super(),q(this,e,ha,fa,N,{onClick:0})}}function da(i){let e,t;return{c(){e=be("svg"),t=be("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){S(r,e,s),b(e,t)},p:D,d(r){r&&k(e)}}}function pa(i){let e,t;return e=new yt({props:{onClick:i[0],$$slots:{default:[da]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ma(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class er extends B{constructor(e){super(),q(this,e,ma,pa,N,{onClick:0})}}function Dr(i,e,t){const r=i.slice();return r[6]=e[t],r}function _a(i){let e,t,r,s,n,o;function a(){return i[1](i[6])}e=new xt({props:{onClick:a}});function l(){return i[2](i[6])}r=new er({props:{onClick:l}});function c(){return i[3](i[6])}return n=new An({props:{onClick:c}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),y(n.$$.fragment)},m(f,h){v(e,f,h),S(f,t,h),v(r,f,h),S(f,s,h),v(n,f,h),o=!0},p(f,h){i=f;const d={};h&1&&(d.onClick=a),e.$set(d);const u={};h&1&&(u.onClick=l),r.$set(u);const p={};h&1&&(p.onClick=c),n.$set(p)},i(f){o||(m(e.$$.fragment,f),m(r.$$.fragment,f),m(n.$$.fragment,f),o=!0)},o(f){_(e.$$.fragment,f),_(r.$$.fragment,f),_(n.$$.fragment,f),o=!1},d(f){f&&(k(t),k(s)),w(e,f),w(r,f),w(n,f)}}}function Ur(i){let e,t,r=i[6].id+"",s,n,o,a=i[6].name+"",l,c,f,h=i[6].description+"",d,u,p,g=re(i[6].modified)+"",$,T,L,P,A,j;return P=new X({props:{$$slots:{default:[_a]},$$scope:{ctx:i}}}),{c(){e=O("tr"),t=O("td"),s=R(r),n=E(),o=O("td"),l=R(a),c=E(),f=O("td"),d=R(h),u=E(),p=O("td"),$=R(g),T=E(),L=O("td"),y(P.$$.fragment),A=E()},m(I,H){S(I,e,H),b(e,t),b(t,s),b(e,n),b(e,o),b(o,l),b(e,c),b(e,f),b(f,d),b(e,u),b(e,p),b(p,$),b(e,T),b(e,L),v(P,L,null),b(e,A),j=!0},p(I,H){(!j||H&1)&&r!==(r=I[6].id+"")&&U(s,r),(!j||H&1)&&a!==(a=I[6].name+"")&&U(l,a),(!j||H&1)&&h!==(h=I[6].description+"")&&U(d,h),(!j||H&1)&&g!==(g=re(I[6].modified)+"")&&U($,g);const K={};H&513&&(K.$$scope={dirty:H,ctx:I}),P.$set(K)},i(I){j||(m(P.$$.fragment,I),j=!0)},o(I){_(P.$$.fragment,I),j=!1},d(I){I&&k(e),w(P)}}}function ga(i){let e,t,r,s;return e=new z({props:{onClick:i[4],label:"Cancel"}}),r=new z({props:{onClick:i[5],label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p:D,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function $a(i){let e,t,r,s,n,o,a,l,c;e=new ie({props:{header:"List Books"}});let f=ce(i[0]),h=[];for(let u=0;u<f.length;u+=1)h[u]=Ur(Dr(i,f,u));const d=u=>_(h[u],1,1,()=>{h[u]=null});return l=new X({props:{$$slots:{default:[ga]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),r=O("table"),s=O("thead"),s.innerHTML='<tr class="tb-head"><th>ID</th> <th>Name</th> <th>Description</th> <th>Modified</th> <th></th></tr>',n=E(),o=O("tbody");for(let u=0;u<h.length;u+=1)h[u].c();a=E(),y(l.$$.fragment),C(r,"class","bg-white shadow w-full")},m(u,p){v(e,u,p),S(u,t,p),S(u,r,p),b(r,s),b(r,n),b(r,o);for(let g=0;g<h.length;g+=1)h[g]&&h[g].m(o,null);S(u,a,p),v(l,u,p),c=!0},p(u,p){if(p&1){f=ce(u[0]);let $;for($=0;$<f.length;$+=1){const T=Dr(u,f,$);h[$]?(h[$].p(T,p),m(h[$],1)):(h[$]=Ur(T),h[$].c(),m(h[$],1),h[$].m(o,null))}for(Q(),$=f.length;$<h.length;$+=1)d($);Y()}const g={};p&512&&(g.$$scope={dirty:p,ctx:u}),l.$set(g)},i(u){if(!c){m(e.$$.fragment,u);for(let p=0;p<f.length;p+=1)m(h[p]);m(l.$$.fragment,u),c=!0}},o(u){_(e.$$.fragment,u),h=h.filter(Boolean);for(let p=0;p<h.length;p+=1)_(h[p]);_(l.$$.fragment,u),c=!1},d(u){u&&(k(t),k(r),k(a)),w(e,u),Ve(h,u),w(l,u)}}}function ba(i){let e,t;return e=new oe({props:{$$slots:{default:[$a]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&513&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function va(i,e,t){let r=[];return de(async()=>{t(0,r=await Zt())}),[r,async c=>{t(0,r=await ra(c.id))},c=>{J("/books/update/"+c.id)},c=>{J("/chapters/list/"+c.id)},()=>J("/books/list"),()=>J("/books/create")]}class wa extends B{constructor(e){super(),q(this,e,va,ba,N,{})}}function ya(i){let e,t,r;return{c(){e=O("textarea"),C(e,"class","input"),C(e,"id",i[2])},m(s,n){S(s,e,n),Je(e,i[0]),t||(r=Ie(e,"input",i[4]),t=!0)},p(s,n){n&4&&C(e,"id",s[2]),n&1&&Je(e,s[0])},d(s){s&&k(e),t=!1,r()}}}function ka(i){let e,t;return e=new Xt({props:{id:i[2],label:i[1],error:i[3],$$slots:{default:[ya]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&4&&(n.id=r[2]),s&2&&(n.label=r[1]),s&8&&(n.error=r[3]),s&37&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Sa(i,e,t){let{label:r}=e,{id:s}=e,{value:n}=e,{error:o}=e;function a(){n=this.value,t(0,n)}return i.$$set=l=>{"label"in l&&t(1,r=l.label),"id"in l&&t(2,s=l.id),"value"in l&&t(0,n=l.value),"error"in l&&t(3,o=l.error)},[n,r,s,o,a]}class ve extends B{constructor(e){super(),q(this,e,Sa,ka,N,{label:1,id:2,value:0,error:3})}}function Ea(i){let e,t,r,s;return e=new z({props:{onClick:i[7],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p:D,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Ca(i){let e,t,r,s,n,o,a,l;function c(u){i[5](u)}let f={id:"name",label:"Book name",error:i[1]};i[0]!==void 0&&(f.value=i[0]),e=new Ce({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[6](u)}let d={id:"description",label:"Book description",error:i[3]};return i[2]!==void 0&&(d.value=i[2]),s=new ve({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[Ea]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&2&&(g.error=u[1]),!t&&p&1&&(t=!0,g.value=u[0],x(()=>t=!1)),e.$set(g);const $={};p&8&&($.error=u[3]),!n&&p&4&&(n=!0,$.value=u[2],x(()=>n=!1)),s.$set($);const T={};p&256&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function Oa(i){let e,t,r,s;return e=new ie({props:{header:"Create Book"}}),r=new pe({props:{onSubmit:i[4],$$slots:{default:[Ca]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&271&&(a.$$scope={dirty:o,ctx:n}),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Ta(i){let e,t;return e=new oe({props:{$$slots:{default:[Oa]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&271&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Aa(i,e,t){let r="",s="",n="",o="";const a=async()=>{t(1,s=ne(r)),t(3,o=ne(n)),!(s||o)&&(await na(r,n),J("/books/list"))};function l(h){r=h,t(0,r)}function c(h){n=h,t(2,n)}return[r,s,n,o,a,l,c,()=>J("/books/list")]}class ja extends B{constructor(e){super(),q(this,e,Aa,Ta,N,{})}}function Nr(i){let e,t,r=i[0].id+"",s,n,o,a=re(i[0].modified)+"",l,c,f,h;return f=new pe({props:{onSubmit:i[5],$$slots:{default:[Ia]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("span"),s=R(r),n=E(),o=O("span"),l=R(a),c=E(),y(f.$$.fragment),C(e,"class","mb-4 text-small")},m(d,u){S(d,e,u),b(e,t),b(t,s),b(e,n),b(e,o),b(o,l),S(d,c,u),v(f,d,u),h=!0},p(d,u){(!h||u&1)&&r!==(r=d[0].id+"")&&U(s,r),(!h||u&1)&&a!==(a=re(d[0].modified)+"")&&U(l,a);const p={};u&1054&&(p.$$scope={dirty:u,ctx:d}),f.$set(p)},i(d){h||(m(f.$$.fragment,d),h=!0)},o(d){_(f.$$.fragment,d),h=!1},d(d){d&&(k(e),k(c)),w(f,d)}}}function Pa(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Update"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p:D,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Ia(i){let e,t,r,s,n,o,a,l;function c(u){i[7](u)}let f={id:"name",label:"Book name",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new Ce({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[8](u)}let d={id:"description",label:"Book description",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new ve({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[Pa]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&4&&(g.error=u[2]),!t&&p&2&&(t=!0,g.value=u[1],x(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=u[4]),!n&&p&8&&(n=!0,$.value=u[3],x(()=>n=!1)),s.$set($);const T={};p&1024&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function Ra(i){let e,t,r,s;e=new ie({props:{header:"Update Book"}});let n=i[0]&&Nr(i);return{c(){y(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){v(e,o,a),S(o,t,a),n&&n.m(o,a),S(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=Nr(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Q(),_(n,1,1,()=>{n=null}),Y())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(k(t),k(r)),w(e,o),n&&n.d(o)}}}function La(i){let e,t;return e=new oe({props:{$$slots:{default:[Ra]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1055&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Da(i,e,t){let{params:r={id:""}}=e,s=null,n="",o="",a="",l="";const c=async()=>{if(t(2,o=ne(n)),t(4,l=ne(a)),!(o||l)){if(!s){W.setString("No book!!");return}await sa(s.id,n,a),J("/books/list")}};de(async()=>{t(0,s=await wt(parseInt(r.id))),s&&(t(1,n=s.name),t(3,a=s.description))});function f(u){n=u,t(1,n)}function h(u){a=u,t(3,a)}const d=()=>J("/books/list");return i.$$set=u=>{"params"in u&&t(6,r=u.params)},[s,n,o,a,l,c,r,f,h,d]}class Ua extends B{constructor(e){super(),q(this,e,Da,La,N,{params:6})}}const Na=at+"chapters",kt=i=>`${Na}#${i}`,tr=async i=>{let{data:e,error:t}=await V.from("chapters").select("*").eq("id",i).single();return t&&W.setDBError(t),e||null},rr=async i=>{const e=kt(i),t=localStorage.getItem(e);if(t)return JSON.parse(t);let{data:r,error:s}=await V.from("chapters").select("*").eq("book_id",i);return s&&W.setDBError(s),r?(localStorage.setItem(e,JSON.stringify(r)),r):[]},qa=async(i,e)=>{const{error:t}=await V.from("chapters").delete().eq("id",i);return t?(W.setDBError(t),[]):(localStorage.removeItem(kt(e)),rr(e))},Ba=async(i,e,t,r)=>{const{error:s}=await V.from("chapters").update({name:t,description:r}).eq("id",i);return s?(W.setDBError(s),[]):(localStorage.removeItem(kt(e)),rr(e))},Fa=async(i,e,t)=>{const{error:r}=await V.from("chapters").insert([{book_id:i,name:e,description:t}]);if(r)return W.setDBError(r),[];localStorage.removeItem(kt(i))};function Ma(i){let e,t;const r=i[1].default,s=Te(r,i,i[0],null);return{c(){e=O("div"),s&&s.c(),C(e,"class","border rounded shadow px-4 py-4")},m(n,o){S(n,e,o),s&&s.m(e,null),t=!0},p(n,[o]){s&&s.p&&(!t||o&1)&&je(s,r,n,n[0],t?Ae(r,n[0],o,null):Pe(n[0]),null)},i(n){t||(m(s,n),t=!0)},o(n){_(s,n),t=!1},d(n){n&&k(e),s&&s.d(n)}}}function za(i,e,t){let{$$slots:r={},$$scope:s}=e;return i.$$set=n=>{"$$scope"in n&&t(0,s=n.$$scope)},[s,r]}class Ha extends B{constructor(e){super(),q(this,e,za,Ma,N,{})}}function qr(i){let e,t,r,s=i[0].name+"",n,o,a,l,c=i[0].id+"",f,h,d=re(i[0].modified)+"",u,p,g=i[0].description&&Br(i);return{c(){e=O("div"),t=O("div"),r=O("div"),n=R(s),o=E(),a=O("div"),l=R("Book-Id: "),f=R(c),h=R(" - Modified: "),u=R(d),p=E(),g&&g.c(),C(r,"class","text-lg"),C(a,"class","text-sm"),C(t,"class","flex justify-between mb-2")},m($,T){S($,e,T),b(e,t),b(t,r),b(r,n),b(t,o),b(t,a),b(a,l),b(a,f),b(a,h),b(a,u),b(e,p),g&&g.m(e,null)},p($,T){T&1&&s!==(s=$[0].name+"")&&U(n,s),T&1&&c!==(c=$[0].id+"")&&U(f,c),T&1&&d!==(d=re($[0].modified)+"")&&U(u,d),$[0].description?g?g.p($,T):(g=Br($),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d($){$&&k(e),g&&g.d()}}}function Br(i){let e,t=i[0].description+"",r;return{c(){e=O("p"),r=R(t),C(e,"class","mt-2 pt-2 border-t text-sm")},m(s,n){S(s,e,n),b(e,r)},p(s,n){n&1&&t!==(t=s[0].description+"")&&U(r,t)},d(s){s&&k(e)}}}function Fr(i){let e,t,r,s=i[1].name+"",n,o,a,l,c=i[1].id+"",f,h,d=re(i[1].modified)+"",u,p,g=i[1].description&&Mr(i);return{c(){e=O("div"),t=O("div"),r=O("div"),n=R(s),o=E(),a=O("div"),l=R("Chapter-Id: "),f=R(c),h=R(" - Modified: "),u=R(d),p=E(),g&&g.c(),C(r,"class","text-lg"),C(a,"class","text-sm"),C(t,"class","flex justify-between mb-2")},m($,T){S($,e,T),b(e,t),b(t,r),b(r,n),b(t,o),b(t,a),b(a,l),b(a,f),b(a,h),b(a,u),b(e,p),g&&g.m(e,null)},p($,T){T&2&&s!==(s=$[1].name+"")&&U(n,s),T&2&&c!==(c=$[1].id+"")&&U(f,c),T&2&&d!==(d=re($[1].modified)+"")&&U(u,d),$[1].description?g?g.p($,T):(g=Mr($),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d($){$&&k(e),g&&g.d()}}}function Mr(i){let e,t=i[1].description+"",r;return{c(){e=O("p"),r=R(t),C(e,"class","mt-2 pt-2 border-t text-sm")},m(s,n){S(s,e,n),b(e,r)},p(s,n){n&2&&t!==(t=s[1].description+"")&&U(r,t)},d(s){s&&k(e)}}}function Ja(i){let e,t,r=i[0]&&qr(i),s=i[1]&&Fr(i);return{c(){e=O("div"),r&&r.c(),t=E(),s&&s.c(),C(e,"class","flex flex-col gap-5")},m(n,o){S(n,e,o),r&&r.m(e,null),b(e,t),s&&s.m(e,null)},p(n,o){n[0]?r?r.p(n,o):(r=qr(n),r.c(),r.m(e,t)):r&&(r.d(1),r=null),n[1]?s?s.p(n,o):(s=Fr(n),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(n){n&&k(e),r&&r.d(),s&&s.d()}}}function Ka(i){let e,t;return e=new Ha({props:{$$slots:{default:[Ja]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&7&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ga(i,e,t){let{book:r=null}=e,{chapter:s=null}=e;return i.$$set=n=>{"book"in n&&t(0,r=n.book),"chapter"in n&&t(1,s=n.chapter)},[r,s]}class nr extends B{constructor(e){super(),q(this,e,Ga,Ka,N,{book:0,chapter:1})}}function Wa(i){let e,t;return{c(){e=be("svg"),t=be("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){S(r,e,s),b(e,t)},p:D,d(r){r&&k(e)}}}function Va(i){let e,t;return e=new yt({props:{onClick:i[0],$$slots:{default:[Wa]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Qa(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class Ya extends B{constructor(e){super(),q(this,e,Qa,Va,N,{onClick:0})}}function zr(i,e,t){const r=i.slice();return r[9]=e[t],r}function Xa(i){let e,t,r,s,n,o,a,l;function c(){return i[3](i[9])}e=new xt({props:{onClick:c}});function f(){return i[4](i[9])}r=new er({props:{onClick:f}});function h(){return i[5](i[9])}n=new An({props:{onClick:h}});function d(){return i[6](i[9])}return a=new Ya({props:{onClick:d}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),y(n.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,t,p),v(r,u,p),S(u,s,p),v(n,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){i=u;const g={};p&4&&(g.onClick=c),e.$set(g);const $={};p&4&&($.onClick=f),r.$set($);const T={};p&4&&(T.onClick=h),n.$set(T);const L={};p&4&&(L.onClick=d),a.$set(L)},i(u){l||(m(e.$$.fragment,u),m(r.$$.fragment,u),m(n.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(r.$$.fragment,u),_(n.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(t),k(s),k(o)),w(e,u),w(r,u),w(n,u),w(a,u)}}}function Hr(i){let e,t,r=i[9].id+"",s,n,o,a=i[9].name+"",l,c,f,h=i[9].description+"",d,u,p,g=re(i[9].modified)+"",$,T,L,P,A,j;return P=new X({props:{$$slots:{default:[Xa]},$$scope:{ctx:i}}}),{c(){e=O("tr"),t=O("td"),s=R(r),n=E(),o=O("td"),l=R(a),c=E(),f=O("td"),d=R(h),u=E(),p=O("td"),$=R(g),T=E(),L=O("td"),y(P.$$.fragment),A=E()},m(I,H){S(I,e,H),b(e,t),b(t,s),b(e,n),b(e,o),b(o,l),b(e,c),b(e,f),b(f,d),b(e,u),b(e,p),b(p,$),b(e,T),b(e,L),v(P,L,null),b(e,A),j=!0},p(I,H){(!j||H&4)&&r!==(r=I[9].id+"")&&U(s,r),(!j||H&4)&&a!==(a=I[9].name+"")&&U(l,a),(!j||H&4)&&h!==(h=I[9].description+"")&&U(d,h),(!j||H&4)&&g!==(g=re(I[9].modified)+"")&&U($,g);const K={};H&4100&&(K.$$scope={dirty:H,ctx:I}),P.$set(K)},i(I){j||(m(P.$$.fragment,I),j=!0)},o(I){_(P.$$.fragment,I),j=!1},d(I){I&&k(e),w(P)}}}function Za(i){let e,t,r,s;return e=new z({props:{onClick:i[7],label:"Cancel"}}),r=new z({props:{onClick:i[8],label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[8]),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function xa(i){let e,t,r,s,n,o,a,l,c,f,h;e=new ie({props:{header:"List Chapters"}}),r=new nr({props:{book:i[1]}});let d=ce(i[2]),u=[];for(let g=0;g<d.length;g+=1)u[g]=Hr(zr(i,d,g));const p=g=>_(u[g],1,1,()=>{u[g]=null});return f=new X({props:{$$slots:{default:[Za]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),n=O("table"),o=O("thead"),o.innerHTML='<tr class="tb-head"><th>ID</th> <th>Name</th> <th>Description</th> <th>Modified</th> <th></th></tr>',a=E(),l=O("tbody");for(let g=0;g<u.length;g+=1)u[g].c();c=E(),y(f.$$.fragment),C(n,"class","bg-white shadow w-full")},m(g,$){v(e,g,$),S(g,t,$),v(r,g,$),S(g,s,$),S(g,n,$),b(n,o),b(n,a),b(n,l);for(let T=0;T<u.length;T+=1)u[T]&&u[T].m(l,null);S(g,c,$),v(f,g,$),h=!0},p(g,$){const T={};if($&2&&(T.book=g[1]),r.$set(T),$&4){d=ce(g[2]);let P;for(P=0;P<d.length;P+=1){const A=zr(g,d,P);u[P]?(u[P].p(A,$),m(u[P],1)):(u[P]=Hr(A),u[P].c(),m(u[P],1),u[P].m(l,null))}for(Q(),P=d.length;P<u.length;P+=1)p(P);Y()}const L={};$&4097&&(L.$$scope={dirty:$,ctx:g}),f.$set(L)},i(g){if(!h){m(e.$$.fragment,g),m(r.$$.fragment,g);for(let $=0;$<d.length;$+=1)m(u[$]);m(f.$$.fragment,g),h=!0}},o(g){_(e.$$.fragment,g),_(r.$$.fragment,g),u=u.filter(Boolean);for(let $=0;$<u.length;$+=1)_(u[$]);_(f.$$.fragment,g),h=!1},d(g){g&&(k(t),k(s),k(n),k(c)),w(e,g),w(r,g),Ve(u,g),w(f,g)}}}function el(i){let e,t;return e=new oe({props:{$$slots:{default:[xa]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&4103&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function tl(i,e,t){let{params:r={id:0}}=e,s,n=[];de(async()=>{t(1,s=await wt(r.id)),s&&t(2,n=await rr(s.id))});const o=async d=>{t(2,n=await qa(d.id,d.book_id))},a=d=>{J("/chapters/update/"+d.id)},l=d=>{J("/questions/list/"+d.id)},c=d=>{J("/lession/prepare/"+d.id)},f=()=>J("/books/list"),h=()=>J("/chapters/create/"+r.id);return i.$$set=d=>{"params"in d&&t(0,r=d.params)},[r,s,n,o,a,l,c,f,h]}class rl extends B{constructor(e){super(),q(this,e,tl,el,N,{params:0})}}function nl(i){let e,t,r,s;return e=new z({props:{onClick:i[8],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[8]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function sl(i){let e,t,r,s,n,o,a,l;function c(u){i[6](u)}let f={id:"name",label:"Chapter name",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new Ce({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[7](u)}let d={id:"description",label:"Chapter description",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new ve({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[nl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&4&&(g.error=u[2]),!t&&p&2&&(t=!0,g.value=u[1],x(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=u[4]),!n&&p&8&&(n=!0,$.value=u[3],x(()=>n=!1)),s.$set($);const T={};p&513&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function il(i){let e,t,r,s;return e=new ie({props:{header:"Create Book"}}),r=new pe({props:{onSubmit:i[5],$$slots:{default:[sl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&543&&(a.$$scope={dirty:o,ctx:n}),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function ol(i){let e,t;return e=new oe({props:{$$slots:{default:[il]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&543&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function al(i,e,t){let{params:r={book_id:0}}=e,s="",n="",o="",a="";const l=async()=>{t(2,n=ne(s)),t(4,a=ne(o)),!(n||a)&&(await Fa(r.book_id,s,o),J("/chapters/list/"+r.book_id))};function c(d){s=d,t(1,s)}function f(d){o=d,t(3,o)}const h=()=>J("/chapters/list/"+r.book_id);return i.$$set=d=>{"params"in d&&t(0,r=d.params)},[r,s,n,o,a,l,c,f,h]}class ll extends B{constructor(e){super(),q(this,e,al,ol,N,{params:0})}}function Jr(i){let e,t,r=i[0].id+"",s,n,o,a=re(i[0].modified)+"",l,c,f,h;return f=new pe({props:{onSubmit:i[5],$$slots:{default:[cl]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("span"),s=R(r),n=E(),o=O("span"),l=R(a),c=E(),y(f.$$.fragment),C(e,"class","mb-4 text-small")},m(d,u){S(d,e,u),b(e,t),b(t,s),b(e,n),b(e,o),b(o,l),S(d,c,u),v(f,d,u),h=!0},p(d,u){(!h||u&1)&&r!==(r=d[0].id+"")&&U(s,r),(!h||u&1)&&a!==(a=re(d[0].modified)+"")&&U(l,a);const p={};u&1055&&(p.$$scope={dirty:u,ctx:d}),f.$set(p)},i(d){h||(m(f.$$.fragment,d),h=!0)},o(d){_(f.$$.fragment,d),h=!1},d(d){d&&(k(e),k(c)),w(f,d)}}}function ul(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[9]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function cl(i){let e,t,r,s,n,o,a,l;function c(u){i[7](u)}let f={id:"name",label:"Chapter name",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new Ce({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[8](u)}let d={id:"description",label:"Chapter description",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new ve({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[ul]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&4&&(g.error=u[2]),!t&&p&2&&(t=!0,g.value=u[1],x(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=u[4]),!n&&p&8&&(n=!0,$.value=u[3],x(()=>n=!1)),s.$set($);const T={};p&1025&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function fl(i){let e,t,r,s;e=new ie({props:{header:"Update Book"}});let n=i[0]&&Jr(i);return{c(){y(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){v(e,o,a),S(o,t,a),n&&n.m(o,a),S(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=Jr(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Q(),_(n,1,1,()=>{n=null}),Y())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(k(t),k(r)),w(e,o),n&&n.d(o)}}}function hl(i){let e,t;return e=new oe({props:{$$slots:{default:[fl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1055&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function dl(i,e,t){let{params:r={id:""}}=e,s=null,n="",o="",a="",l="";const c=async()=>{if(t(2,o=ne(n)),t(4,l=ne(a)),!(o||l)){if(!s){W.setString("No chapter!!");return}await Ba(s.id,s.book_id,n,a),J("/chapters/list/"+s.book_id)}};de(async()=>{t(0,s=await tr(parseInt(r.id))),s&&(t(1,n=s.name),t(3,a=s.description))});function f(u){n=u,t(1,n)}function h(u){a=u,t(3,a)}const d=()=>J("/chapters/list/"+(s==null?void 0:s.book_id));return i.$$set=u=>{"params"in u&&t(6,r=u.params)},[s,n,o,a,l,c,r,f,h,d]}class pl extends B{constructor(e){super(),q(this,e,dl,hl,N,{params:6})}}const ml=at+"questions",St=i=>`${ml}#${i}`,_l=async i=>{let{data:e,error:t}=await V.from("questions").select("*").eq("id",i).single();return t&&W.setDBError(t),e||null},Et=async i=>{const e=St(i),t=localStorage.getItem(e);if(t)return JSON.parse(t);let{data:r,error:s}=await V.from("questions").select("*").eq("chapter_id",i);return s&&W.setDBError(s),r?(localStorage.setItem(e,JSON.stringify(r)),r):[]},gl=async(i,e)=>{const{error:t}=await V.from("questions").delete().eq("id",i);return t?(W.setDBError(t),[]):(localStorage.removeItem(St(e)),Et(e))},$l=async(i,e,t)=>{const{error:r}=await V.from("questions").insert([{chapter_id:i,question:e,answer:t}]);if(r)return W.setDBError(r),[];localStorage.removeItem(St(i))},bl=async(i,e,t,r)=>{const{error:s}=await V.from("questions").update({question:t,answer:r}).eq("id",i);return s?(W.setDBError(s),[]):(localStorage.removeItem(St(e)),Et(e))};function Kr(i){let e,t,r,s;return{c(){e=O("div"),t=R("Progress: "),r=R(i[1]),s=R(" / 3"),C(e,"class","text-xs font-bold mb-2 border rounded-lg shadow-sm bg-emerald-800 text-white px-2")},m(n,o){S(n,e,o),b(e,t),b(e,r),b(e,s)},p(n,o){o&2&&U(r,n[1])},d(n){n&&k(e)}}}function Gr(i){let e,t,r,s=(i[3]?i[0].question:i[0].answer)+"",n;return{c(){e=O("div"),e.textContent="Answer",t=E(),r=O("div"),n=R(s),C(e,"class","text-sm font-bold mb-2"),C(r,"class","px-3 py-3 border border-gray-400 rounded shadow-sm")},m(o,a){S(o,e,a),S(o,t,a),S(o,r,a),b(r,n)},p(o,a){a&9&&s!==(s=(o[3]?o[0].question:o[0].answer)+"")&&U(n,s)},d(o){o&&(k(e),k(t),k(r))}}}function vl(i){let e,t,r,s,n=i[0].id+"",o,a,l,c,f,h=re(i[0].modified)+"",d,u,p,g=(i[3]?i[0].answer:i[0].question)+"",$,T,L=i[1]>=0&&Kr(i),P=i[2]&&Gr(i);return{c(){e=O("div"),t=O("div"),r=O("div"),s=R("Question Id: "),o=R(n),a=E(),L&&L.c(),l=E(),c=O("div"),f=R("Modified: "),d=R(h),u=E(),p=O("div"),$=R(g),T=E(),P&&P.c(),C(r,"class","text-sm font-bold mb-2"),C(c,"class","text-sm mb-2"),C(t,"class","flex justify-between"),C(p,"class","mb-2 px-3 py-3 border border-gray-400 rounded shadow-sm")},m(A,j){S(A,e,j),b(e,t),b(t,r),b(r,s),b(r,o),b(t,a),L&&L.m(t,null),b(t,l),b(t,c),b(c,f),b(c,d),b(e,u),b(e,p),b(p,$),b(e,T),P&&P.m(e,null)},p(A,[j]){j&1&&n!==(n=A[0].id+"")&&U(o,n),A[1]>=0?L?L.p(A,j):(L=Kr(A),L.c(),L.m(t,l)):L&&(L.d(1),L=null),j&1&&h!==(h=re(A[0].modified)+"")&&U(d,h),j&9&&g!==(g=(A[3]?A[0].answer:A[0].question)+"")&&U($,g),A[2]?P?P.p(A,j):(P=Gr(A),P.c(),P.m(e,null)):P&&(P.d(1),P=null)},i:D,o:D,d(A){A&&k(e),L&&L.d(),P&&P.d()}}}function wl(i,e,t){let{question:r}=e,{progress:s=-1}=e,{showAnswer:n=!0}=e,{reverse:o=!1}=e;return i.$$set=a=>{"question"in a&&t(0,r=a.question),"progress"in a&&t(1,s=a.progress),"showAnswer"in a&&t(2,n=a.showAnswer),"reverse"in a&&t(3,o=a.reverse)},[r,s,n,o]}class jn extends B{constructor(e){super(),q(this,e,wl,vl,N,{question:0,progress:1,showAnswer:2,reverse:3})}}function Wr(i,e,t){const r=i.slice();return r[8]=e[t],r}function yl(i){let e,t,r,s;function n(){return i[4](i[8])}e=new er({props:{onClick:n}});function o(){return i[5](i[8])}return r=new xt({props:{onClick:o}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(a,l){v(e,a,l),S(a,t,l),v(r,a,l),s=!0},p(a,l){i=a;const c={};l&8&&(c.onClick=n),e.$set(c);const f={};l&8&&(f.onClick=o),r.$set(f)},i(a){s||(m(e.$$.fragment,a),m(r.$$.fragment,a),s=!0)},o(a){_(e.$$.fragment,a),_(r.$$.fragment,a),s=!1},d(a){a&&k(t),w(e,a),w(r,a)}}}function Vr(i){let e,t,r,s,n,o,a;return t=new jn({props:{question:i[8]}}),n=new X({props:{$$slots:{default:[yl]},$$scope:{ctx:i}}}),{c(){e=O("div"),y(t.$$.fragment),r=E(),s=O("div"),y(n.$$.fragment),o=E(),C(s,"class","mt-2 flex justify-end")},m(l,c){S(l,e,c),v(t,e,null),b(e,r),b(e,s),v(n,s,null),b(e,o),a=!0},p(l,c){const f={};c&8&&(f.question=l[8]),t.$set(f);const h={};c&2056&&(h.$$scope={dirty:c,ctx:l}),n.$set(h)},i(l){a||(m(t.$$.fragment,l),m(n.$$.fragment,l),a=!0)},o(l){_(t.$$.fragment,l),_(n.$$.fragment,l),a=!1},d(l){l&&k(e),w(t),w(n)}}}function kl(i){let e,t,r,s;return e=new z({props:{onClick:i[6],label:"Cancel"}}),r=new z({props:{onClick:i[7],label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&4&&(a.onClick=n[6]),e.$set(a);const l={};o&1&&(l.onClick=n[7]),r.$set(l)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Sl(i){let e,t,r,s,n,o,a,l;e=new ie({props:{header:"List Chapters"}}),r=new nr({props:{book:i[1],chapter:i[2]}});let c=ce(i[3]),f=[];for(let d=0;d<c.length;d+=1)f[d]=Vr(Wr(i,c,d));const h=d=>_(f[d],1,1,()=>{f[d]=null});return a=new X({props:{$$slots:{default:[kl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),n=O("div");for(let d=0;d<f.length;d+=1)f[d].c();o=E(),y(a.$$.fragment),C(n,"class","flex flex-col gap-5")},m(d,u){v(e,d,u),S(d,t,u),v(r,d,u),S(d,s,u),S(d,n,u);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(n,null);S(d,o,u),v(a,d,u),l=!0},p(d,u){const p={};if(u&2&&(p.book=d[1]),u&4&&(p.chapter=d[2]),r.$set(p),u&8){c=ce(d[3]);let $;for($=0;$<c.length;$+=1){const T=Wr(d,c,$);f[$]?(f[$].p(T,u),m(f[$],1)):(f[$]=Vr(T),f[$].c(),m(f[$],1),f[$].m(n,null))}for(Q(),$=c.length;$<f.length;$+=1)h($);Y()}const g={};u&2053&&(g.$$scope={dirty:u,ctx:d}),a.$set(g)},i(d){if(!l){m(e.$$.fragment,d),m(r.$$.fragment,d);for(let u=0;u<c.length;u+=1)m(f[u]);m(a.$$.fragment,d),l=!0}},o(d){_(e.$$.fragment,d),_(r.$$.fragment,d),f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)_(f[u]);_(a.$$.fragment,d),l=!1},d(d){d&&(k(t),k(s),k(n),k(o)),w(e,d),w(r,d),Ve(f,d),w(a,d)}}}function El(i){let e,t;return e=new oe({props:{$$slots:{default:[Sl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&2063&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Cl(i,e,t){let{params:r={id:0}}=e,s,n,o=[];de(async()=>{t(2,n=await tr(r.id)),n&&(t(3,o=await Et(n.id)),t(1,s=await wt(n.book_id)))});const a=h=>J("/questions/update/"+h.id),l=async h=>{t(3,o=await gl(h.id,h.chapter_id))},c=()=>J("/chapters/list/"+(n==null?void 0:n.book_id)),f=()=>J("/questions/create/"+r.id);return i.$$set=h=>{"params"in h&&t(0,r=h.params)},[r,s,n,o,a,l,c,f]}class Ol extends B{constructor(e){super(),q(this,e,Cl,El,N,{params:0})}}function Qr(i){let e,t,r=i[0].id+"",s,n,o,a=re(i[0].modified)+"",l,c,f,h;return f=new pe({props:{onSubmit:i[5],$$slots:{default:[Al]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("span"),s=R(r),n=E(),o=O("span"),l=R(a),c=E(),y(f.$$.fragment),C(e,"class","mb-4 text-small")},m(d,u){S(d,e,u),b(e,t),b(t,s),b(e,n),b(e,o),b(o,l),S(d,c,u),v(f,d,u),h=!0},p(d,u){(!h||u&1)&&r!==(r=d[0].id+"")&&U(s,r),(!h||u&1)&&a!==(a=re(d[0].modified)+"")&&U(l,a);const p={};u&1055&&(p.$$scope={dirty:u,ctx:d}),f.$set(p)},i(d){h||(m(f.$$.fragment,d),h=!0)},o(d){_(f.$$.fragment,d),h=!1},d(d){d&&(k(e),k(c)),w(f,d)}}}function Tl(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Update"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[9]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Al(i){let e,t,r,s,n,o,a,l;function c(u){i[7](u)}let f={id:"question",label:"Questione",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new ve({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[8](u)}let d={id:"answer",label:"Answer",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new ve({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[Tl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&4&&(g.error=u[2]),!t&&p&2&&(t=!0,g.value=u[1],x(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=u[4]),!n&&p&8&&(n=!0,$.value=u[3],x(()=>n=!1)),s.$set($);const T={};p&1025&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function jl(i){let e,t,r,s;e=new ie({props:{header:"Update Book"}});let n=i[0]&&Qr(i);return{c(){y(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){v(e,o,a),S(o,t,a),n&&n.m(o,a),S(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=Qr(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Q(),_(n,1,1,()=>{n=null}),Y())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(k(t),k(r)),w(e,o),n&&n.d(o)}}}function Pl(i){let e,t;return e=new oe({props:{$$slots:{default:[jl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&1055&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Il(i,e,t){let{params:r={id:""}}=e,s=null,n="",o="",a="",l="";const c=async()=>{if(t(2,o=ne(n)),t(4,l=ne(a)),!(o||l)){if(!s){W.setString("No question!!");return}await bl(s.id,s.chapter_id,n,a),J("/questions/list/"+s.chapter_id)}};de(async()=>{t(0,s=await _l(parseInt(r.id))),s&&(t(1,n=s.question),t(3,a=s.answer))});function f(u){n=u,t(1,n)}function h(u){a=u,t(3,a)}const d=()=>J("/questions/list/"+(s==null?void 0:s.chapter_id));return i.$$set=u=>{"params"in u&&t(6,r=u.params)},[s,n,o,a,l,c,r,f,h,d]}class Rl extends B{constructor(e){super(),q(this,e,Il,Pl,N,{params:6})}}function Ll(i){let e,t,r,s;return e=new z({props:{onClick:i[8],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[8]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Dl(i){let e,t,r,s,n,o,a,l;function c(u){i[6](u)}let f={id:"question",label:"Question",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new ve({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[7](u)}let d={id:"answer",label:"Answer",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new ve({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[Ll]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};p&4&&(g.error=u[2]),!t&&p&2&&(t=!0,g.value=u[1],x(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=u[4]),!n&&p&8&&(n=!0,$.value=u[3],x(()=>n=!1)),s.$set($);const T={};p&513&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function Ul(i){let e,t,r,s;return e=new ie({props:{header:"Create Question"}}),r=new pe({props:{onSubmit:i[5],$$slots:{default:[Dl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&543&&(a.$$scope={dirty:o,ctx:n}),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Nl(i){let e,t;return e=new oe({props:{$$slots:{default:[Ul]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&543&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ql(i,e,t){let{params:r={chapter_id:0}}=e,s="",n="",o="",a="";const l=async()=>{t(2,n=ne(s)),t(4,a=ne(o)),!(n||a)&&(await $l(r.chapter_id,s,o),J("/questions/list/"+r.chapter_id))};function c(d){s=d,t(1,s)}function f(d){o=d,t(3,o)}const h=()=>J("/questions/list/"+r.chapter_id);return i.$$set=d=>{"params"in d&&t(0,r=d.params)},[r,s,n,o,a,l,c,f,h]}class Bl extends B{constructor(e){super(),q(this,e,ql,Nl,N,{params:0})}}function Yr(i,e,t){const r=i.slice();return r[6]=e[t],r}function Xr(i){let e,t=i[6]+"",r,s,n;return{c(){e=O("option"),r=R(t),e.__value=s=i[6],Je(e,e.__value),e.selected=n=i[6]===i[0]},m(o,a){S(o,e,a),b(e,r)},p(o,a){a&8&&t!==(t=o[6]+"")&&U(r,t),a&8&&s!==(s=o[6])&&(e.__value=s,Je(e,e.__value)),a&9&&n!==(n=o[6]===o[0])&&(e.selected=n)},d(o){o&&k(e)}}}function Fl(i){let e,t,r,s=ce(i[3]),n=[];for(let o=0;o<s.length;o+=1)n[o]=Xr(Yr(i,s,o));return{c(){e=O("select");for(let o=0;o<n.length;o+=1)n[o].c();C(e,"id",i[2]),C(e,"name",i[2]),C(e,"class","input"),i[0]===void 0&&mt(()=>i[5].call(e))},m(o,a){S(o,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);or(e,i[0],!0),t||(r=Ie(e,"change",i[5]),t=!0)},p(o,a){if(a&9){s=ce(o[3]);let l;for(l=0;l<s.length;l+=1){const c=Yr(o,s,l);n[l]?n[l].p(c,a):(n[l]=Xr(c),n[l].c(),n[l].m(e,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=s.length}a&4&&C(e,"id",o[2]),a&4&&C(e,"name",o[2]),a&9&&or(e,o[0])},d(o){o&&k(e),Ve(n,o),t=!1,r()}}}function Ml(i){let e,t;return e=new Xt({props:{id:i[2],label:i[1],error:i[4],$$slots:{default:[Fl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&4&&(n.id=r[2]),s&2&&(n.label=r[1]),s&16&&(n.error=r[4]),s&525&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function zl(i,e,t){let{label:r}=e,{id:s}=e,{value:n}=e,{options:o}=e,{error:a}=e;function l(){n=Nn(this),t(0,n),t(3,o)}return i.$$set=c=>{"label"in c&&t(1,r=c.label),"id"in c&&t(2,s=c.id),"value"in c&&t(0,n=c.value),"options"in c&&t(3,o=c.options),"error"in c&&t(4,a=c.error)},[n,r,s,o,a,l]}class Zr extends B{constructor(e){super(),q(this,e,zl,Ml,N,{label:1,id:2,value:0,options:3,error:4})}}function xr(i){let e,t,r=i[2].length+"",s;return{c(){e=O("div"),t=R("Length: "),s=R(r)},m(n,o){S(n,e,o),b(e,t),b(e,s)},p(n,o){o&4&&r!==(r=n[2].length+"")&&U(s,r)},d(n){n&&k(e)}}}function Hl(i){let e,t,r,s;return e=new z({props:{onClick:i[13],label:"Cancel"}}),r=new z({props:{label:"Start"}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment)},m(n,o){v(e,n,o),S(n,t,o),v(r,n,o),s=!0},p(n,o){const a={};o&2&&(a.onClick=n[13]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&k(t),w(e,n),w(r,n)}}}function Jl(i){let e,t,r,s,n,o,a,l;function c(u){i[11](u)}let f={id:"correct",label:"Correct Answers",options:i[6],error:i[5]};i[3]!==void 0&&(f.value=i[3]),e=new Zr({props:f}),Z.push(()=>ee(e,"value",c));function h(u){i[12](u)}let d={id:"reverse",label:"Reverse Answers",options:i[8],error:i[7]};return i[4]!==void 0&&(d.value=i[4]),s=new Zr({props:d}),Z.push(()=>ee(s,"value",h)),a=new X({props:{$$slots:{default:[Hl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),r=E(),y(s.$$.fragment),o=E(),y(a.$$.fragment)},m(u,p){v(e,u,p),S(u,r,p),v(s,u,p),S(u,o,p),v(a,u,p),l=!0},p(u,p){const g={};!t&&p&8&&(t=!0,g.value=u[3],x(()=>t=!1)),e.$set(g);const $={};!n&&p&16&&(n=!0,$.value=u[4],x(()=>n=!1)),s.$set($);const T={};p&16386&&(T.$$scope={dirty:p,ctx:u}),a.$set(T)},i(u){l||(m(e.$$.fragment,u),m(s.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(s.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(k(r),k(o)),w(e,u),w(s,u),w(a,u)}}}function Kl(i){let e,t,r,s,n,o,a;e=new ie({props:{header:"List Chapters"}}),r=new nr({props:{book:i[0],chapter:i[1]}});let l=i[1]&&xr(i);return o=new pe({props:{onSubmit:i[9],$$slots:{default:[Jl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),l&&l.c(),n=E(),y(o.$$.fragment)},m(c,f){v(e,c,f),S(c,t,f),v(r,c,f),S(c,s,f),l&&l.m(c,f),S(c,n,f),v(o,c,f),a=!0},p(c,f){const h={};f&1&&(h.book=c[0]),f&2&&(h.chapter=c[1]),r.$set(h),c[1]?l?l.p(c,f):(l=xr(c),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null);const d={};f&16410&&(d.$$scope={dirty:f,ctx:c}),o.$set(d)},i(c){a||(m(e.$$.fragment,c),m(r.$$.fragment,c),m(o.$$.fragment,c),a=!0)},o(c){_(e.$$.fragment,c),_(r.$$.fragment,c),_(o.$$.fragment,c),a=!1},d(c){c&&(k(t),k(s),k(n)),w(e,c),w(r,c),l&&l.d(c),w(o,c)}}}function Gl(i){let e,t;return e=new oe({props:{$$slots:{default:[Kl]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&16415&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Wl(i,e,t){let{params:r={id:0}}=e,s,n,o=[],a="1",l,c=["0","1","2","3"],f="false",h,d=["true","false"];de(async()=>{t(1,n=await tr(r.id)),n&&(t(2,o=await Et(n.id)),t(0,s=await wt(n.book_id)))});const u=async()=>{Ro(o,parseInt(a),f==="true"),J("/lession/process")};function p(T){a=T,t(3,a)}function g(T){f=T,t(4,f)}const $=()=>J("/chapters/list/"+(n==null?void 0:n.book_id));return i.$$set=T=>{"params"in T&&t(10,r=T.params)},[s,n,o,a,f,l,c,h,d,u,r,p,g,$]}class Vl extends B{constructor(e){super(),q(this,e,Wl,Gl,N,{params:10})}}function Ql(i){let e,t,r,s,n,o,a=i[0][0]+"",l,c,f,h,d,u,p=i[0][1]+"",g,$,T,L,P,A,j=i[0][2]+"",I,H,K,ae,sr,lt,ut=i[0][3]+"",Ct;return{c(){e=O("div"),t=O("table"),r=O("tr"),s=O("td"),s.textContent="No correct answers",n=E(),o=O("td"),l=R(a),c=E(),f=O("tr"),h=O("td"),h.textContent="One correct answer",d=E(),u=O("td"),g=R(p),$=E(),T=O("tr"),L=O("td"),L.textContent="Two correct answers",P=E(),A=O("td"),I=R(j),H=E(),K=O("tr"),ae=O("td"),ae.textContent="Learned",sr=E(),lt=O("td"),Ct=R(ut),C(s,"class","px-4 py-1 m-1 border-r border-gray-300"),C(o,"class","px-4 py-1 m-1"),C(r,"class",""),C(h,"class","px-4 py-1 m-1 border-r border-gray-300"),C(u,"class","px-4 py-1 m-1"),C(f,"class",""),C(L,"class","px-4 py-1 m-1 border-r border-gray-300"),C(A,"class","px-4 py-1 m-1"),C(T,"class",""),C(ae,"class","px-4 py-1 m-1 border-r border-gray-300"),C(lt,"class","px-4 py-1 m-1"),C(K,"class",""),C(e,"class","border border-gray-300 rounded shadow-sm max-w-60 py-3")},m(me,Le){S(me,e,Le),b(e,t),b(t,r),b(r,s),b(r,n),b(r,o),b(o,l),b(t,c),b(t,f),b(f,h),b(f,d),b(f,u),b(u,g),b(t,$),b(t,T),b(T,L),b(T,P),b(T,A),b(A,I),b(t,H),b(t,K),b(K,ae),b(K,sr),b(K,lt),b(lt,Ct)},p(me,[Le]){Le&1&&a!==(a=me[0][0]+"")&&U(l,a),Le&1&&p!==(p=me[0][1]+"")&&U(g,p),Le&1&&j!==(j=me[0][2]+"")&&U(I,j),Le&1&&ut!==(ut=me[0][3]+"")&&U(Ct,ut)},i:D,o:D,d(me){me&&k(e)}}}function Yl(i,e,t){let{progress:r}=e;return i.$$set=s=>{"progress"in s&&t(0,r=s.progress)},[r]}class Xl extends B{constructor(e){super(),q(this,e,Yl,Ql,N,{progress:0})}}function Zl(i){let e,t;return e=new jn({props:{question:i[1].question,showAnswer:i[3],progress:i[1].progress,reverse:i[0].reverse}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,s){const n={};s&2&&(n.question=r[1].question),s&8&&(n.showAnswer=r[3]),s&2&&(n.progress=r[1].progress),s&1&&(n.reverse=r[0].reverse),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function xl(i){let e;return{c(){e=O("p"),e.textContent="End"},m(t,r){S(t,e,r)},p:D,i:D,o:D,d(t){t&&k(e)}}}function en(i){let e,t,r=i[1]&&tn(i);return{c(){r&&r.c(),e=se()},m(s,n){r&&r.m(s,n),S(s,e,n),t=!0},p(s,n){s[1]?r?(r.p(s,n),n&2&&m(r,1)):(r=tn(s),r.c(),m(r,1),r.m(e.parentNode,e)):r&&(Q(),_(r,1,1,()=>{r=null}),Y())},i(s){t||(m(r),t=!0)},o(s){_(r),t=!1},d(s){s&&k(e),r&&r.d(s)}}}function tn(i){let e,t,r,s;const n=[tu,eu],o=[];function a(l,c){return l[3]?1:0}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,c){o[e].m(l,c),S(l,r,c),s=!0},p(l,c){let f=e;e=a(l),e===f?o[e].p(l,c):(Q(),_(o[f],1,1,()=>{o[f]=null}),Y(),t=o[e],t?t.p(l,c):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&k(r),o[e].d(l)}}}function eu(i){let e,t,r,s,n,o,a,l;return e=new z({props:{label:"Correct",onClick:i[6]}}),r=new z({props:{label:"Wrong",onClick:i[7]}}),n=new z({props:{label:"Learned",onClick:i[8]}}),a=new z({props:{label:"Skip",onClick:i[9]}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),y(n.$$.fragment),o=E(),y(a.$$.fragment)},m(c,f){v(e,c,f),S(c,t,f),v(r,c,f),S(c,s,f),v(n,c,f),S(c,o,f),v(a,c,f),l=!0},p:D,i(c){l||(m(e.$$.fragment,c),m(r.$$.fragment,c),m(n.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(r.$$.fragment,c),_(n.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(k(t),k(s),k(o)),w(e,c),w(r,c),w(n,c),w(a,c)}}}function tu(i){let e,t;return e=new z({props:{label:"Show",onClick:i[5]}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p:D,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ru(i){let e,t,r,s;e=new z({props:{label:"Stop",onClick:i[10]}});let n=!i[2]&&en(i);return{c(){y(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){v(e,o,a),S(o,t,a),n&&n.m(o,a),S(o,r,a),s=!0},p(o,a){o[2]?n&&(Q(),_(n,1,1,()=>{n=null}),Y()):n?(n.p(o,a),a&4&&m(n,1)):(n=en(o),n.c(),m(n,1),n.m(r.parentNode,r))},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(k(t),k(r)),w(e,o),n&&n.d(o)}}}function nu(i){let e,t,r,s,n,o,a,l,c;e=new ie({props:{header:"Lession"}}),r=new Xl({props:{progress:i[4]}});const f=[xl,Zl],h=[];function d(u,p){return u[2]?0:u[1]?1:-1}return~(n=d(i))&&(o=h[n]=f[n](i)),l=new X({props:{$$slots:{default:[ru]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment),t=E(),y(r.$$.fragment),s=E(),o&&o.c(),a=E(),y(l.$$.fragment)},m(u,p){v(e,u,p),S(u,t,p),v(r,u,p),S(u,s,p),~n&&h[n].m(u,p),S(u,a,p),v(l,u,p),c=!0},p(u,p){const g={};p&16&&(g.progress=u[4]),r.$set(g);let $=n;n=d(u),n===$?~n&&h[n].p(u,p):(o&&(Q(),_(h[$],1,1,()=>{h[$]=null}),Y()),~n?(o=h[n],o?o.p(u,p):(o=h[n]=f[n](u),o.c()),m(o,1),o.m(a.parentNode,a)):o=null);const T={};p&8206&&(T.$$scope={dirty:p,ctx:u}),l.$set(T)},i(u){c||(m(e.$$.fragment,u),m(r.$$.fragment,u),m(o),m(l.$$.fragment,u),c=!0)},o(u){_(e.$$.fragment,u),_(r.$$.fragment,u),_(o),_(l.$$.fragment,u),c=!1},d(u){u&&(k(t),k(s),k(a)),w(e,u),w(r,u),~n&&h[n].d(u),w(l,u)}}}function su(i){let e,t;return e=new oe({props:{$$slots:{default:[nu]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,[s]){const n={};s&8223&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function iu(i,e,t){let r,s,n=!1,o=!1,a=[0,0,0,0];const l=()=>{t(3,o=!0)},c=$=>{if(t(1,s.progress=$,s),s.progress<3?r.learning.push(s):r.learned.push(s),t(4,a=Pr(r)),!Lo(r)){t(2,n=!0);return}g()},f=()=>{c(s.progress+1)},h=()=>{c(0)},d=()=>{c(3)},u=()=>{c(s.progress)},p=()=>{J("/")},g=()=>{const $=r.learning.shift();$?(t(1,s=$),t(3,o=!1)):t(2,n=!0)};return de(()=>{const $=On();if(!$){W.setString("No lession found!");return}t(0,r=$),t(4,a=Pr(r)),g()}),[r,s,n,o,a,l,f,h,d,u,p]}class ou extends B{constructor(e){super(),q(this,e,iu,su,N,{})}}function rn(i){let e,t;return e=new jo({props:{error:i[0]}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p(r,s){const n={};s&1&&(n.error=r[0]),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function au(i){let e,t;return e=new Zn({props:{routes:i[1]}}),{c(){y(e.$$.fragment)},m(r,s){v(e,r,s),t=!0},p:D,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function lu(i){let e,t,r,s,n=i[0]!==null&&rn(i);return r=new Co({props:{navEntries:i[2],$$slots:{default:[au]},$$scope:{ctx:i}}}),{c(){e=O("main"),n&&n.c(),t=E(),y(r.$$.fragment),C(e,"class","text-gray-600 max-w-screen-lg m-auto mt-4")},m(o,a){S(o,e,a),n&&n.m(e,null),b(e,t),v(r,e,null),s=!0},p(o,[a]){o[0]!==null?n?(n.p(o,a),a&1&&m(n,1)):(n=rn(o),n.c(),m(n,1),n.m(e,t)):n&&(Q(),_(n,1,1,()=>{n=null}),Y());const l={};a&8&&(l.$$scope={dirty:a,ctx:o}),r.$set(l)},i(o){s||(m(n),m(r.$$.fragment,o),s=!0)},o(o){_(n),_(r.$$.fragment,o),s=!1},d(o){o&&k(e),n&&n.d(),w(r)}}}function uu(i,e,t){let r;return Ln(i,W,o=>t(0,r=o)),[r,{"/":zo,"/books/list":wa,"/books/create":ja,"/books/update/:id":Ua,"/chapters/list/:id":rl,"/chapters/create/:book_id":ll,"/chapters/update/:id":pl,"/questions/list/:id":Ol,"/questions/create/:chapter_id":Bl,"/questions/update/:id":Rl,"/lession/prepare/:id":Vl,"/lession/process":ou,"/cache":Zo,"*":ta},[{label:"Home",path:"#/"},{label:"Books",path:"#/books/list"},{label:"Cache",path:"#/cache"}]]}class cu extends B{constructor(e){super(),q(this,e,uu,lu,N,{})}}new cu({target:document.getElementById("app")});
