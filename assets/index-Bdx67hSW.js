var kn=Object.defineProperty;var Sn=(i,e,t)=>e in i?kn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var yt=(i,e,t)=>(Sn(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function L(){}function xe(i,e){for(const t in e)i[t]=e[t];return i}function Qr(i){return i()}function xt(){return Object.create(null)}function Ke(i){i.forEach(Qr)}function Ce(i){return typeof i=="function"}function N(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}function En(i){return Object.keys(i).length===0}function Yr(i,...e){if(i==null){for(const r of e)r(void 0);return L}const t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Cn(i,e,t){i.$$.on_destroy.push(Yr(e,t))}function Oe(i,e,t,r){if(i){const s=Xr(i,e,t,r);return i[0](s)}}function Xr(i,e,t,r){return i[1]&&r?xe(t.ctx.slice(),i[1](r(e))):t.ctx}function Te(i,e,t,r){if(i[2]&&r){const s=i[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const n=[],o=Math.max(e.dirty.length,s.length);for(let a=0;a<o;a+=1)n[a]=e.dirty[a]|s[a];return n}return e.dirty|s}return e.dirty}function Ae(i,e,t,r,s,n){if(s){const o=Xr(e,t,r,n);i.p(o,s)}}function je(i){if(i.ctx.length>32){const e=[],t=i.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function S(i,e){i.appendChild(e)}function k(i,e,t){i.insertBefore(e,t||null)}function y(i){i.parentNode&&i.parentNode.removeChild(i)}function Ge(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function O(i){return document.createElement(i)}function $e(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function R(i){return document.createTextNode(i)}function E(){return R(" ")}function se(){return R("")}function Pe(i,e,t,r){return i.addEventListener(e,t,r),()=>i.removeEventListener(e,t,r)}function On(i){return function(e){return e.preventDefault(),i.call(this,e)}}function C(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function Tn(i){return Array.from(i.childNodes)}function U(i,e){e=""+e,i.data!==e&&(i.data=e)}function ze(i,e){i.value=e??""}function er(i,e,t){for(let r=0;r<i.options.length;r+=1){const s=i.options[r];if(s.__value===e){s.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function An(i){const e=i.querySelector(":checked");return e&&e.__value}function jn(i,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(i,{detail:e,bubbles:t,cancelable:r})}function ct(i,e){return new i(e)}let et;function Ye(i){et=i}function pt(){if(!et)throw new Error("Function called outside component initialization");return et}function he(i){pt().$$.on_mount.push(i)}function Pn(i){pt().$$.after_update.push(i)}function In(i){pt().$$.on_destroy.push(i)}function Rn(){const i=pt();return(e,t,{cancelable:r=!1}={})=>{const s=i.$$.callbacks[e];if(s){const n=jn(e,t,{cancelable:r});return s.slice().forEach(o=>{o.call(i,n)}),!n.defaultPrevented}return!0}}function tr(i,e){const t=i.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const qe=[],Z=[];let Fe=[];const jt=[],Zr=Promise.resolve();let Pt=!1;function xr(){Pt||(Pt=!0,Zr.then(tn))}function en(){return xr(),Zr}function ft(i){Fe.push(i)}function ee(i){jt.push(i)}const kt=new Set;let Re=0;function tn(){if(Re!==0)return;const i=et;do{try{for(;Re<qe.length;){const e=qe[Re];Re++,Ye(e),Ln(e.$$)}}catch(e){throw qe.length=0,Re=0,e}for(Ye(null),qe.length=0,Re=0;Z.length;)Z.pop()();for(let e=0;e<Fe.length;e+=1){const t=Fe[e];kt.has(t)||(kt.add(t),t())}Fe.length=0}while(qe.length);for(;jt.length;)jt.pop()();Pt=!1,kt.clear(),Ye(i)}function Ln(i){if(i.fragment!==null){i.update(),Ke(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(ft)}}function Dn(i){const e=[],t=[];Fe.forEach(r=>i.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Fe=e}const ut=new Set;let Se;function Y(){Se={r:0,c:[],p:Se}}function X(){Se.r||Ke(Se.c),Se=Se.p}function m(i,e){i&&i.i&&(ut.delete(i),i.i(e))}function _(i,e,t,r){if(i&&i.o){if(ut.has(i))return;ut.add(i),Se.c.push(()=>{ut.delete(i),r&&(t&&i.d(1),r())}),i.o(e)}else r&&r()}function ue(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}function ht(i,e){const t={},r={},s={$$scope:1};let n=i.length;for(;n--;){const o=i[n],a=e[n];if(a){for(const l in o)l in a||(r[l]=1);for(const l in a)s[l]||(t[l]=a[l],s[l]=1);i[n]=a}else for(const l in o)s[l]=1}for(const o in r)o in t||(t[o]=void 0);return t}function dt(i){return typeof i=="object"&&i!==null?i:{}}function te(i,e,t){const r=i.$$.props[e];r!==void 0&&(i.$$.bound[r]=t,t(i.$$.ctx[r]))}function v(i){i&&i.c()}function b(i,e,t){const{fragment:r,after_update:s}=i.$$;r&&r.m(e,t),ft(()=>{const n=i.$$.on_mount.map(Qr).filter(Ce);i.$$.on_destroy?i.$$.on_destroy.push(...n):Ke(n),i.$$.on_mount=[]}),s.forEach(ft)}function w(i,e){const t=i.$$;t.fragment!==null&&(Dn(t.after_update),Ke(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Un(i,e){i.$$.dirty[0]===-1&&(qe.push(i),xr(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function q(i,e,t,r,s,n,o=null,a=[-1]){const l=et;Ye(i);const u=i.$$={fragment:null,ctx:[],props:n,update:L,not_equal:s,bound:xt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:xt(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let f=!1;if(u.ctx=t?t(i,e.props||{},(h,d,...c)=>{const p=c.length?c[0]:d;return u.ctx&&s(u.ctx[h],u.ctx[h]=p)&&(!u.skip_bound&&u.bound[h]&&u.bound[h](p),f&&Un(i,h)),d}):[],u.update(),f=!0,Ke(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const h=Tn(e.target);u.fragment&&u.fragment.l(h),h.forEach(y)}else u.fragment&&u.fragment.c();e.intro&&m(i.$$.fragment),b(i,e.target,e.anchor),tn()}Ye(l)}class B{constructor(){yt(this,"$$");yt(this,"$$set")}$destroy(){w(this,1),this.$destroy=L}$on(e,t){if(!Ce(t))return L;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!En(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Nn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Nn);const Le=[];function rn(i,e){return{subscribe:qt(i,e).subscribe}}function qt(i,e=L){let t;const r=new Set;function s(a){if(N(i,a)&&(i=a,t)){const l=!Le.length;for(const u of r)u[1](),Le.push(u,i);if(l){for(let u=0;u<Le.length;u+=2)Le[u][0](Le[u+1]);Le.length=0}}}function n(a){s(a(i))}function o(a,l=L){const u=[a,l];return r.add(u),r.size===1&&(t=e(s,n)||L),a(i),()=>{r.delete(u),r.size===0&&t&&(t(),t=null)}}return{set:s,update:n,subscribe:o}}function nn(i,e,t){const r=!Array.isArray(i),s=r?[i]:i;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const n=e.length<2;return rn(t,(o,a)=>{let l=!1;const u=[];let f=0,h=L;const d=()=>{if(f)return;h();const p=e(r?u[0]:u,o,a);n?o(p):h=Ce(p)?p:L},c=s.map((p,g)=>Yr(p,$=>{u[g]=$,f&=~(1<<g),l&&d()},()=>{f|=1<<g}));return l=!0,d(),function(){Ke(c),h(),l=!1}})}function qn(i,e){if(i instanceof RegExp)return{keys:!1,pattern:i};var t,r,s,n,o=[],a="",l=i.split("/");for(l[0]||l.shift();s=l.shift();)t=s[0],t==="*"?(o.push("wild"),a+="/(.*)"):t===":"?(r=s.indexOf("?",1),n=s.indexOf(".",1),o.push(s.substring(1,~r?r:~n?n:s.length)),a+=~r&&!~n?"(?:/([^/]+?))?":"/([^/]+?)",~n&&(a+=(~r?"?":"")+"\\"+s.substring(n))):a+="/"+s;return{keys:o,pattern:new RegExp("^"+a+"/?$","i")}}function Bn(i){let e,t,r;const s=[i[2]];var n=i[0];function o(a,l){let u={};for(let f=0;f<s.length;f+=1)u=xe(u,s[f]);return l!==void 0&&l&4&&(u=xe(u,ht(s,[dt(a[2])]))),{props:u}}return n&&(e=ct(n,o(i)),e.$on("routeEvent",i[7])),{c(){e&&v(e.$$.fragment),t=se()},m(a,l){e&&b(e,a,l),k(a,t,l),r=!0},p(a,l){if(l&1&&n!==(n=a[0])){if(e){Y();const u=e;_(u.$$.fragment,1,0,()=>{w(u,1)}),X()}n?(e=ct(n,o(a,l)),e.$on("routeEvent",a[7]),v(e.$$.fragment),m(e.$$.fragment,1),b(e,t.parentNode,t)):e=null}else if(n){const u=l&4?ht(s,[dt(a[2])]):{};e.$set(u)}},i(a){r||(e&&m(e.$$.fragment,a),r=!0)},o(a){e&&_(e.$$.fragment,a),r=!1},d(a){a&&y(t),e&&w(e,a)}}}function Fn(i){let e,t,r;const s=[{params:i[1]},i[2]];var n=i[0];function o(a,l){let u={};for(let f=0;f<s.length;f+=1)u=xe(u,s[f]);return l!==void 0&&l&6&&(u=xe(u,ht(s,[l&2&&{params:a[1]},l&4&&dt(a[2])]))),{props:u}}return n&&(e=ct(n,o(i)),e.$on("routeEvent",i[6])),{c(){e&&v(e.$$.fragment),t=se()},m(a,l){e&&b(e,a,l),k(a,t,l),r=!0},p(a,l){if(l&1&&n!==(n=a[0])){if(e){Y();const u=e;_(u.$$.fragment,1,0,()=>{w(u,1)}),X()}n?(e=ct(n,o(a,l)),e.$on("routeEvent",a[6]),v(e.$$.fragment),m(e.$$.fragment,1),b(e,t.parentNode,t)):e=null}else if(n){const u=l&6?ht(s,[l&2&&{params:a[1]},l&4&&dt(a[2])]):{};e.$set(u)}},i(a){r||(e&&m(e.$$.fragment,a),r=!0)},o(a){e&&_(e.$$.fragment,a),r=!1},d(a){a&&y(t),e&&w(e,a)}}}function Mn(i){let e,t,r,s;const n=[Fn,Bn],o=[];function a(l,u){return l[1]?0:1}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,u){o[e].m(l,u),k(l,r,u),s=!0},p(l,[u]){let f=e;e=a(l),e===f?o[e].p(l,u):(Y(),_(o[f],1,1,()=>{o[f]=null}),X(),t=o[e],t?t.p(l,u):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&y(r),o[e].d(l)}}}function rr(){const i=window.location.href.indexOf("#/");let e=i>-1?window.location.href.substr(i+1):"/";const t=e.indexOf("?");let r="";return t>-1&&(r=e.substr(t+1),e=e.substr(0,t)),{location:e,querystring:r}}const Bt=rn(null,function(e){e(rr());const t=()=>{e(rr())};return window.addEventListener("hashchange",t,!1),function(){window.removeEventListener("hashchange",t,!1)}});nn(Bt,i=>i.location);nn(Bt,i=>i.querystring);const nr=qt(void 0);async function J(i){if(!i||i.length<1||i.charAt(0)!="/"&&i.indexOf("#/")!==0)throw Error("Invalid parameter location");await en(),history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=(i.charAt(0)=="#"?"":"#")+i}function zn(i){i?window.scrollTo(i.__svelte_spa_router_scrollX,i.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Hn(i,e,t){let{routes:r={}}=e,{prefix:s=""}=e,{restoreScrollState:n=!1}=e;class o{constructor(j,I){if(!I||typeof I!="function"&&(typeof I!="object"||I._sveltesparouter!==!0))throw Error("Invalid component object");if(!j||typeof j=="string"&&(j.length<1||j.charAt(0)!="/"&&j.charAt(0)!="*")||typeof j=="object"&&!(j instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:H,keys:W}=qn(j);this.path=j,typeof I=="object"&&I._sveltesparouter===!0?(this.component=I.component,this.conditions=I.conditions||[],this.userData=I.userData,this.props=I.props||{}):(this.component=()=>Promise.resolve(I),this.conditions=[],this.props={}),this._pattern=H,this._keys=W}match(j){if(s){if(typeof s=="string")if(j.startsWith(s))j=j.substr(s.length)||"/";else return null;else if(s instanceof RegExp){const pe=j.match(s);if(pe&&pe[0])j=j.substr(pe[0].length)||"/";else return null}}const I=this._pattern.exec(j);if(I===null)return null;if(this._keys===!1)return I;const H={};let W=0;for(;W<this._keys.length;){try{H[this._keys[W]]=decodeURIComponent(I[W+1]||"")||null}catch{H[this._keys[W]]=null}W++}return H}async checkConditions(j){for(let I=0;I<this.conditions.length;I++)if(!await this.conditions[I](j))return!1;return!0}}const a=[];r instanceof Map?r.forEach((A,j)=>{a.push(new o(j,A))}):Object.keys(r).forEach(A=>{a.push(new o(A,r[A]))});let l=null,u=null,f={};const h=Rn();async function d(A,j){await en(),h(A,j)}let c=null,p=null;n&&(p=A=>{A.state&&(A.state.__svelte_spa_router_scrollY||A.state.__svelte_spa_router_scrollX)?c=A.state:c=null},window.addEventListener("popstate",p),Pn(()=>{zn(c)}));let g=null,$=null;const T=Bt.subscribe(async A=>{g=A;let j=0;for(;j<a.length;){const I=a[j].match(A.location);if(!I){j++;continue}const H={route:a[j].path,location:A.location,querystring:A.querystring,userData:a[j].userData,params:I&&typeof I=="object"&&Object.keys(I).length?I:null};if(!await a[j].checkConditions(H)){t(0,l=null),$=null,d("conditionsFailed",H);return}d("routeLoading",Object.assign({},H));const W=a[j].component;if($!=W){W.loading?(t(0,l=W.loading),$=W,t(1,u=W.loadingParams),t(2,f={}),d("routeLoaded",Object.assign({},H,{component:l,name:l.name,params:u}))):(t(0,l=null),$=null);const pe=await W();if(A!=g)return;t(0,l=pe&&pe.default||pe),$=W}I&&typeof I=="object"&&Object.keys(I).length?t(1,u=I):t(1,u=null),t(2,f=a[j].props),d("routeLoaded",Object.assign({},H,{component:l,name:l.name,params:u})).then(()=>{nr.set(u)});return}t(0,l=null),$=null,nr.set(void 0)});In(()=>{T(),p&&window.removeEventListener("popstate",p)});function D(A){tr.call(this,i,A)}function P(A){tr.call(this,i,A)}return i.$$set=A=>{"routes"in A&&t(3,r=A.routes),"prefix"in A&&t(4,s=A.prefix),"restoreScrollState"in A&&t(5,n=A.restoreScrollState)},i.$$.update=()=>{i.$$.dirty&32&&(history.scrollRestoration=n?"manual":"auto")},[l,u,f,r,s,n,D,P]}class Jn extends B{constructor(e){super(),q(this,e,Hn,Mn,N,{routes:3,prefix:4,restoreScrollState:5})}}function Kn(){const{subscribe:i,set:e,update:t}=qt(null);return{subscribe:i,setDBError:r=>e({msg:r.message,details:r.details}),setAuthError:r=>{e({msg:r.message})},setString:r=>e({msg:r}),reset:()=>e(null)}}const G=Kn(),Gn="modulepreload",Wn=function(i,e){return new URL(i,e).href},sr={},He=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const n=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.all(t.map(l=>{if(l=Wn(l,r),l in sr)return;sr[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(!!r)for(let c=n.length-1;c>=0;c--){const p=n[c];if(p.href===l&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Gn,u||(d.as="script",d.crossOrigin=""),d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((c,p)=>{d.addEventListener("load",c),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}return s.then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})},Vn=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>He(()=>Promise.resolve().then(()=>st),void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ft extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Qn extends Ft{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Yn extends Ft{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Xn extends Ft{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var It;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(It||(It={}));var Zn=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};class xn{constructor(e,{headers:t={},customFetch:r,region:s=It.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Vn(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Zn(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let u;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const f=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:u}).catch(p=>{throw new Qn(p)}),h=f.headers.get("x-relay-error");if(h&&h==="true")throw new Yn(f);if(!f.ok)throw new Xn(f);let d=((r=f.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),c;return d==="application/json"?c=yield f.json():d==="application/octet-stream"?c=yield f.blob():d==="text/event-stream"?c=f:d==="multipart/form-data"?c=yield f.formData():c=yield f.text(),{data:c,error:null}}catch(s){return{data:null,error:s}}})}}var es=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Je=es();const ts=Je.fetch,Mt=Je.fetch.bind(Je),sn=Je.Headers,rs=Je.Request,ns=Je.Response,st=Object.freeze(Object.defineProperty({__proto__:null,Headers:sn,Request:rs,Response:ns,default:Mt,fetch:ts},Symbol.toStringTag,{value:"Module"}));class ss extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class is{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Mt:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,l;let u=null,f=null,h=null,d=n.status,c=n.statusText;if(n.ok){if(this.method!=="HEAD"){const T=await n.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?f=T:f=JSON.parse(T))}const g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),$=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&$&&$.length>1&&(h=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(u={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,d=406,c="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const g=await n.text();try{u=JSON.parse(g),Array.isArray(u)&&n.status===404&&(f=[],u=null,d=200,c="OK")}catch{n.status===404&&g===""?(d=204,c="No Content"):u={message:g}}if(u&&this.isMaybeSingle&&(!((l=u==null?void 0:u.details)===null||l===void 0)&&l.includes("0 rows"))&&(u=null,d=200,c="OK"),u&&this.shouldThrowOnError)throw new ss(u)}return{error:u,data:f,count:h,status:d,statusText:c}});return this.shouldThrowOnError||(s=s.catch(n=>{var o,a,l;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class os extends is{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),u=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Be extends os{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class as{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Be({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Be({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((u,f)=>u.concat(Object.keys(f)),[]);if(l.length>0){const u=[...new Set(l)].map(f=>`"${f}"`);this.url.searchParams.set("columns",u.join(","))}}return new Be({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Be({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Be({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const ls="1.15.2",us={"X-Client-Info":`postgrest-js/${ls}`};class zt{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},us),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new as(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new zt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{a.searchParams.append(f,h)})):(o="POST",l=t);const u=Object.assign({},this.headers);return n&&(u.Prefer=`count=${n}`),new Be({method:o,url:a,headers:u,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const cs="2.9.5",fs={"X-Client-Info":`realtime-js/${cs}`},hs="1.0.0",on=1e4,ds=1e3;var Me;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Me||(Me={}));var ae;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(ae||(ae={}));var fe;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(fe||(fe={}));var Rt;(function(i){i.websocket="websocket"})(Rt||(Rt={}));var ke;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(ke||(ke={}));class an{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class ps{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const l=r.decode(e.slice(o,o+n));o=o+n;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:u}}}class St{constructor(e,t,r={},s=on){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ir;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(ir||(ir={}));class Xe{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Xe.syncState(this.state,s,n,o),this.pendingDiffs.forEach(l=>{this.state=Xe.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Xe.syncDiff(this.state,s,n,o),a())}),this.onJoin((s,n,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:o})}),this.onLeave((s,n,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(n,(u,f)=>{o[u]||(l[u]=f)}),this.map(o,(u,f)=>{const h=n[u];if(h){const d=f.map($=>$.presence_ref),c=h.map($=>$.presence_ref),p=f.filter($=>c.indexOf($.presence_ref)<0),g=h.filter($=>d.indexOf($.presence_ref)<0);p.length>0&&(a[u]=p),g.length>0&&(l[u]=g)}else a[u]=f}),this.syncDiff(n,{joins:a,leaves:l},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(a,l)=>{var u;const f=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),f.length>0){const h=e[a].map(c=>c.presence_ref),d=f.filter(c=>h.indexOf(c.presence_ref)<0);e[a].unshift(...d)}r(a,f,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const f=l.map(h=>h.presence_ref);u=u.filter(h=>f.indexOf(h.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var K;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(K||(K={}));const or=(i,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,o)=>(n[o]=ms(o,i,e,s),n),{})},ms=(i,e,t,r)=>{const s=e.find(a=>a.name===i),n=s==null?void 0:s.type,o=t[i];return n&&!r.includes(n)?ln(n,o):Lt(o)},ln=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return bs(e,t)}switch(i){case K.bool:return _s(e);case K.float4:case K.float8:case K.int2:case K.int4:case K.int8:case K.numeric:case K.oid:return gs(e);case K.json:case K.jsonb:return $s(e);case K.timestamp:return ws(e);case K.abstime:case K.date:case K.daterange:case K.int4range:case K.int8range:case K.money:case K.reltime:case K.text:case K.time:case K.timestamptz:case K.timetz:case K.tsrange:case K.tstzrange:return Lt(e);default:return Lt(e)}},Lt=i=>i,_s=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},gs=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},$s=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},bs=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let n;const o=i.slice(1,t);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>ln(e,a))}return i},ws=i=>typeof i=="string"?i.replace(" ","T"):i;var ar;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(ar||(ar={}));var lr;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes"})(lr||(lr={}));var ur;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(ur||(ur={}));class Ht{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ae.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new St(this,fe.join,this.params,this.timeout),this.rejoinTimer=new an(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ae.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ae.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ae.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ae.errored,this.rejoinTimer.scheduleTimeout())}),this._on(fe.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new Xe(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));const a={},l={broadcast:n,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var f;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,d=(f=h==null?void 0:h.length)!==null&&f!==void 0?f:0,c=[];for(let p=0;p<d;p++){const g=h[p],{filter:{event:$,schema:T,table:D,filter:P}}=g,A=u&&u[p];if(A&&A.event===$&&A.schema===T&&A.table===D&&A.filter===P)c.push(Object.assign(Object.assign({},g),{id:A.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=c,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:o}=e,a={method:"POST",headers:{apikey:(r=this.socket.apiKey)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=t.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),u.receive("ok",()=>n("ok")),u.receive("error",()=>n("error")),u.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ae.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(fe.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new St(this,fe.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new St(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:f}=fe;if(r&&[a,l,u,f].indexOf(o)>=0&&r!==this._joinRef())return;let d=this._onMessage(o,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(c=>{var p,g,$;return((p=c.filter)===null||p===void 0?void 0:p.event)==="*"||(($=(g=c.filter)===null||g===void 0?void 0:g.event)===null||$===void 0?void 0:$.toLocaleLowerCase())===o}).map(c=>c.callback(d,r)):(n=this.bindings[o])===null||n===void 0||n.filter(c=>{var p,g,$,T,D,P;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in c){const A=c.id,j=(p=c.filter)===null||p===void 0?void 0:p.event;return A&&((g=t.ids)===null||g===void 0?void 0:g.includes(A))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===(($=t.data)===null||$===void 0?void 0:$.type.toLocaleLowerCase()))}else{const A=(D=(T=c==null?void 0:c.filter)===null||T===void 0?void 0:T.event)===null||D===void 0?void 0:D.toLocaleLowerCase();return A==="*"||A===((P=t==null?void 0:t.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return c.type.toLocaleLowerCase()===o}).map(c=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:g,table:$,commit_timestamp:T,type:D,errors:P}=p;d=Object.assign(Object.assign({},{schema:g,table:$,commit_timestamp:T,eventType:D,new:{},old:{},errors:P}),this._getPayloadRecords(p))}c.callback(d,r)})}_isClosed(){return this.state===ae.closed}_isJoined(){return this.state===ae.joined}_isJoining(){return this.state===ae.joining}_isLeaving(){return this.state===ae.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&Ht.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(fe.close,{},e)}_onError(e){this._on(fe.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ae.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=or(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=or(e.columns,e.old_record)),t}}const vs=()=>{},ys=typeof WebSocket<"u";class ks{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=fs,this.params={},this.timeout=on,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=vs,this.conn=null,this.sendBuffer=[],this.serializer=new ps,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>He(()=>Promise.resolve().then(()=>st),void 0,import.meta.url).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Rt.websocket}`,t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,o)=>o(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new an(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(ys){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Ss(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),He(()=>import("./browser-BImCA5dO.js").then(e=>e.b),[],import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Me.connecting:return ke.Connecting;case Me.open:return ke.Open;case Me.closing:return ke.Closing;default:return ke.Closed}}isConnected(){return this.connectionState()===ke.Open}channel(e,t={config:{}}){const r=new Ht(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:n}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(fe.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:hs}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:n,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===(n==null?void 0:n.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(fe.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(ds,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Ss{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Me.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Jt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function x(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Es extends Jt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class cr extends Jt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Cs=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};const un=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>He(()=>Promise.resolve().then(()=>st),void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Os=()=>Cs(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield He(()=>Promise.resolve().then(()=>st),void 0,import.meta.url)).Response:Response});var We=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};const Et=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Ts=(i,e)=>We(void 0,void 0,void 0,function*(){const t=yield Os();i instanceof t?i.json().then(r=>{e(new Es(Et(r),i.status||500))}).catch(r=>{e(new cr(Et(r),r))}):e(new cr(Et(i),i))}),As=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function mt(i,e,t,r,s,n){return We(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(t,As(e,r,s,n)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Ts(l,a))})})}function Dt(i,e,t,r){return We(this,void 0,void 0,function*(){return mt(i,"GET",e,t,r)})}function _e(i,e,t,r,s){return We(this,void 0,void 0,function*(){return mt(i,"POST",e,r,s,t)})}function js(i,e,t,r,s){return We(this,void 0,void 0,function*(){return mt(i,"PUT",e,r,s,t)})}function cn(i,e,t,r,s){return We(this,void 0,void 0,function*(){return mt(i,"DELETE",e,r,s,t)})}var le=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};const Ps={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Is{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=un(s)}uploadOrUpdate(e,t,r,s){return le(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},fr),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl)):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),f=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:n,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),h=yield f.json();return f.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(n){if(x(n))return{data:null,error:n};throw n}})}upload(e,t,r){return le(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return le(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:fr.upsert},s),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl)):(l=r,f["cache-control"]=`max-age=${u.cacheControl}`,f["content-type"]=u.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:f}),d=yield h.json();return h.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(x(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return le(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield _e(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),n=s.searchParams.get("token");if(!n)throw new Jt("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:n},error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}update(e,t,r){return le(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return le(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(x(r))return{data:null,error:r};throw r}})}copy(e,t){return le(this,void 0,void 0,function*(){try{return{data:{path:(yield _e(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(x(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return le(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield _e(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return le(this,void 0,void 0,function*(){try{const s=yield _e(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}download(e,t){return le(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Dt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(x(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&s.push(n);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${u}`)}}}remove(e){return le(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}list(e,t,r){return le(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Ps),t),{prefix:e||""});return{data:yield _e(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Rs="2.5.5",Ls={"X-Client-Info":`storage-js/${Rs}`};var De=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};class Ds{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Ls),t),this.fetch=un(r)}listBuckets(){return De(this,void 0,void 0,function*(){try{return{data:yield Dt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}getBucket(e){return De(this,void 0,void 0,function*(){try{return{data:yield Dt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return De(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(x(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return De(this,void 0,void 0,function*(){try{return{data:yield js(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(x(r))return{data:null,error:r};throw r}})}emptyBucket(e){return De(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}deleteBucket(e){return De(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}}class Us extends Ds{constructor(e,t={},r){super(e,t,r)}from(e){return new Is(this.url,this.headers,e,this.fetch)}}const Ns="2.43.4";let Qe="";typeof Deno<"u"?Qe="deno":typeof document<"u"?Qe="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Qe="react-native":Qe="node";const qs={"X-Client-Info":`supabase-js-${Qe}/${Ns}`},Bs={headers:qs},Fs={schema:"public"},Ms={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},zs={};var Hs=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};const Js=i=>{let e;return i?e=i:typeof fetch>"u"?e=Mt:e=fetch,(...t)=>e(...t)},Ks=()=>typeof Headers>"u"?sn:Headers,Gs=(i,e,t)=>{const r=Js(t),s=Ks();return(n,o)=>Hs(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:i;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",i),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},o),{headers:u}))})};function Ws(i){return i.replace(/\/$/,"")}function Vs(i,e){const{db:t,auth:r,realtime:s,global:n}=i,{db:o,auth:a,realtime:l,global:u}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},u),n)}}const fn="2.64.2",Qs="http://localhost:9999",Ys="supabase.auth.token",Xs={"X-Client-Info":`gotrue-js/${fn}`},hr=10,Ut="X-Supabase-Api-Version",hn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Zs(i){return Math.round(Date.now()/1e3)+i}function xs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const ce=()=>typeof document<"u",we={tested:!1,writable:!1},Ze=()=>{if(!ce())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(we.tested)return we.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),we.tested=!0,we.writable=!0}catch{we.tested=!0,we.writable=!1}return we.writable};function Ct(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,n)=>{e[n]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const dn=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>He(()=>Promise.resolve().then(()=>st),void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ei=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",pn=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},ot=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ot=async(i,e)=>{await i.removeItem(e)};function ti(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,n,o,a,l,u,f=0;for(i=i.replace("-","+").replace("_","/");f<i.length;)o=e.indexOf(i.charAt(f++)),a=e.indexOf(i.charAt(f++)),l=e.indexOf(i.charAt(f++)),u=e.indexOf(i.charAt(f++)),r=o<<2|a>>4,s=(a&15)<<4|l>>2,n=(l&3)<<6|u,t=t+String.fromCharCode(r),l!=64&&s!=0&&(t=t+String.fromCharCode(s)),u!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class _t{constructor(){this.promise=new _t.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}_t.promiseConstructor=Promise;function dr(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(ti(r))}async function ri(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function ni(i,e){return new Promise((r,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await i(n);if(!e(n,null,o)){r(o);return}}catch(o){if(!e(n,o)){s(o);return}}})()})}function si(i){return("0"+i.toString(16)).substr(-2)}function ii(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let n=0;n<56;n++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,si).join("")}async function oi(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}function ai(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function li(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await oi(i);return ai(t)}async function Ue(i,e,t=!1){const r=ii();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await pn(i,`${e}-code-verifier`,s);const n=await li(r);return[n,r===n?"plain":"s256"]}const ui=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ci(i){const e=i.headers.get(Ut);if(!e||!e.match(ui))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Kt extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function F(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class fi extends Kt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function hi(i){return F(i)&&i.name==="AuthApiError"}class mn extends Kt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ie extends Kt{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class ve extends Ie{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Tt extends Ie{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class at extends Ie{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class lt extends Ie{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class pr extends Ie{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Nt extends Ie{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function At(i){return F(i)&&i.name==="AuthRetryableFetchError"}class mr extends Ie{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var di=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};const ye=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),pi=[502,503,504];async function _r(i){var e;if(!ei(i))throw new Nt(ye(i),0);if(pi.includes(i.status))throw new Nt(ye(i),i.status);let t;try{t=await i.json()}catch(n){throw new mn(ye(n),n)}let r;const s=ci(i);if(s&&s.getTime()>=hn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new mr(ye(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new mr(ye(t),i.status,t.weak_password.reasons);throw new fi(ye(t),i.status||500,r)}const mi=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function M(i,e,t,r){var s;const n=Object.assign({},r==null?void 0:r.headers);n[Ut]||(n[Ut]=hn["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await _i(i,e,t+a,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function _i(i,e,t,r,s,n){const o=mi(e,r,s,n);let a;try{a=await i(t,Object.assign({},o))}catch(l){throw console.error(l),new Nt(ye(l),0)}if(a.ok||await _r(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await _r(l)}}function me(i){var e;let t=null;wi(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=Zs(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function gr(i){const e=me(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function ge(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function gi(i){return{data:i,error:null}}function $i(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n}=i,o=di(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function bi(i){return i}function wi(i){return i.access_token&&i.refresh_token&&i.expires_in}var vi=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};class yi{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=dn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await M(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await M(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ge})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=vi(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await M(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:$i,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(F(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await M(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ge})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},f=await M(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:bi});if(f.error)throw f.error;const h=await f.json(),d=(o=f.headers.get("x-total-count"))!==null&&o!==void 0?o:0,c=(l=(a=f.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return c.length>0&&(c.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),$=JSON.parse(p.split(";")[1].split("=")[1]);u[`${$}Page`]=g}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(F(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await M(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ge})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await M(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ge})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await M(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ge})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await M(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(F(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await M(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}}}const ki={getItem:i=>Ze()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{Ze()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{Ze()&&globalThis.localStorage.removeItem(i)}};function $r(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function Si(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ne={debug:!!(globalThis&&Ze()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _n extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ei extends _n{}async function Ci(i,e,t){Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Ei(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Ne.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Si();const Oi={url:Qs,storageKey:Ys,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Xs,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Ve=30*1e3,br=3;async function wr(i,e,t){return await t()}class tt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=tt.nextInstanceID,tt.nextInstanceID+=1,this.instanceID>0&&ce()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Oi),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new yi({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=dn(s.fetch),this.lock=s.lock||wr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ce()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ci:this.lock=wr,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Ze()?this.storage=ki:(this.memoryStorage={},this.storage=$r(this.memoryStorage)):(this.memoryStorage={},this.storage=$r(this.memoryStorage)),ce()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${fn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=ce()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),(r==null?void 0:r.message)==="Identity is already linked"||(r==null?void 0:r.message)==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return F(e)?{error:e}:{error:new mn("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{await this._removeSession();const n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:me}),{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{await this._removeSession();let n;if("email"in e){const{email:f,password:h,options:d}=e;let c=null,p=null;this.flowType==="pkce"&&([c,p]=await Ue(this.storage,this.storageKey)),n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:f,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:c,code_challenge_method:p},xform:me})}else if("phone"in e){const{phone:f,password:h,options:d}=e;n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:f,password:h,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:me})}else throw new at("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(F(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:n,password:o,options:a}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:gr})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:gr})}else throw new at("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Tt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await ot(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/"),{data:n,error:o}=await M(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:me});return await Ot(this.storage,`${this.storageKey}-code-verifier`),o?{data:{user:null,session:null,redirectType:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Tt}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:o})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:n,nonce:o}=e,a=await M(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:me}),{data:l,error:u}=a;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Tt}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,o;try{if(await this._removeSession(),"email"in e){const{email:a,options:l}=e;let u=null,f=null;this.flowType==="pkce"&&([u,f]=await Ue(this.storage,this.storageKey));const{error:h}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:f},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:f}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:f}}throw new at("You must provide either an email or phone number.")}catch(a){if(F(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,n;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await M(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:me});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(s){if(F(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{await this._removeSession();let n=null,o=null;return this.flowType==="pkce"&&([n,o]=await Ue(this.storage,this.storageKey)),await M(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:gi})}catch(n){if(F(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ve;const{error:s}=await M(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(F(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:o}=await M(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:n}=e,{data:o,error:a}=await M(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new at("You must provide either an email or phone number and a type")}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ot(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){const o=this.suppressGetSessionWarning;e=new Proxy(e,{get(l,u,f){return!o&&u==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(l,u,f)}})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ge}):await this._useSession(async t=>{var r,s,n;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ve}:await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0,xform:ge})})}catch(t){if(F(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new ve;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Ue(this.storage,this.storageKey));const{data:u,error:f}=await M(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:ge});if(f)throw f;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(F(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return dr(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ve;const t=Date.now()/1e3;let r=t,s=!0,n=null;const o=dr(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(F(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new ve;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(F(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!ce())throw new lt("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new lt("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new pr("Not a valid PKCE flow url.");const t=Ct(window.location.href);if(e){if(!t.code)throw new pr("No code detected.");const{data:D,error:P}=await this._exchangeCodeForSession(t.code);if(P)throw P;const A=new URL(window.location.href);return A.searchParams.delete("code"),window.history.replaceState(window.history.state,"",A.toString()),{data:{session:D.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new lt(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=t;if(!n||!a||!o||!u)throw new lt("No session defined in URL");const f=Math.round(Date.now()/1e3),h=parseInt(a);let d=f+h;l&&(d=parseInt(l));const c=d-f;c*1e3<=Ve&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${c}s, should have been closer to ${h}s`);const p=d-h;f-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,f):f-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,d,f);const{data:g,error:$}=await this._getUser(n);if($)throw $;const T={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:d,refresh_token:o,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:T,redirectType:t.type},error:null}}catch(t){if(F(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Ct(window.location.href);return!!(ce()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Ct(window.location.href),t=await ot(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(hi(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Ot(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=xs(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:n},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Ue(this.storage,this.storageKey,!0));try{return await M(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(F(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async n=>{var o,a,l,u,f;const{data:h,error:d}=n;if(d)throw d;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await M(this.fetch,"GET",c,{headers:this.headers,jwt:(f=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0})});if(s)throw s;return ce()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(F(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:o}=t;if(o)throw o;return await M(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(F(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ni(async s=>(s>0&&await ri(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await M(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:me})),(s,n)=>{const o=200*Math.pow(2,s);return n&&At(n)&&Date.now()+o-r<Ve})}catch(r){if(this._debug(t,"error",r),F(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ce()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await ot(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+hr;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${hr}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),At(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ve;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new _t;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new ve;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(s,"error",n),F(n)){const o={session:null,error:n};return At(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await pn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ot(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ce()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ve);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ve);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ve}ms, refresh threshold is ${br} ticks`),s<=br&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof _n)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ce()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,o]=await Ue(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);s.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await M(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(F(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:l}=await M(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(!((s=a==null?void 0:a.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(F(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(F(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(F(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const f=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:f},error:null}}))}}tt.nextInstanceID=0;const Ti=tt;class Ai extends Ti{constructor(e){super(e)}}var ji=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(f){try{u(r.next(f))}catch(h){o(h)}}function l(f){try{u(r.throw(f))}catch(h){o(h)}}function u(f){f.done?n(f.value):s(f.value).then(a,l)}u((r=r.apply(i,e||[])).next())})};class Pi{constructor(e,t,r){var s,n,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Ws(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:Fs,realtime:zs,auth:Object.assign(Object.assign({},Ms),{storageKey:l}),global:Bs},f=Vs(r??{},u);this.storageKey=(s=f.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=f.global.headers)!==null&&n!==void 0?n:{},this.auth=this._initSupabaseAuthClient((o=f.auth)!==null&&o!==void 0?o:{},this.headers,f.global.fetch),this.fetch=Gs(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new zt(`${a}/rest/v1`,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new xn(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Us(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ji(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:o,debug:a},l,u){var f;const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ai({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,debug:a,fetch:u,hasCustomAuthorizationHeader:(f="Authorization"in this.headers)!==null&&f!==void 0?f:!1})}_initRealtimeClient(e){return new ks(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const gn=(i,e,t)=>new Pi(i,e,t),$n="supabase-config",Ii=()=>{const i=localStorage.getItem($n);if(!i)return null;const e=JSON.parse(i);return gn(e.supabaseUrl,e.supabaseKey)};let V=Ii();const Ri=i=>{V=gn(i.supabaseUrl,i.supabaseKey),localStorage.setItem($n,JSON.stringify(i))};function vr(i,e,t){const r=i.slice();return r[3]=e[t],r}function yr(i){let e,t=i[3].label+"",r,s;return{c(){e=O("a"),r=R(t),C(e,"href",s=i[3].path),C(e,"class","underline")},m(n,o){k(n,e,o),S(e,r)},p(n,o){o&4&&t!==(t=n[3].label+"")&&U(r,t),o&4&&s!==(s=n[3].path)&&C(e,"href",s)},d(n){n&&y(e)}}}function Li(i){let e,t,r,s=i[0].email+"",n,o,a,l,u,f=ue(i[2]),h=[];for(let d=0;d<f.length;d+=1)h[d]=yr(vr(i,f,d));return{c(){e=O("nav");for(let d=0;d<h.length;d+=1)h[d].c();t=E(),r=O("div"),n=R(s),o=E(),a=O("a"),a.textContent="Logout",C(a,"href","#/"),C(a,"class","underline"),C(e,"class","flex justify-end items-center gap-2 mb-4")},m(d,c){k(d,e,c);for(let p=0;p<h.length;p+=1)h[p]&&h[p].m(e,null);S(e,t),S(e,r),S(r,n),S(e,o),S(e,a),l||(u=Pe(a,"click",function(){Ce(i[1])&&i[1].apply(this,arguments)}),l=!0)},p(d,[c]){if(i=d,c&4){f=ue(i[2]);let p;for(p=0;p<f.length;p+=1){const g=vr(i,f,p);h[p]?h[p].p(g,c):(h[p]=yr(g),h[p].c(),h[p].m(e,t))}for(;p<h.length;p+=1)h[p].d(1);h.length=f.length}c&1&&s!==(s=i[0].email+"")&&U(n,s)},i:L,o:L,d(d){d&&y(e),Ge(h,d),l=!1,u()}}}function Di(i,e,t){let{user:r}=e,{onLogout:s}=e,{navEntries:n=[]}=e;return i.$$set=o=>{"user"in o&&t(0,r=o.user),"onLogout"in o&&t(1,s=o.onLogout),"navEntries"in o&&t(2,n=o.navEntries)},[r,s,n]}class Ui extends B{constructor(e){super(),q(this,e,Di,Li,N,{user:0,onLogout:1,navEntries:2})}}const re=i=>new Date(i).toLocaleString(),ne=i=>i?"":"Please enter a value!",Ni=(i,e)=>Math.floor(Math.random()*(e-i+1)+i),qi=i=>{for(let e=0;e<i.length;e++){const t=Ni(0,i.length-1);if(e===t)continue;const r=i[e];i[e]=i[t],i[t]=r}};function Bi(i){let e,t,r,s;return{c(){e=O("button"),t=R(i[0]),C(e,"class","btn"),e.disabled=i[2],C(e,"type","button")},m(n,o){k(n,e,o),S(e,t),r||(s=Pe(e,"click",function(){Ce(i[1])&&i[1].apply(this,arguments)}),r=!0)},p(n,o){i=n,o&1&&U(t,i[0]),o&4&&(e.disabled=i[2])},d(n){n&&y(e),r=!1,s()}}}function Fi(i){let e,t;return{c(){e=O("button"),t=R(i[0]),C(e,"class","btn"),e.disabled=i[2],C(e,"type","submit")},m(r,s){k(r,e,s),S(e,t)},p(r,s){s&1&&U(t,r[0]),s&4&&(e.disabled=r[2])},d(r){r&&y(e)}}}function Mi(i){let e;function t(n,o){return n[1]==null?Fi:Bi}let r=t(i),s=r(i);return{c(){s.c(),e=se()},m(n,o){s.m(n,o),k(n,e,o)},p(n,[o]){r===(r=t(n))&&s?s.p(n,o):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},i:L,o:L,d(n){n&&y(e),s.d(n)}}}function zi(i,e,t){let{label:r}=e,{onClick:s=null}=e,{disabled:n=!1}=e;return i.$$set=o=>{"label"in o&&t(0,r=o.label),"onClick"in o&&t(1,s=o.onClick),"disabled"in o&&t(2,n=o.disabled)},[r,s,n]}class z extends B{constructor(e){super(),q(this,e,zi,Mi,N,{label:0,onClick:1,disabled:2})}}function Hi(i){let e,t;const r=i[1].default,s=Oe(r,i,i[0],null);return{c(){e=O("div"),s&&s.c(),C(e,"class","flex gap-4")},m(n,o){k(n,e,o),s&&s.m(e,null),t=!0},p(n,[o]){s&&s.p&&(!t||o&1)&&Ae(s,r,n,n[0],t?Te(r,n[0],o,null):je(n[0]),null)},i(n){t||(m(s,n),t=!0)},o(n){_(s,n),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function Ji(i,e,t){let{$$slots:r={},$$scope:s}=e;return i.$$set=n=>{"$$scope"in n&&t(0,s=n.$$scope)},[s,r]}class Q extends B{constructor(e){super(),q(this,e,Ji,Hi,N,{})}}function Ki(i){let e,t,r,s;const n=i[2].default,o=Oe(n,i,i[1],null);return{c(){e=O("form"),o&&o.c(),C(e,"class","flex flex-col gap-5")},m(a,l){k(a,e,l),o&&o.m(e,null),t=!0,r||(s=Pe(e,"submit",On(function(){Ce(i[0])&&i[0].apply(this,arguments)})),r=!0)},p(a,[l]){i=a,o&&o.p&&(!t||l&2)&&Ae(o,n,i,i[1],t?Te(n,i[1],l,null):je(i[1]),null)},i(a){t||(m(o,a),t=!0)},o(a){_(o,a),t=!1},d(a){a&&y(e),o&&o.d(a),r=!1,s()}}}function Gi(i,e,t){let{$$slots:r={},$$scope:s}=e,{onSubmit:n}=e;return i.$$set=o=>{"onSubmit"in o&&t(0,n=o.onSubmit),"$$scope"in o&&t(1,s=o.$$scope)},[n,s,r]}class de extends B{constructor(e){super(),q(this,e,Gi,Ki,N,{onSubmit:0})}}function kr(i){let e,t;return{c(){e=O("p"),t=R(i[2]),C(e,"class","text-red-600 text-sm mt-1")},m(r,s){k(r,e,s),S(e,t)},p(r,s){s&4&&U(t,r[2])},d(r){r&&y(e)}}}function Wi(i){let e,t,r,s,n,o;const a=i[4].default,l=Oe(a,i,i[3],null);let u=i[2]&&kr(i);return{c(){e=O("div"),t=O("label"),r=R(i[1]),s=E(),l&&l.c(),n=E(),u&&u.c(),C(t,"class","block text-gray-700 text-sm font-bold mb-2"),C(t,"for",i[0])},m(f,h){k(f,e,h),S(e,t),S(t,r),S(e,s),l&&l.m(e,null),S(e,n),u&&u.m(e,null),o=!0},p(f,[h]){(!o||h&2)&&U(r,f[1]),(!o||h&1)&&C(t,"for",f[0]),l&&l.p&&(!o||h&8)&&Ae(l,a,f,f[3],o?Te(a,f[3],h,null):je(f[3]),null),f[2]?u?u.p(f,h):(u=kr(f),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i(f){o||(m(l,f),o=!0)},o(f){_(l,f),o=!1},d(f){f&&y(e),l&&l.d(f),u&&u.d()}}}function Vi(i,e,t){let{$$slots:r={},$$scope:s}=e,{id:n}=e,{label:o}=e,{error:a}=e;return i.$$set=l=>{"id"in l&&t(0,n=l.id),"label"in l&&t(1,o=l.label),"error"in l&&t(2,a=l.error),"$$scope"in l&&t(3,s=l.$$scope)},[n,o,a,s,r]}class Gt extends B{constructor(e){super(),q(this,e,Vi,Wi,N,{id:0,label:1,error:2})}}function Qi(i){let e,t,r;return{c(){e=O("input"),C(e,"class","input"),C(e,"id",i[2])},m(s,n){k(s,e,n),ze(e,i[0]),t||(r=Pe(e,"input",i[4]),t=!0)},p(s,n){n&4&&C(e,"id",s[2]),n&1&&e.value!==s[0]&&ze(e,s[0])},d(s){s&&y(e),t=!1,r()}}}function Yi(i){let e,t;return e=new Gt({props:{id:i[2],label:i[1],error:i[3],$$slots:{default:[Qi]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&4&&(n.id=r[2]),s&2&&(n.label=r[1]),s&8&&(n.error=r[3]),s&37&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Xi(i,e,t){let{label:r}=e,{id:s}=e,{value:n}=e,{error:o}=e;function a(){n=this.value,t(0,n)}return i.$$set=l=>{"label"in l&&t(1,r=l.label),"id"in l&&t(2,s=l.id),"value"in l&&t(0,n=l.value),"error"in l&&t(3,o=l.error)},[n,r,s,o,a]}class Ee extends B{constructor(e){super(),q(this,e,Xi,Yi,N,{label:1,id:2,value:0,error:3})}}function Zi(i){let e,t;return e=new z({props:{label:"Save"}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p:L,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function xi(i){let e,t,r,s,n,o,a,l;function u(c){i[6](c)}let f={id:"url",label:"Supabase URL",error:i[1]};i[0]!==void 0&&(f.value=i[0]),e=new Ee({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[7](c)}let d={id:"key",label:"Supabase key",error:i[3]};return i[2]!==void 0&&(d.value=i[2]),s=new Ee({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[Zi]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&2&&(g.error=c[1]),!t&&p&1&&(t=!0,g.value=c[0],ee(()=>t=!1)),e.$set(g);const $={};p&8&&($.error=c[3]),!n&&p&4&&(n=!0,$.value=c[2],ee(()=>n=!1)),s.$set($);const T={};p&256&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function eo(i){let e,t;return e=new de({props:{onSubmit:i[4],$$slots:{default:[xi]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&271&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function to(i,e,t){let{onConfig:r}=e,s="",n="",o="",a="";const l=()=>{t(1,n=ne(s)),t(3,a=ne(o)),!(n||a)&&r({supabaseUrl:s,supabaseKey:o})};function u(h){s=h,t(0,s)}function f(h){o=h,t(2,o)}return i.$$set=h=>{"onConfig"in h&&t(5,r=h.onConfig)},[s,n,o,a,l,r,u,f]}class ro extends B{constructor(e){super(),q(this,e,to,eo,N,{onConfig:5})}}function no(i){let e,t;return e=new de({props:{onSubmit:i[4],$$slots:{default:[oo]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,s){const n={};s&71&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function so(i){let e,t,r;return{c(){e=O("div"),e.textContent="Magic link was successfully send!",t=E(),r=O("div"),r.textContent="Please check your E-Mail"},m(s,n){k(s,e,n),k(s,t,n),k(s,r,n)},p:L,i:L,o:L,d(s){s&&(y(e),y(t),y(r))}}}function io(i){let e,t;return e=new z({props:{disabled:i[2],label:"Magic Link"}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,s){const n={};s&4&&(n.disabled=r[2]),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function oo(i){let e,t,r,s,n;function o(l){i[5](l)}let a={id:"email",label:"E-Mail",error:i[1]};return i[0]!==void 0&&(a.value=i[0]),e=new Ee({props:a}),Z.push(()=>te(e,"value",o)),s=new Q({props:{$$slots:{default:[io]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment)},m(l,u){b(e,l,u),k(l,r,u),b(s,l,u),n=!0},p(l,u){const f={};u&2&&(f.error=l[1]),!t&&u&1&&(t=!0,f.value=l[0],ee(()=>t=!1)),e.$set(f);const h={};u&68&&(h.$$scope={dirty:u,ctx:l}),s.$set(h)},i(l){n||(m(e.$$.fragment,l),m(s.$$.fragment,l),n=!0)},o(l){_(e.$$.fragment,l),_(s.$$.fragment,l),n=!1},d(l){l&&y(r),w(e,l),w(s,l)}}}function ao(i){let e,t,r,s;const n=[so,no],o=[];function a(l,u){return l[3]?0:1}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,u){o[e].m(l,u),k(l,r,u),s=!0},p(l,[u]){let f=e;e=a(l),e===f?o[e].p(l,u):(Y(),_(o[f],1,1,()=>{o[f]=null}),X(),t=o[e],t?t.p(l,u):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&y(r),o[e].d(l)}}}function lo(i,e,t){let r="",s="",n=!1,o=!1;const a=async()=>{if(t(1,s=ne(r)),s)return;t(2,n=!0);const{data:u,error:f}=await V.auth.signInWithOtp({email:r});if(t(2,n=!1),f){G.setAuthError(f);return}u&&(console.log("data",u),t(3,o=!0))};function l(u){r=u,t(0,r)}return[r,s,n,o,a,l]}class uo extends B{constructor(e){super(),q(this,e,lo,ao,N,{})}}function co(i){let e,t,r;e=new Ui({props:{navEntries:i[0],user:i[1],onLogout:i[4]}});const s=i[6].default,n=Oe(s,i,i[5],null);return{c(){v(e.$$.fragment),t=E(),n&&n.c()},m(o,a){b(e,o,a),k(o,t,a),n&&n.m(o,a),r=!0},p(o,a){const l={};a&1&&(l.navEntries=o[0]),a&2&&(l.user=o[1]),e.$set(l),n&&n.p&&(!r||a&32)&&Ae(n,s,o,o[5],r?Te(s,o[5],a,null):je(o[5]),null)},i(o){r||(m(e.$$.fragment,o),m(n,o),r=!0)},o(o){_(e.$$.fragment,o),_(n,o),r=!1},d(o){o&&y(t),w(e,o),n&&n.d(o)}}}function fo(i){let e,t;return e=new uo({}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p:L,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ho(i){let e,t;return e=new ro({props:{onConfig:i[3]}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p:L,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function po(i){let e,t,r,s;const n=[ho,fo,co],o=[];function a(l,u){return l[2]?l[1]?2:1:0}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,u){o[e].m(l,u),k(l,r,u),s=!0},p(l,[u]){let f=e;e=a(l),e===f?o[e].p(l,u):(Y(),_(o[f],1,1,()=>{o[f]=null}),X(),t=o[e],t?t.p(l,u):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&y(r),o[e].d(l)}}}function mo(i,e,t){let{$$slots:r={},$$scope:s}=e,{navEntries:n}=e,o,a=!1;const l=()=>V?(V.auth.onAuthStateChange((h,d)=>{console.log("auth changed:",d==null?void 0:d.user),d!=null&&d.user?t(1,o=d.user):t(1,o=null)}),!0):(console.log("supabase is not initialized!"),!1),u=h=>{Ri(h),t(2,a=l())},f=()=>{V&&o&&V.auth.signOut()};return he(()=>{t(2,a=l())}),i.$$set=h=>{"navEntries"in h&&t(0,n=h.navEntries),"$$scope"in h&&t(5,s=h.$$scope)},[n,o,a,u,f,s,r]}class _o extends B{constructor(e){super(),q(this,e,mo,po,N,{navEntries:0})}}function Sr(i){let e,t=i[0].msg+"",r;return{c(){e=O("p"),r=R(t),C(e,"class","text-sm")},m(s,n){k(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].msg+"")&&U(r,t)},d(s){s&&y(e)}}}function go(i){let e,t;return e=new z({props:{label:"OK",onClick:i[1]}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p:L,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function $o(i){let e,t,r,s,n=i[0].msg+"",o,a,l,u,f,h=i[0].details&&Sr(i);return u=new Q({props:{$$slots:{default:[go]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("h3"),t.textContent="Error",r=E(),s=O("p"),o=R(n),a=E(),h&&h.c(),l=E(),v(u.$$.fragment),C(t,"class","text-lg font-bold text-red-900 mb-2"),C(s,"class",""),C(e,"class","card-error mb-4")},m(d,c){k(d,e,c),S(e,t),S(e,r),S(e,s),S(s,o),S(e,a),h&&h.m(e,null),S(e,l),b(u,e,null),f=!0},p(d,[c]){(!f||c&1)&&n!==(n=d[0].msg+"")&&U(o,n),d[0].details?h?h.p(d,c):(h=Sr(d),h.c(),h.m(e,l)):h&&(h.d(1),h=null);const p={};c&4&&(p.$$scope={dirty:c,ctx:d}),u.$set(p)},i(d){f||(m(u.$$.fragment,d),f=!0)},o(d){_(u.$$.fragment,d),f=!1},d(d){d&&y(e),h&&h.d(),w(u)}}}function bo(i,e,t){let{error:r}=e;const s=()=>G.reset();return i.$$set=n=>{"error"in n&&t(0,r=n.error)},[r,s]}let wo=class extends B{constructor(e){super(),q(this,e,bo,$o,N,{error:0})}};function vo(i){let e,t;return{c(){e=O("h2"),t=R(i[0]),C(e,"class","text-2xl font-extrabold")},m(r,s){k(r,e,s),S(e,t)},p(r,[s]){s&1&&U(t,r[0])},i:L,o:L,d(r){r&&y(e)}}}function yo(i,e,t){let{header:r}=e;return i.$$set=s=>{"header"in s&&t(0,r=s.header)},[r]}class ie extends B{constructor(e){super(),q(this,e,yo,vo,N,{header:0})}}const rt="session",ko=(i,e)=>{if(i.length==0)return;const t=i.map(r=>({question:r,progress:e}));qi(t),localStorage.setItem(rt,JSON.stringify(t))},bn=()=>{const i=localStorage.getItem(rt);return i?JSON.parse(i):null},So=i=>i.length>0?(localStorage.setItem(rt,JSON.stringify(i)),!0):(localStorage.removeItem(rt),!1),Eo=()=>{localStorage.removeItem(rt)};function Co(i){let e,t;const r=i[1].default,s=Oe(r,i,i[0],null);return{c(){e=O("div"),s&&s.c(),C(e,"class","flex flex-col gap-5")},m(n,o){k(n,e,o),s&&s.m(e,null),t=!0},p(n,[o]){s&&s.p&&(!t||o&1)&&Ae(s,r,n,n[0],t?Te(r,n[0],o,null):je(n[0]),null)},i(n){t||(m(s,n),t=!0)},o(n){_(s,n),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function Oo(i,e,t){let{$$slots:r={},$$scope:s}=e;return i.$$set=n=>{"$$scope"in n&&t(0,s=n.$$scope)},[s,r]}class oe extends B{constructor(e){super(),q(this,e,Oo,Co,N,{})}}function Er(i){let e,t;return e=new Q({props:{$$slots:{default:[To]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,s){const n={};s&8&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function To(i){let e,t,r,s;return e=new z({props:{label:"Continue",onClick:i[1]}}),r=new z({props:{label:"End",onClick:i[2]}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p:L,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Ao(i){let e,t,r,s;e=new ie({props:{header:"Home"}});let n=i[0]&&Er(i);return{c(){v(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){b(e,o,a),k(o,t,a),n&&n.m(o,a),k(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=Er(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Y(),_(n,1,1,()=>{n=null}),X())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(y(t),y(r)),w(e,o),n&&n.d(o)}}}function jo(i){let e,t;return e=new oe({props:{$$slots:{default:[Ao]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&9&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Po(i,e,t){let r=!1;const s=()=>{J("/lession/process")},n=()=>{Eo(),t(0,r=!1)};return he(()=>{bn()&&t(0,r=!0)}),[r,s,n]}class Io extends B{constructor(e){super(),q(this,e,Po,jo,N,{})}}const it="cache-",wn=()=>{const i=[];for(let e in localStorage)e.startsWith(it)&&i.push(e);return i.sort()},Ro=()=>{const i=[];for(let e in localStorage)e.startsWith(it)&&localStorage.removeItem(e);return i},Lo=i=>(localStorage.removeItem(i),wn());function Cr(i,e,t){const r=i.slice();return r[4]=e[t],r}function Do(i){let e;return{c(){e=R("Cache is empty!")},m(t,r){k(t,e,r)},p:L,i:L,o:L,d(t){t&&y(e)}}}function Uo(i){let e,t,r,s,n,o,a,l=ue(i[0]),u=[];for(let h=0;h<l.length;h+=1)u[h]=Or(Cr(i,l,h));const f=h=>_(u[h],1,1,()=>{u[h]=null});return o=new Q({props:{$$slots:{default:[qo]},$$scope:{ctx:i}}}),{c(){e=O("table"),t=O("thead"),t.innerHTML='<tr class="tb-head"><th>Cache Key</th> <th></th></tr>',r=E(),s=O("tbody");for(let h=0;h<u.length;h+=1)u[h].c();n=E(),v(o.$$.fragment),C(e,"class","bg-white shadow w-full")},m(h,d){k(h,e,d),S(e,t),S(e,r),S(e,s);for(let c=0;c<u.length;c+=1)u[c]&&u[c].m(s,null);k(h,n,d),b(o,h,d),a=!0},p(h,d){if(d&1){l=ue(h[0]);let p;for(p=0;p<l.length;p+=1){const g=Cr(h,l,p);u[p]?(u[p].p(g,d),m(u[p],1)):(u[p]=Or(g),u[p].c(),m(u[p],1),u[p].m(s,null))}for(Y(),p=l.length;p<u.length;p+=1)f(p);X()}const c={};d&129&&(c.$$scope={dirty:d,ctx:h}),o.$set(c)},i(h){if(!a){for(let d=0;d<l.length;d+=1)m(u[d]);m(o.$$.fragment,h),a=!0}},o(h){u=u.filter(Boolean);for(let d=0;d<u.length;d+=1)_(u[d]);_(o.$$.fragment,h),a=!1},d(h){h&&(y(e),y(n)),Ge(u,h),w(o,h)}}}function No(i){let e,t;function r(){return i[1](i[4])}return e=new z({props:{label:"Delete",onClick:r}}),{c(){v(e.$$.fragment)},m(s,n){b(e,s,n),t=!0},p(s,n){i=s;const o={};n&1&&(o.onClick=r),e.$set(o)},i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){_(e.$$.fragment,s),t=!1},d(s){w(e,s)}}}function Or(i){let e,t,r=i[4]+"",s,n,o,a,l,u;return a=new Q({props:{$$slots:{default:[No]},$$scope:{ctx:i}}}),{c(){e=O("tr"),t=O("td"),s=R(r),n=E(),o=O("td"),v(a.$$.fragment),l=E()},m(f,h){k(f,e,h),S(e,t),S(t,s),S(e,n),S(e,o),b(a,o,null),S(e,l),u=!0},p(f,h){(!u||h&1)&&r!==(r=f[4]+"")&&U(s,r);const d={};h&129&&(d.$$scope={dirty:h,ctx:f}),a.$set(d)},i(f){u||(m(a.$$.fragment,f),u=!0)},o(f){_(a.$$.fragment,f),u=!1},d(f){f&&y(e),w(a)}}}function qo(i){let e,t,r,s;return e=new z({props:{onClick:i[2],label:"Cancel"}}),r=new z({props:{onClick:i[3],label:"Delete all"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[3]),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Bo(i){let e,t,r,s,n,o;e=new ie({props:{header:"Cache"}});const a=[Uo,Do],l=[];function u(f,h){return f[0].length>0?0:1}return r=u(i),s=l[r]=a[r](i),{c(){v(e.$$.fragment),t=E(),s.c(),n=se()},m(f,h){b(e,f,h),k(f,t,h),l[r].m(f,h),k(f,n,h),o=!0},p(f,h){let d=r;r=u(f),r===d?l[r].p(f,h):(Y(),_(l[d],1,1,()=>{l[d]=null}),X(),s=l[r],s?s.p(f,h):(s=l[r]=a[r](f),s.c()),m(s,1),s.m(n.parentNode,n))},i(f){o||(m(e.$$.fragment,f),m(s),o=!0)},o(f){_(e.$$.fragment,f),_(s),o=!1},d(f){f&&(y(t),y(n)),w(e,f),l[r].d(f)}}}function Fo(i){let e,t;return e=new oe({props:{$$slots:{default:[Bo]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&129&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Mo(i,e,t){let r=[];return he(()=>{t(0,r=wn())}),[r,a=>{t(0,r=Lo(a))},()=>J("/"),()=>t(0,r=Ro())]}class zo extends B{constructor(e){super(),q(this,e,Mo,Fo,N,{})}}function Ho(i){let e,t,r,s;return e=new ie({props:{header:"Not Found"}}),{c(){v(e.$$.fragment),t=E(),r=O("div"),r.textContent="Not Found"},m(n,o){b(e,n,o),k(n,t,o),k(n,r,o),s=!0},p:L,i(n){s||(m(e.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),s=!1},d(n){n&&(y(t),y(r)),w(e,n)}}}function Jo(i){let e,t;return e=new oe({props:{$$slots:{default:[Ho]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}class Ko extends B{constructor(e){super(),q(this,e,null,Jo,N,{})}}const nt=it+"books",gt=async i=>{let{data:e,error:t}=await V.from("books").select("*").eq("id",i).single();return t&&G.setDBError(t),e||null},Wt=async()=>{const i=localStorage.getItem(nt);if(i)return JSON.parse(i);let{data:e,error:t}=await V.from("books").select("*");return t&&G.setDBError(t),e?(localStorage.setItem(nt,JSON.stringify(e)),e):[]},Go=async i=>{const{error:e}=await V.from("books").delete().eq("id",i);return e?(G.setDBError(e),[]):(localStorage.removeItem(nt),Wt())},Wo=async(i,e)=>{const{error:t}=await V.from("books").insert([{name:i,description:e}]);if(t)return G.setDBError(t),[];localStorage.removeItem(nt)},Vo=async(i,e,t)=>{const{error:r}=await V.from("books").update({name:e,description:t}).eq("id",i);return r?(G.setDBError(r),[]):(localStorage.removeItem(nt),Wt())};function Qo(i){let e,t,r,s;const n=i[2].default,o=Oe(n,i,i[1],null);return{c(){e=O("button"),o&&o.c(),C(e,"class","text-blue-600 hover:text-blue-700")},m(a,l){k(a,e,l),o&&o.m(e,null),t=!0,r||(s=Pe(e,"click",function(){Ce(i[0])&&i[0].apply(this,arguments)}),r=!0)},p(a,[l]){i=a,o&&o.p&&(!t||l&2)&&Ae(o,n,i,i[1],t?Te(n,i[1],l,null):je(i[1]),null)},i(a){t||(m(o,a),t=!0)},o(a){_(o,a),t=!1},d(a){a&&y(e),o&&o.d(a),r=!1,s()}}}function Yo(i,e,t){let{$$slots:r={},$$scope:s}=e,{onClick:n}=e;return i.$$set=o=>{"onClick"in o&&t(0,n=o.onClick),"$$scope"in o&&t(1,s=o.$$scope)},[n,s,r]}class $t extends B{constructor(e){super(),q(this,e,Yo,Qo,N,{onClick:0})}}function Xo(i){let e,t;return{c(){e=$e("svg"),t=$e("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){k(r,e,s),S(e,t)},p:L,d(r){r&&y(e)}}}function Zo(i){let e,t;return e=new $t({props:{onClick:i[0],$$slots:{default:[Xo]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function xo(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class Vt extends B{constructor(e){super(),q(this,e,xo,Zo,N,{onClick:0})}}function ea(i){let e,t;return{c(){e=$e("svg"),t=$e("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){k(r,e,s),S(e,t)},p:L,d(r){r&&y(e)}}}function ta(i){let e,t;return e=new $t({props:{onClick:i[0],$$slots:{default:[ea]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ra(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class vn extends B{constructor(e){super(),q(this,e,ra,ta,N,{onClick:0})}}function na(i){let e,t;return{c(){e=$e("svg"),t=$e("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){k(r,e,s),S(e,t)},p:L,d(r){r&&y(e)}}}function sa(i){let e,t;return e=new $t({props:{onClick:i[0],$$slots:{default:[na]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ia(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class Qt extends B{constructor(e){super(),q(this,e,ia,sa,N,{onClick:0})}}function Tr(i,e,t){const r=i.slice();return r[6]=e[t],r}function oa(i){let e,t,r,s,n,o;function a(){return i[1](i[6])}e=new Vt({props:{onClick:a}});function l(){return i[2](i[6])}r=new Qt({props:{onClick:l}});function u(){return i[3](i[6])}return n=new vn({props:{onClick:u}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment),s=E(),v(n.$$.fragment)},m(f,h){b(e,f,h),k(f,t,h),b(r,f,h),k(f,s,h),b(n,f,h),o=!0},p(f,h){i=f;const d={};h&1&&(d.onClick=a),e.$set(d);const c={};h&1&&(c.onClick=l),r.$set(c);const p={};h&1&&(p.onClick=u),n.$set(p)},i(f){o||(m(e.$$.fragment,f),m(r.$$.fragment,f),m(n.$$.fragment,f),o=!0)},o(f){_(e.$$.fragment,f),_(r.$$.fragment,f),_(n.$$.fragment,f),o=!1},d(f){f&&(y(t),y(s)),w(e,f),w(r,f),w(n,f)}}}function Ar(i){let e,t,r=i[6].id+"",s,n,o,a=i[6].name+"",l,u,f,h=i[6].description+"",d,c,p,g=re(i[6].modified)+"",$,T,D,P,A,j;return P=new Q({props:{$$slots:{default:[oa]},$$scope:{ctx:i}}}),{c(){e=O("tr"),t=O("td"),s=R(r),n=E(),o=O("td"),l=R(a),u=E(),f=O("td"),d=R(h),c=E(),p=O("td"),$=R(g),T=E(),D=O("td"),v(P.$$.fragment),A=E()},m(I,H){k(I,e,H),S(e,t),S(t,s),S(e,n),S(e,o),S(o,l),S(e,u),S(e,f),S(f,d),S(e,c),S(e,p),S(p,$),S(e,T),S(e,D),b(P,D,null),S(e,A),j=!0},p(I,H){(!j||H&1)&&r!==(r=I[6].id+"")&&U(s,r),(!j||H&1)&&a!==(a=I[6].name+"")&&U(l,a),(!j||H&1)&&h!==(h=I[6].description+"")&&U(d,h),(!j||H&1)&&g!==(g=re(I[6].modified)+"")&&U($,g);const W={};H&513&&(W.$$scope={dirty:H,ctx:I}),P.$set(W)},i(I){j||(m(P.$$.fragment,I),j=!0)},o(I){_(P.$$.fragment,I),j=!1},d(I){I&&y(e),w(P)}}}function aa(i){let e,t,r,s;return e=new z({props:{onClick:i[4],label:"Cancel"}}),r=new z({props:{onClick:i[5],label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p:L,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function la(i){let e,t,r,s,n,o,a,l,u;e=new ie({props:{header:"List Books"}});let f=ue(i[0]),h=[];for(let c=0;c<f.length;c+=1)h[c]=Ar(Tr(i,f,c));const d=c=>_(h[c],1,1,()=>{h[c]=null});return l=new Q({props:{$$slots:{default:[aa]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),r=O("table"),s=O("thead"),s.innerHTML='<tr class="tb-head"><th>ID</th> <th>Name</th> <th>Description</th> <th>Modified</th> <th></th></tr>',n=E(),o=O("tbody");for(let c=0;c<h.length;c+=1)h[c].c();a=E(),v(l.$$.fragment),C(r,"class","bg-white shadow w-full")},m(c,p){b(e,c,p),k(c,t,p),k(c,r,p),S(r,s),S(r,n),S(r,o);for(let g=0;g<h.length;g+=1)h[g]&&h[g].m(o,null);k(c,a,p),b(l,c,p),u=!0},p(c,p){if(p&1){f=ue(c[0]);let $;for($=0;$<f.length;$+=1){const T=Tr(c,f,$);h[$]?(h[$].p(T,p),m(h[$],1)):(h[$]=Ar(T),h[$].c(),m(h[$],1),h[$].m(o,null))}for(Y(),$=f.length;$<h.length;$+=1)d($);X()}const g={};p&512&&(g.$$scope={dirty:p,ctx:c}),l.$set(g)},i(c){if(!u){m(e.$$.fragment,c);for(let p=0;p<f.length;p+=1)m(h[p]);m(l.$$.fragment,c),u=!0}},o(c){_(e.$$.fragment,c),h=h.filter(Boolean);for(let p=0;p<h.length;p+=1)_(h[p]);_(l.$$.fragment,c),u=!1},d(c){c&&(y(t),y(r),y(a)),w(e,c),Ge(h,c),w(l,c)}}}function ua(i){let e,t;return e=new oe({props:{$$slots:{default:[la]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&513&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ca(i,e,t){let r=[];return he(async()=>{t(0,r=await Wt())}),[r,async u=>{t(0,r=await Go(u.id))},u=>{J("/books/update/"+u.id)},u=>{J("/chapters/list/"+u.id)},()=>J("/books/list"),()=>J("/books/create")]}class fa extends B{constructor(e){super(),q(this,e,ca,ua,N,{})}}function ha(i){let e,t,r;return{c(){e=O("textarea"),C(e,"class","input"),C(e,"id",i[2])},m(s,n){k(s,e,n),ze(e,i[0]),t||(r=Pe(e,"input",i[4]),t=!0)},p(s,n){n&4&&C(e,"id",s[2]),n&1&&ze(e,s[0])},d(s){s&&y(e),t=!1,r()}}}function da(i){let e,t;return e=new Gt({props:{id:i[2],label:i[1],error:i[3],$$slots:{default:[ha]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&4&&(n.id=r[2]),s&2&&(n.label=r[1]),s&8&&(n.error=r[3]),s&37&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function pa(i,e,t){let{label:r}=e,{id:s}=e,{value:n}=e,{error:o}=e;function a(){n=this.value,t(0,n)}return i.$$set=l=>{"label"in l&&t(1,r=l.label),"id"in l&&t(2,s=l.id),"value"in l&&t(0,n=l.value),"error"in l&&t(3,o=l.error)},[n,r,s,o,a]}class be extends B{constructor(e){super(),q(this,e,pa,da,N,{label:1,id:2,value:0,error:3})}}function ma(i){let e,t,r,s;return e=new z({props:{onClick:i[7],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p:L,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function _a(i){let e,t,r,s,n,o,a,l;function u(c){i[5](c)}let f={id:"name",label:"Book name",error:i[1]};i[0]!==void 0&&(f.value=i[0]),e=new Ee({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[6](c)}let d={id:"description",label:"Book description",error:i[3]};return i[2]!==void 0&&(d.value=i[2]),s=new be({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[ma]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&2&&(g.error=c[1]),!t&&p&1&&(t=!0,g.value=c[0],ee(()=>t=!1)),e.$set(g);const $={};p&8&&($.error=c[3]),!n&&p&4&&(n=!0,$.value=c[2],ee(()=>n=!1)),s.$set($);const T={};p&256&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function ga(i){let e,t,r,s;return e=new ie({props:{header:"Create Book"}}),r=new de({props:{onSubmit:i[4],$$slots:{default:[_a]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&271&&(a.$$scope={dirty:o,ctx:n}),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function $a(i){let e,t;return e=new oe({props:{$$slots:{default:[ga]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&271&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ba(i,e,t){let r="",s="",n="",o="";const a=async()=>{t(1,s=ne(r)),t(3,o=ne(n)),!(s||o)&&(await Wo(r,n),J("/books/list"))};function l(h){r=h,t(0,r)}function u(h){n=h,t(2,n)}return[r,s,n,o,a,l,u,()=>J("/books/list")]}class wa extends B{constructor(e){super(),q(this,e,ba,$a,N,{})}}function jr(i){let e,t,r=i[0].id+"",s,n,o,a=re(i[0].modified)+"",l,u,f,h;return f=new de({props:{onSubmit:i[5],$$slots:{default:[ya]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("span"),s=R(r),n=E(),o=O("span"),l=R(a),u=E(),v(f.$$.fragment),C(e,"class","mb-4 text-small")},m(d,c){k(d,e,c),S(e,t),S(t,s),S(e,n),S(e,o),S(o,l),k(d,u,c),b(f,d,c),h=!0},p(d,c){(!h||c&1)&&r!==(r=d[0].id+"")&&U(s,r),(!h||c&1)&&a!==(a=re(d[0].modified)+"")&&U(l,a);const p={};c&1054&&(p.$$scope={dirty:c,ctx:d}),f.$set(p)},i(d){h||(m(f.$$.fragment,d),h=!0)},o(d){_(f.$$.fragment,d),h=!1},d(d){d&&(y(e),y(u)),w(f,d)}}}function va(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Update"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p:L,i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function ya(i){let e,t,r,s,n,o,a,l;function u(c){i[7](c)}let f={id:"name",label:"Book name",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new Ee({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[8](c)}let d={id:"description",label:"Book description",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new be({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[va]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&4&&(g.error=c[2]),!t&&p&2&&(t=!0,g.value=c[1],ee(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=c[4]),!n&&p&8&&(n=!0,$.value=c[3],ee(()=>n=!1)),s.$set($);const T={};p&1024&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function ka(i){let e,t,r,s;e=new ie({props:{header:"Update Book"}});let n=i[0]&&jr(i);return{c(){v(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){b(e,o,a),k(o,t,a),n&&n.m(o,a),k(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=jr(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Y(),_(n,1,1,()=>{n=null}),X())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(y(t),y(r)),w(e,o),n&&n.d(o)}}}function Sa(i){let e,t;return e=new oe({props:{$$slots:{default:[ka]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1055&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ea(i,e,t){let{params:r={id:""}}=e,s=null,n="",o="",a="",l="";const u=async()=>{if(t(2,o=ne(n)),t(4,l=ne(a)),!(o||l)){if(!s){G.setString("No book!!");return}await Vo(s.id,n,a),J("/books/list")}};he(async()=>{t(0,s=await gt(parseInt(r.id))),s&&(t(1,n=s.name),t(3,a=s.description))});function f(c){n=c,t(1,n)}function h(c){a=c,t(3,a)}const d=()=>J("/books/list");return i.$$set=c=>{"params"in c&&t(6,r=c.params)},[s,n,o,a,l,u,r,f,h,d]}class Ca extends B{constructor(e){super(),q(this,e,Ea,Sa,N,{params:6})}}const Oa=it+"chapters",bt=i=>`${Oa}#${i}`,Yt=async i=>{let{data:e,error:t}=await V.from("chapters").select("*").eq("id",i).single();return t&&G.setDBError(t),e||null},Xt=async i=>{const e=bt(i),t=localStorage.getItem(e);if(t)return JSON.parse(t);let{data:r,error:s}=await V.from("chapters").select("*").eq("book_id",i);return s&&G.setDBError(s),r?(localStorage.setItem(e,JSON.stringify(r)),r):[]},Ta=async(i,e)=>{const{error:t}=await V.from("chapters").delete().eq("id",i);return t?(G.setDBError(t),[]):(localStorage.removeItem(bt(e)),Xt(e))},Aa=async(i,e,t,r)=>{const{error:s}=await V.from("chapters").update({name:t,description:r}).eq("id",i);return s?(G.setDBError(s),[]):(localStorage.removeItem(bt(e)),Xt(e))},ja=async(i,e,t)=>{const{error:r}=await V.from("chapters").insert([{book_id:i,name:e,description:t}]);if(r)return G.setDBError(r),[];localStorage.removeItem(bt(i))};function Pa(i){let e,t;const r=i[1].default,s=Oe(r,i,i[0],null);return{c(){e=O("div"),s&&s.c(),C(e,"class","border rounded shadow px-4 py-4")},m(n,o){k(n,e,o),s&&s.m(e,null),t=!0},p(n,[o]){s&&s.p&&(!t||o&1)&&Ae(s,r,n,n[0],t?Te(r,n[0],o,null):je(n[0]),null)},i(n){t||(m(s,n),t=!0)},o(n){_(s,n),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function Ia(i,e,t){let{$$slots:r={},$$scope:s}=e;return i.$$set=n=>{"$$scope"in n&&t(0,s=n.$$scope)},[s,r]}class Ra extends B{constructor(e){super(),q(this,e,Ia,Pa,N,{})}}function Pr(i){let e,t,r,s=i[0].name+"",n,o,a,l,u=i[0].id+"",f,h,d=re(i[0].modified)+"",c,p,g=i[0].description&&Ir(i);return{c(){e=O("div"),t=O("div"),r=O("div"),n=R(s),o=E(),a=O("div"),l=R("Book-Id: "),f=R(u),h=R(" - Modified: "),c=R(d),p=E(),g&&g.c(),C(r,"class","text-lg"),C(a,"class","text-sm"),C(t,"class","flex justify-between mb-2")},m($,T){k($,e,T),S(e,t),S(t,r),S(r,n),S(t,o),S(t,a),S(a,l),S(a,f),S(a,h),S(a,c),S(e,p),g&&g.m(e,null)},p($,T){T&1&&s!==(s=$[0].name+"")&&U(n,s),T&1&&u!==(u=$[0].id+"")&&U(f,u),T&1&&d!==(d=re($[0].modified)+"")&&U(c,d),$[0].description?g?g.p($,T):(g=Ir($),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d($){$&&y(e),g&&g.d()}}}function Ir(i){let e,t=i[0].description+"",r;return{c(){e=O("p"),r=R(t),C(e,"class","mt-2 pt-2 border-t text-sm")},m(s,n){k(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].description+"")&&U(r,t)},d(s){s&&y(e)}}}function Rr(i){let e,t,r,s=i[1].name+"",n,o,a,l,u=i[1].id+"",f,h,d=re(i[1].modified)+"",c,p,g=i[1].description&&Lr(i);return{c(){e=O("div"),t=O("div"),r=O("div"),n=R(s),o=E(),a=O("div"),l=R("Chapter-Id: "),f=R(u),h=R(" - Modified: "),c=R(d),p=E(),g&&g.c(),C(r,"class","text-lg"),C(a,"class","text-sm"),C(t,"class","flex justify-between mb-2")},m($,T){k($,e,T),S(e,t),S(t,r),S(r,n),S(t,o),S(t,a),S(a,l),S(a,f),S(a,h),S(a,c),S(e,p),g&&g.m(e,null)},p($,T){T&2&&s!==(s=$[1].name+"")&&U(n,s),T&2&&u!==(u=$[1].id+"")&&U(f,u),T&2&&d!==(d=re($[1].modified)+"")&&U(c,d),$[1].description?g?g.p($,T):(g=Lr($),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d($){$&&y(e),g&&g.d()}}}function Lr(i){let e,t=i[1].description+"",r;return{c(){e=O("p"),r=R(t),C(e,"class","mt-2 pt-2 border-t text-sm")},m(s,n){k(s,e,n),S(e,r)},p(s,n){n&2&&t!==(t=s[1].description+"")&&U(r,t)},d(s){s&&y(e)}}}function La(i){let e,t,r=i[0]&&Pr(i),s=i[1]&&Rr(i);return{c(){e=O("div"),r&&r.c(),t=E(),s&&s.c(),C(e,"class","flex flex-col gap-5")},m(n,o){k(n,e,o),r&&r.m(e,null),S(e,t),s&&s.m(e,null)},p(n,o){n[0]?r?r.p(n,o):(r=Pr(n),r.c(),r.m(e,t)):r&&(r.d(1),r=null),n[1]?s?s.p(n,o):(s=Rr(n),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(n){n&&y(e),r&&r.d(),s&&s.d()}}}function Da(i){let e,t;return e=new Ra({props:{$$slots:{default:[La]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&7&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ua(i,e,t){let{book:r=null}=e,{chapter:s=null}=e;return i.$$set=n=>{"book"in n&&t(0,r=n.book),"chapter"in n&&t(1,s=n.chapter)},[r,s]}class Zt extends B{constructor(e){super(),q(this,e,Ua,Da,N,{book:0,chapter:1})}}function Na(i){let e,t;return{c(){e=$e("svg"),t=$e("path"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"d","m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"fill","none"),C(e,"viewBox","0 0 24 24"),C(e,"stroke-width","1.5"),C(e,"stroke","currentColor"),C(e,"class","size-6 hover:stroke-2")},m(r,s){k(r,e,s),S(e,t)},p:L,d(r){r&&y(e)}}}function qa(i){let e,t;return e=new $t({props:{onClick:i[0],$$slots:{default:[Na]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1&&(n.onClick=r[0]),s&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ba(i,e,t){let{onClick:r}=e;return i.$$set=s=>{"onClick"in s&&t(0,r=s.onClick)},[r]}class Fa extends B{constructor(e){super(),q(this,e,Ba,qa,N,{onClick:0})}}function Dr(i,e,t){const r=i.slice();return r[9]=e[t],r}function Ma(i){let e,t,r,s,n,o,a,l;function u(){return i[3](i[9])}e=new Vt({props:{onClick:u}});function f(){return i[4](i[9])}r=new Qt({props:{onClick:f}});function h(){return i[5](i[9])}n=new vn({props:{onClick:h}});function d(){return i[6](i[9])}return a=new Fa({props:{onClick:d}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment),s=E(),v(n.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,t,p),b(r,c,p),k(c,s,p),b(n,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){i=c;const g={};p&4&&(g.onClick=u),e.$set(g);const $={};p&4&&($.onClick=f),r.$set($);const T={};p&4&&(T.onClick=h),n.$set(T);const D={};p&4&&(D.onClick=d),a.$set(D)},i(c){l||(m(e.$$.fragment,c),m(r.$$.fragment,c),m(n.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(r.$$.fragment,c),_(n.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(t),y(s),y(o)),w(e,c),w(r,c),w(n,c),w(a,c)}}}function Ur(i){let e,t,r=i[9].id+"",s,n,o,a=i[9].name+"",l,u,f,h=i[9].description+"",d,c,p,g=re(i[9].modified)+"",$,T,D,P,A,j;return P=new Q({props:{$$slots:{default:[Ma]},$$scope:{ctx:i}}}),{c(){e=O("tr"),t=O("td"),s=R(r),n=E(),o=O("td"),l=R(a),u=E(),f=O("td"),d=R(h),c=E(),p=O("td"),$=R(g),T=E(),D=O("td"),v(P.$$.fragment),A=E()},m(I,H){k(I,e,H),S(e,t),S(t,s),S(e,n),S(e,o),S(o,l),S(e,u),S(e,f),S(f,d),S(e,c),S(e,p),S(p,$),S(e,T),S(e,D),b(P,D,null),S(e,A),j=!0},p(I,H){(!j||H&4)&&r!==(r=I[9].id+"")&&U(s,r),(!j||H&4)&&a!==(a=I[9].name+"")&&U(l,a),(!j||H&4)&&h!==(h=I[9].description+"")&&U(d,h),(!j||H&4)&&g!==(g=re(I[9].modified)+"")&&U($,g);const W={};H&4100&&(W.$$scope={dirty:H,ctx:I}),P.$set(W)},i(I){j||(m(P.$$.fragment,I),j=!0)},o(I){_(P.$$.fragment,I),j=!1},d(I){I&&y(e),w(P)}}}function za(i){let e,t,r,s;return e=new z({props:{onClick:i[7],label:"Cancel"}}),r=new z({props:{onClick:i[8],label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[8]),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Ha(i){let e,t,r,s,n,o,a,l,u,f,h;e=new ie({props:{header:"List Chapters"}}),r=new Zt({props:{book:i[1]}});let d=ue(i[2]),c=[];for(let g=0;g<d.length;g+=1)c[g]=Ur(Dr(i,d,g));const p=g=>_(c[g],1,1,()=>{c[g]=null});return f=new Q({props:{$$slots:{default:[za]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment),s=E(),n=O("table"),o=O("thead"),o.innerHTML='<tr class="tb-head"><th>ID</th> <th>Name</th> <th>Description</th> <th>Modified</th> <th></th></tr>',a=E(),l=O("tbody");for(let g=0;g<c.length;g+=1)c[g].c();u=E(),v(f.$$.fragment),C(n,"class","bg-white shadow w-full")},m(g,$){b(e,g,$),k(g,t,$),b(r,g,$),k(g,s,$),k(g,n,$),S(n,o),S(n,a),S(n,l);for(let T=0;T<c.length;T+=1)c[T]&&c[T].m(l,null);k(g,u,$),b(f,g,$),h=!0},p(g,$){const T={};if($&2&&(T.book=g[1]),r.$set(T),$&4){d=ue(g[2]);let P;for(P=0;P<d.length;P+=1){const A=Dr(g,d,P);c[P]?(c[P].p(A,$),m(c[P],1)):(c[P]=Ur(A),c[P].c(),m(c[P],1),c[P].m(l,null))}for(Y(),P=d.length;P<c.length;P+=1)p(P);X()}const D={};$&4097&&(D.$$scope={dirty:$,ctx:g}),f.$set(D)},i(g){if(!h){m(e.$$.fragment,g),m(r.$$.fragment,g);for(let $=0;$<d.length;$+=1)m(c[$]);m(f.$$.fragment,g),h=!0}},o(g){_(e.$$.fragment,g),_(r.$$.fragment,g),c=c.filter(Boolean);for(let $=0;$<c.length;$+=1)_(c[$]);_(f.$$.fragment,g),h=!1},d(g){g&&(y(t),y(s),y(n),y(u)),w(e,g),w(r,g),Ge(c,g),w(f,g)}}}function Ja(i){let e,t;return e=new oe({props:{$$slots:{default:[Ha]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&4103&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ka(i,e,t){let{params:r={id:0}}=e,s,n=[];he(async()=>{t(1,s=await gt(r.id)),s&&t(2,n=await Xt(s.id))});const o=async d=>{t(2,n=await Ta(d.id,d.book_id))},a=d=>{J("/chapters/update/"+d.id)},l=d=>{J("/questions/list/"+d.id)},u=d=>{J("/lession/prepare/"+d.id)},f=()=>J("/books/list"),h=()=>J("/chapters/create/"+r.id);return i.$$set=d=>{"params"in d&&t(0,r=d.params)},[r,s,n,o,a,l,u,f,h]}class Ga extends B{constructor(e){super(),q(this,e,Ka,Ja,N,{params:0})}}function Wa(i){let e,t,r,s;return e=new z({props:{onClick:i[8],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[8]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Va(i){let e,t,r,s,n,o,a,l;function u(c){i[6](c)}let f={id:"name",label:"Chapter name",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new Ee({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[7](c)}let d={id:"description",label:"Chapter description",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new be({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[Wa]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&4&&(g.error=c[2]),!t&&p&2&&(t=!0,g.value=c[1],ee(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=c[4]),!n&&p&8&&(n=!0,$.value=c[3],ee(()=>n=!1)),s.$set($);const T={};p&513&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function Qa(i){let e,t,r,s;return e=new ie({props:{header:"Create Book"}}),r=new de({props:{onSubmit:i[5],$$slots:{default:[Va]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&543&&(a.$$scope={dirty:o,ctx:n}),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Ya(i){let e,t;return e=new oe({props:{$$slots:{default:[Qa]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&543&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Xa(i,e,t){let{params:r={book_id:0}}=e,s="",n="",o="",a="";const l=async()=>{t(2,n=ne(s)),t(4,a=ne(o)),!(n||a)&&(await ja(r.book_id,s,o),J("/chapters/list/"+r.book_id))};function u(d){s=d,t(1,s)}function f(d){o=d,t(3,o)}const h=()=>J("/chapters/list/"+r.book_id);return i.$$set=d=>{"params"in d&&t(0,r=d.params)},[r,s,n,o,a,l,u,f,h]}class Za extends B{constructor(e){super(),q(this,e,Xa,Ya,N,{params:0})}}function Nr(i){let e,t,r=i[0].id+"",s,n,o,a=re(i[0].modified)+"",l,u,f,h;return f=new de({props:{onSubmit:i[5],$$slots:{default:[el]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("span"),s=R(r),n=E(),o=O("span"),l=R(a),u=E(),v(f.$$.fragment),C(e,"class","mb-4 text-small")},m(d,c){k(d,e,c),S(e,t),S(t,s),S(e,n),S(e,o),S(o,l),k(d,u,c),b(f,d,c),h=!0},p(d,c){(!h||c&1)&&r!==(r=d[0].id+"")&&U(s,r),(!h||c&1)&&a!==(a=re(d[0].modified)+"")&&U(l,a);const p={};c&1055&&(p.$$scope={dirty:c,ctx:d}),f.$set(p)},i(d){h||(m(f.$$.fragment,d),h=!0)},o(d){_(f.$$.fragment,d),h=!1},d(d){d&&(y(e),y(u)),w(f,d)}}}function xa(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[9]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function el(i){let e,t,r,s,n,o,a,l;function u(c){i[7](c)}let f={id:"name",label:"Chapter name",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new Ee({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[8](c)}let d={id:"description",label:"Chapter description",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new be({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[xa]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&4&&(g.error=c[2]),!t&&p&2&&(t=!0,g.value=c[1],ee(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=c[4]),!n&&p&8&&(n=!0,$.value=c[3],ee(()=>n=!1)),s.$set($);const T={};p&1025&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function tl(i){let e,t,r,s;e=new ie({props:{header:"Update Book"}});let n=i[0]&&Nr(i);return{c(){v(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){b(e,o,a),k(o,t,a),n&&n.m(o,a),k(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=Nr(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Y(),_(n,1,1,()=>{n=null}),X())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(y(t),y(r)),w(e,o),n&&n.d(o)}}}function rl(i){let e,t;return e=new oe({props:{$$slots:{default:[tl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1055&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function nl(i,e,t){let{params:r={id:""}}=e,s=null,n="",o="",a="",l="";const u=async()=>{if(t(2,o=ne(n)),t(4,l=ne(a)),!(o||l)){if(!s){G.setString("No chapter!!");return}await Aa(s.id,s.book_id,n,a),J("/chapters/list/"+s.book_id)}};he(async()=>{t(0,s=await Yt(parseInt(r.id))),s&&(t(1,n=s.name),t(3,a=s.description))});function f(c){n=c,t(1,n)}function h(c){a=c,t(3,a)}const d=()=>J("/chapters/list/"+(s==null?void 0:s.book_id));return i.$$set=c=>{"params"in c&&t(6,r=c.params)},[s,n,o,a,l,u,r,f,h,d]}class sl extends B{constructor(e){super(),q(this,e,nl,rl,N,{params:6})}}const il=it+"questions",wt=i=>`${il}#${i}`,ol=async i=>{let{data:e,error:t}=await V.from("questions").select("*").eq("id",i).single();return t&&G.setDBError(t),e||null},vt=async i=>{const e=wt(i),t=localStorage.getItem(e);if(t)return JSON.parse(t);let{data:r,error:s}=await V.from("questions").select("*").eq("chapter_id",i);return s&&G.setDBError(s),r?(localStorage.setItem(e,JSON.stringify(r)),r):[]},al=async(i,e)=>{const{error:t}=await V.from("questions").delete().eq("id",i);return t?(G.setDBError(t),[]):(localStorage.removeItem(wt(e)),vt(e))},ll=async(i,e,t)=>{const{error:r}=await V.from("questions").insert([{chapter_id:i,question:e,answer:t}]);if(r)return G.setDBError(r),[];localStorage.removeItem(wt(i))},ul=async(i,e,t,r)=>{const{error:s}=await V.from("questions").update({question:t,answer:r}).eq("id",i);return s?(G.setDBError(s),[]):(localStorage.removeItem(wt(e)),vt(e))};function qr(i){let e,t,r,s;return{c(){e=O("div"),t=R("Progress: "),r=R(i[1]),s=R(" / 3"),C(e,"class","text-xs font-bold mb-2 border rounded-lg shadow-sm bg-emerald-800 text-white px-2")},m(n,o){k(n,e,o),S(e,t),S(e,r),S(e,s)},p(n,o){o&2&&U(r,n[1])},d(n){n&&y(e)}}}function Br(i){let e,t,r,s=i[0].answer+"",n;return{c(){e=O("div"),e.textContent="Answer",t=E(),r=O("div"),n=R(s),C(e,"class","text-sm font-bold mb-2"),C(r,"class","px-3 py-3 border border-gray-400 rounded shadow-sm")},m(o,a){k(o,e,a),k(o,t,a),k(o,r,a),S(r,n)},p(o,a){a&1&&s!==(s=o[0].answer+"")&&U(n,s)},d(o){o&&(y(e),y(t),y(r))}}}function cl(i){let e,t,r,s,n=i[0].id+"",o,a,l,u,f,h=re(i[0].modified)+"",d,c,p,g=i[0].question+"",$,T,D=i[1]>=0&&qr(i),P=i[2]&&Br(i);return{c(){e=O("div"),t=O("div"),r=O("div"),s=R("Question Id: "),o=R(n),a=E(),D&&D.c(),l=E(),u=O("div"),f=R("Modified: "),d=R(h),c=E(),p=O("div"),$=R(g),T=E(),P&&P.c(),C(r,"class","text-sm font-bold mb-2"),C(u,"class","text-sm mb-2"),C(t,"class","flex justify-between"),C(p,"class","mb-2 px-3 py-3 border border-gray-400 rounded shadow-sm")},m(A,j){k(A,e,j),S(e,t),S(t,r),S(r,s),S(r,o),S(t,a),D&&D.m(t,null),S(t,l),S(t,u),S(u,f),S(u,d),S(e,c),S(e,p),S(p,$),S(e,T),P&&P.m(e,null)},p(A,[j]){j&1&&n!==(n=A[0].id+"")&&U(o,n),A[1]>=0?D?D.p(A,j):(D=qr(A),D.c(),D.m(t,l)):D&&(D.d(1),D=null),j&1&&h!==(h=re(A[0].modified)+"")&&U(d,h),j&1&&g!==(g=A[0].question+"")&&U($,g),A[2]?P?P.p(A,j):(P=Br(A),P.c(),P.m(e,null)):P&&(P.d(1),P=null)},i:L,o:L,d(A){A&&y(e),D&&D.d(),P&&P.d()}}}function fl(i,e,t){let{question:r}=e,{progress:s=-1}=e,{showAnswer:n=!0}=e;return i.$$set=o=>{"question"in o&&t(0,r=o.question),"progress"in o&&t(1,s=o.progress),"showAnswer"in o&&t(2,n=o.showAnswer)},[r,s,n]}class yn extends B{constructor(e){super(),q(this,e,fl,cl,N,{question:0,progress:1,showAnswer:2})}}function Fr(i,e,t){const r=i.slice();return r[8]=e[t],r}function hl(i){let e,t,r,s;function n(){return i[4](i[8])}e=new Qt({props:{onClick:n}});function o(){return i[5](i[8])}return r=new Vt({props:{onClick:o}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(a,l){b(e,a,l),k(a,t,l),b(r,a,l),s=!0},p(a,l){i=a;const u={};l&8&&(u.onClick=n),e.$set(u);const f={};l&8&&(f.onClick=o),r.$set(f)},i(a){s||(m(e.$$.fragment,a),m(r.$$.fragment,a),s=!0)},o(a){_(e.$$.fragment,a),_(r.$$.fragment,a),s=!1},d(a){a&&y(t),w(e,a),w(r,a)}}}function Mr(i){let e,t,r,s,n,o,a;return t=new yn({props:{question:i[8]}}),n=new Q({props:{$$slots:{default:[hl]},$$scope:{ctx:i}}}),{c(){e=O("div"),v(t.$$.fragment),r=E(),s=O("div"),v(n.$$.fragment),o=E(),C(s,"class","mt-2 flex justify-end")},m(l,u){k(l,e,u),b(t,e,null),S(e,r),S(e,s),b(n,s,null),S(e,o),a=!0},p(l,u){const f={};u&8&&(f.question=l[8]),t.$set(f);const h={};u&2056&&(h.$$scope={dirty:u,ctx:l}),n.$set(h)},i(l){a||(m(t.$$.fragment,l),m(n.$$.fragment,l),a=!0)},o(l){_(t.$$.fragment,l),_(n.$$.fragment,l),a=!1},d(l){l&&y(e),w(t),w(n)}}}function dl(i){let e,t,r,s;return e=new z({props:{onClick:i[6],label:"Cancel"}}),r=new z({props:{onClick:i[7],label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&4&&(a.onClick=n[6]),e.$set(a);const l={};o&1&&(l.onClick=n[7]),r.$set(l)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function pl(i){let e,t,r,s,n,o,a,l;e=new ie({props:{header:"List Chapters"}}),r=new Zt({props:{book:i[1],chapter:i[2]}});let u=ue(i[3]),f=[];for(let d=0;d<u.length;d+=1)f[d]=Mr(Fr(i,u,d));const h=d=>_(f[d],1,1,()=>{f[d]=null});return a=new Q({props:{$$slots:{default:[dl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment),s=E(),n=O("div");for(let d=0;d<f.length;d+=1)f[d].c();o=E(),v(a.$$.fragment),C(n,"class","flex flex-col gap-5")},m(d,c){b(e,d,c),k(d,t,c),b(r,d,c),k(d,s,c),k(d,n,c);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(n,null);k(d,o,c),b(a,d,c),l=!0},p(d,c){const p={};if(c&2&&(p.book=d[1]),c&4&&(p.chapter=d[2]),r.$set(p),c&8){u=ue(d[3]);let $;for($=0;$<u.length;$+=1){const T=Fr(d,u,$);f[$]?(f[$].p(T,c),m(f[$],1)):(f[$]=Mr(T),f[$].c(),m(f[$],1),f[$].m(n,null))}for(Y(),$=u.length;$<f.length;$+=1)h($);X()}const g={};c&2053&&(g.$$scope={dirty:c,ctx:d}),a.$set(g)},i(d){if(!l){m(e.$$.fragment,d),m(r.$$.fragment,d);for(let c=0;c<u.length;c+=1)m(f[c]);m(a.$$.fragment,d),l=!0}},o(d){_(e.$$.fragment,d),_(r.$$.fragment,d),f=f.filter(Boolean);for(let c=0;c<f.length;c+=1)_(f[c]);_(a.$$.fragment,d),l=!1},d(d){d&&(y(t),y(s),y(n),y(o)),w(e,d),w(r,d),Ge(f,d),w(a,d)}}}function ml(i){let e,t;return e=new oe({props:{$$slots:{default:[pl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&2063&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function _l(i,e,t){let{params:r={id:0}}=e,s,n,o=[];he(async()=>{t(2,n=await Yt(r.id)),n&&(t(3,o=await vt(n.id)),t(1,s=await gt(n.book_id)))});const a=h=>J("/questions/update/"+h.id),l=async h=>{t(3,o=await al(h.id,h.chapter_id))},u=()=>J("/chapters/list/"+(n==null?void 0:n.book_id)),f=()=>J("/questions/create/"+r.id);return i.$$set=h=>{"params"in h&&t(0,r=h.params)},[r,s,n,o,a,l,u,f]}class gl extends B{constructor(e){super(),q(this,e,_l,ml,N,{params:0})}}function zr(i){let e,t,r=i[0].id+"",s,n,o,a=re(i[0].modified)+"",l,u,f,h;return f=new de({props:{onSubmit:i[5],$$slots:{default:[bl]},$$scope:{ctx:i}}}),{c(){e=O("div"),t=O("span"),s=R(r),n=E(),o=O("span"),l=R(a),u=E(),v(f.$$.fragment),C(e,"class","mb-4 text-small")},m(d,c){k(d,e,c),S(e,t),S(t,s),S(e,n),S(e,o),S(o,l),k(d,u,c),b(f,d,c),h=!0},p(d,c){(!h||c&1)&&r!==(r=d[0].id+"")&&U(s,r),(!h||c&1)&&a!==(a=re(d[0].modified)+"")&&U(l,a);const p={};c&1055&&(p.$$scope={dirty:c,ctx:d}),f.$set(p)},i(d){h||(m(f.$$.fragment,d),h=!0)},o(d){_(f.$$.fragment,d),h=!1},d(d){d&&(y(e),y(u)),w(f,d)}}}function $l(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Update"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[9]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function bl(i){let e,t,r,s,n,o,a,l;function u(c){i[7](c)}let f={id:"question",label:"Questione",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new be({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[8](c)}let d={id:"answer",label:"Answer",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new be({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[$l]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&4&&(g.error=c[2]),!t&&p&2&&(t=!0,g.value=c[1],ee(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=c[4]),!n&&p&8&&(n=!0,$.value=c[3],ee(()=>n=!1)),s.$set($);const T={};p&1025&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function wl(i){let e,t,r,s;e=new ie({props:{header:"Update Book"}});let n=i[0]&&zr(i);return{c(){v(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){b(e,o,a),k(o,t,a),n&&n.m(o,a),k(o,r,a),s=!0},p(o,a){o[0]?n?(n.p(o,a),a&1&&m(n,1)):(n=zr(o),n.c(),m(n,1),n.m(r.parentNode,r)):n&&(Y(),_(n,1,1,()=>{n=null}),X())},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(y(t),y(r)),w(e,o),n&&n.d(o)}}}function vl(i){let e,t;return e=new oe({props:{$$slots:{default:[wl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1055&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function yl(i,e,t){let{params:r={id:""}}=e,s=null,n="",o="",a="",l="";const u=async()=>{if(t(2,o=ne(n)),t(4,l=ne(a)),!(o||l)){if(!s){G.setString("No question!!");return}await ul(s.id,s.chapter_id,n,a),J("/questions/list/"+s.chapter_id)}};he(async()=>{t(0,s=await ol(parseInt(r.id))),s&&(t(1,n=s.question),t(3,a=s.answer))});function f(c){n=c,t(1,n)}function h(c){a=c,t(3,a)}const d=()=>J("/questions/list/"+(s==null?void 0:s.chapter_id));return i.$$set=c=>{"params"in c&&t(6,r=c.params)},[s,n,o,a,l,u,r,f,h,d]}class kl extends B{constructor(e){super(),q(this,e,yl,vl,N,{params:6})}}function Sl(i){let e,t,r,s;return e=new z({props:{onClick:i[8],label:"Cancel"}}),r=new z({props:{label:"Create"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&1&&(a.onClick=n[8]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function El(i){let e,t,r,s,n,o,a,l;function u(c){i[6](c)}let f={id:"question",label:"Question",error:i[2]};i[1]!==void 0&&(f.value=i[1]),e=new be({props:f}),Z.push(()=>te(e,"value",u));function h(c){i[7](c)}let d={id:"answer",label:"Answer",error:i[4]};return i[3]!==void 0&&(d.value=i[3]),s=new be({props:d}),Z.push(()=>te(s,"value",h)),a=new Q({props:{$$slots:{default:[Sl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment),o=E(),v(a.$$.fragment)},m(c,p){b(e,c,p),k(c,r,p),b(s,c,p),k(c,o,p),b(a,c,p),l=!0},p(c,p){const g={};p&4&&(g.error=c[2]),!t&&p&2&&(t=!0,g.value=c[1],ee(()=>t=!1)),e.$set(g);const $={};p&16&&($.error=c[4]),!n&&p&8&&(n=!0,$.value=c[3],ee(()=>n=!1)),s.$set($);const T={};p&513&&(T.$$scope={dirty:p,ctx:c}),a.$set(T)},i(c){l||(m(e.$$.fragment,c),m(s.$$.fragment,c),m(a.$$.fragment,c),l=!0)},o(c){_(e.$$.fragment,c),_(s.$$.fragment,c),_(a.$$.fragment,c),l=!1},d(c){c&&(y(r),y(o)),w(e,c),w(s,c),w(a,c)}}}function Cl(i){let e,t,r,s;return e=new ie({props:{header:"Create Question"}}),r=new de({props:{onSubmit:i[5],$$slots:{default:[El]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&543&&(a.$$scope={dirty:o,ctx:n}),r.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Ol(i){let e,t;return e=new oe({props:{$$slots:{default:[Cl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&543&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Tl(i,e,t){let{params:r={chapter_id:0}}=e,s="",n="",o="",a="";const l=async()=>{t(2,n=ne(s)),t(4,a=ne(o)),!(n||a)&&(await ll(r.chapter_id,s,o),J("/questions/list/"+r.chapter_id))};function u(d){s=d,t(1,s)}function f(d){o=d,t(3,o)}const h=()=>J("/questions/list/"+r.chapter_id);return i.$$set=d=>{"params"in d&&t(0,r=d.params)},[r,s,n,o,a,l,u,f,h]}class Al extends B{constructor(e){super(),q(this,e,Tl,Ol,N,{params:0})}}function Hr(i,e,t){const r=i.slice();return r[6]=e[t],r}function Jr(i){let e,t=i[6]+"",r,s,n;return{c(){e=O("option"),r=R(t),e.__value=s=i[6],ze(e,e.__value),e.selected=n=i[6]===i[0]},m(o,a){k(o,e,a),S(e,r)},p(o,a){a&8&&t!==(t=o[6]+"")&&U(r,t),a&8&&s!==(s=o[6])&&(e.__value=s,ze(e,e.__value)),a&9&&n!==(n=o[6]===o[0])&&(e.selected=n)},d(o){o&&y(e)}}}function jl(i){let e,t,r,s=ue(i[3]),n=[];for(let o=0;o<s.length;o+=1)n[o]=Jr(Hr(i,s,o));return{c(){e=O("select");for(let o=0;o<n.length;o+=1)n[o].c();C(e,"id",i[2]),C(e,"name",i[2]),C(e,"class","input"),i[0]===void 0&&ft(()=>i[5].call(e))},m(o,a){k(o,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);er(e,i[0],!0),t||(r=Pe(e,"change",i[5]),t=!0)},p(o,a){if(a&9){s=ue(o[3]);let l;for(l=0;l<s.length;l+=1){const u=Hr(o,s,l);n[l]?n[l].p(u,a):(n[l]=Jr(u),n[l].c(),n[l].m(e,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=s.length}a&4&&C(e,"id",o[2]),a&4&&C(e,"name",o[2]),a&9&&er(e,o[0])},d(o){o&&y(e),Ge(n,o),t=!1,r()}}}function Pl(i){let e,t;return e=new Gt({props:{id:i[2],label:i[1],error:i[4],$$slots:{default:[jl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&4&&(n.id=r[2]),s&2&&(n.label=r[1]),s&16&&(n.error=r[4]),s&525&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Il(i,e,t){let{label:r}=e,{id:s}=e,{value:n}=e,{options:o}=e,{error:a}=e;function l(){n=An(this),t(0,n),t(3,o)}return i.$$set=u=>{"label"in u&&t(1,r=u.label),"id"in u&&t(2,s=u.id),"value"in u&&t(0,n=u.value),"options"in u&&t(3,o=u.options),"error"in u&&t(4,a=u.error)},[n,r,s,o,a,l]}class Rl extends B{constructor(e){super(),q(this,e,Il,Pl,N,{label:1,id:2,value:0,options:3,error:4})}}function Kr(i){let e,t,r=i[2].length+"",s;return{c(){e=O("div"),t=R("Length: "),s=R(r)},m(n,o){k(n,e,o),S(e,t),S(e,s)},p(n,o){o&4&&r!==(r=n[2].length+"")&&U(s,r)},d(n){n&&y(e)}}}function Ll(i){let e,t,r,s;return e=new z({props:{onClick:i[9],label:"Cancel"}}),r=new z({props:{label:"Start"}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment)},m(n,o){b(e,n,o),k(n,t,o),b(r,n,o),s=!0},p(n,o){const a={};o&2&&(a.onClick=n[9]),e.$set(a)},i(n){s||(m(e.$$.fragment,n),m(r.$$.fragment,n),s=!0)},o(n){_(e.$$.fragment,n),_(r.$$.fragment,n),s=!1},d(n){n&&y(t),w(e,n),w(r,n)}}}function Dl(i){let e,t,r,s,n;function o(l){i[8](l)}let a={id:"correct",label:"Correct Answers",options:i[5],error:i[4]};return i[3]!==void 0&&(a.value=i[3]),e=new Rl({props:a}),Z.push(()=>te(e,"value",o)),s=new Q({props:{$$slots:{default:[Ll]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),r=E(),v(s.$$.fragment)},m(l,u){b(e,l,u),k(l,r,u),b(s,l,u),n=!0},p(l,u){const f={};!t&&u&8&&(t=!0,f.value=l[3],ee(()=>t=!1)),e.$set(f);const h={};u&1026&&(h.$$scope={dirty:u,ctx:l}),s.$set(h)},i(l){n||(m(e.$$.fragment,l),m(s.$$.fragment,l),n=!0)},o(l){_(e.$$.fragment,l),_(s.$$.fragment,l),n=!1},d(l){l&&y(r),w(e,l),w(s,l)}}}function Ul(i){let e,t,r,s,n,o,a;e=new ie({props:{header:"List Chapters"}}),r=new Zt({props:{book:i[0],chapter:i[1]}});let l=i[1]&&Kr(i);return o=new de({props:{onSubmit:i[6],$$slots:{default:[Dl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment),s=E(),l&&l.c(),n=E(),v(o.$$.fragment)},m(u,f){b(e,u,f),k(u,t,f),b(r,u,f),k(u,s,f),l&&l.m(u,f),k(u,n,f),b(o,u,f),a=!0},p(u,f){const h={};f&1&&(h.book=u[0]),f&2&&(h.chapter=u[1]),r.$set(h),u[1]?l?l.p(u,f):(l=Kr(u),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null);const d={};f&1034&&(d.$$scope={dirty:f,ctx:u}),o.$set(d)},i(u){a||(m(e.$$.fragment,u),m(r.$$.fragment,u),m(o.$$.fragment,u),a=!0)},o(u){_(e.$$.fragment,u),_(r.$$.fragment,u),_(o.$$.fragment,u),a=!1},d(u){u&&(y(t),y(s),y(n)),w(e,u),w(r,u),l&&l.d(u),w(o,u)}}}function Nl(i){let e,t;return e=new oe({props:{$$slots:{default:[Ul]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&1039&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function ql(i,e,t){let{params:r={id:0}}=e,s,n,o=[],a="1",l,u=["0","1","2","3"];he(async()=>{t(1,n=await Yt(r.id)),n&&(t(2,o=await vt(n.id)),t(0,s=await gt(n.book_id)))});const f=async()=>{ko(o,parseInt(a)),J("/lession/process")};function h(c){a=c,t(3,a)}const d=()=>J("/chapters/list/"+(n==null?void 0:n.book_id));return i.$$set=c=>{"params"in c&&t(7,r=c.params)},[s,n,o,a,l,u,f,r,h,d]}class Bl extends B{constructor(e){super(),q(this,e,ql,Nl,N,{params:7})}}function Fl(i){let e,t;return e=new yn({props:{question:i[0].question,showAnswer:i[2],progress:i[0].progress}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,s){const n={};s&1&&(n.question=r[0].question),s&4&&(n.showAnswer=r[2]),s&1&&(n.progress=r[0].progress),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ml(i){let e;return{c(){e=O("p"),e.textContent="End"},m(t,r){k(t,e,r)},p:L,i:L,o:L,d(t){t&&y(e)}}}function Gr(i){let e,t,r=i[0]&&Wr(i);return{c(){r&&r.c(),e=se()},m(s,n){r&&r.m(s,n),k(s,e,n),t=!0},p(s,n){s[0]?r?(r.p(s,n),n&1&&m(r,1)):(r=Wr(s),r.c(),m(r,1),r.m(e.parentNode,e)):r&&(Y(),_(r,1,1,()=>{r=null}),X())},i(s){t||(m(r),t=!0)},o(s){_(r),t=!1},d(s){s&&y(e),r&&r.d(s)}}}function Wr(i){let e,t,r,s;const n=[Hl,zl],o=[];function a(l,u){return l[2]?1:0}return e=a(i),t=o[e]=n[e](i),{c(){t.c(),r=se()},m(l,u){o[e].m(l,u),k(l,r,u),s=!0},p(l,u){let f=e;e=a(l),e===f?o[e].p(l,u):(Y(),_(o[f],1,1,()=>{o[f]=null}),X(),t=o[e],t?t.p(l,u):(t=o[e]=n[e](l),t.c()),m(t,1),t.m(r.parentNode,r))},i(l){s||(m(t),s=!0)},o(l){_(t),s=!1},d(l){l&&y(r),o[e].d(l)}}}function zl(i){let e,t,r,s,n,o,a,l;return e=new z({props:{label:"Correct",onClick:i[4]}}),r=new z({props:{label:"Wrong",onClick:i[5]}}),n=new z({props:{label:"Learned",onClick:i[6]}}),a=new z({props:{label:"Skip",onClick:i[7]}}),{c(){v(e.$$.fragment),t=E(),v(r.$$.fragment),s=E(),v(n.$$.fragment),o=E(),v(a.$$.fragment)},m(u,f){b(e,u,f),k(u,t,f),b(r,u,f),k(u,s,f),b(n,u,f),k(u,o,f),b(a,u,f),l=!0},p:L,i(u){l||(m(e.$$.fragment,u),m(r.$$.fragment,u),m(n.$$.fragment,u),m(a.$$.fragment,u),l=!0)},o(u){_(e.$$.fragment,u),_(r.$$.fragment,u),_(n.$$.fragment,u),_(a.$$.fragment,u),l=!1},d(u){u&&(y(t),y(s),y(o)),w(e,u),w(r,u),w(n,u),w(a,u)}}}function Hl(i){let e,t;return e=new z({props:{label:"Show",onClick:i[3]}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p:L,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Jl(i){let e,t,r,s;e=new z({props:{label:"Cancel",onClick:i[8]}});let n=!i[1]&&Gr(i);return{c(){v(e.$$.fragment),t=E(),n&&n.c(),r=se()},m(o,a){b(e,o,a),k(o,t,a),n&&n.m(o,a),k(o,r,a),s=!0},p(o,a){o[1]?n&&(Y(),_(n,1,1,()=>{n=null}),X()):n?(n.p(o,a),a&2&&m(n,1)):(n=Gr(o),n.c(),m(n,1),n.m(r.parentNode,r))},i(o){s||(m(e.$$.fragment,o),m(n),s=!0)},o(o){_(e.$$.fragment,o),_(n),s=!1},d(o){o&&(y(t),y(r)),w(e,o),n&&n.d(o)}}}function Kl(i){let e,t,r,s,n,o,a;e=new ie({props:{header:"Lession"}});const l=[Ml,Fl],u=[];function f(h,d){return h[1]?0:h[0]?1:-1}return~(r=f(i))&&(s=u[r]=l[r](i)),o=new Q({props:{$$slots:{default:[Jl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment),t=E(),s&&s.c(),n=E(),v(o.$$.fragment)},m(h,d){b(e,h,d),k(h,t,d),~r&&u[r].m(h,d),k(h,n,d),b(o,h,d),a=!0},p(h,d){let c=r;r=f(h),r===c?~r&&u[r].p(h,d):(s&&(Y(),_(u[c],1,1,()=>{u[c]=null}),X()),~r?(s=u[r],s?s.p(h,d):(s=u[r]=l[r](h),s.c()),m(s,1),s.m(n.parentNode,n)):s=null);const p={};d&4103&&(p.$$scope={dirty:d,ctx:h}),o.$set(p)},i(h){a||(m(e.$$.fragment,h),m(s),m(o.$$.fragment,h),a=!0)},o(h){_(e.$$.fragment,h),_(s),_(o.$$.fragment,h),a=!1},d(h){h&&(y(t),y(n)),w(e,h),~r&&u[r].d(h),w(o,h)}}}function Gl(i){let e,t;return e=new oe({props:{$$slots:{default:[Kl]},$$scope:{ctx:i}}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,[s]){const n={};s&4103&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Wl(i,e,t){let r,s,n=!1,o=!1;const a=()=>{t(2,o=!0)},l=()=>{if(s.progress<3&&r.push(s),!So(r)){t(1,n=!0);return}p()},u=()=>{t(0,s.progress++,s),l()},f=()=>{t(0,s.progress=0,s),l()},h=()=>{t(0,s.progress=3,s),l()},d=()=>{l()},c=()=>{J("/")},p=()=>{const g=r.shift();g?(t(0,s=g),t(2,o=!1)):t(1,n=!0)};return he(()=>{const g=bn();if(!g){G.setString("No lession found!");return}r=g,p()}),[s,n,o,a,u,f,h,d,c]}class Vl extends B{constructor(e){super(),q(this,e,Wl,Gl,N,{})}}function Vr(i){let e,t;return e=new wo({props:{error:i[0]}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p(r,s){const n={};s&1&&(n.error=r[0]),e.$set(n)},i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Ql(i){let e,t;return e=new Jn({props:{routes:i[1]}}),{c(){v(e.$$.fragment)},m(r,s){b(e,r,s),t=!0},p:L,i(r){t||(m(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){w(e,r)}}}function Yl(i){let e,t,r,s,n=i[0]!==null&&Vr(i);return r=new _o({props:{navEntries:i[2],$$slots:{default:[Ql]},$$scope:{ctx:i}}}),{c(){e=O("main"),n&&n.c(),t=E(),v(r.$$.fragment),C(e,"class","text-gray-600 max-w-screen-lg m-auto mt-4")},m(o,a){k(o,e,a),n&&n.m(e,null),S(e,t),b(r,e,null),s=!0},p(o,[a]){o[0]!==null?n?(n.p(o,a),a&1&&m(n,1)):(n=Vr(o),n.c(),m(n,1),n.m(e,t)):n&&(Y(),_(n,1,1,()=>{n=null}),X());const l={};a&8&&(l.$$scope={dirty:a,ctx:o}),r.$set(l)},i(o){s||(m(n),m(r.$$.fragment,o),s=!0)},o(o){_(n),_(r.$$.fragment,o),s=!1},d(o){o&&y(e),n&&n.d(),w(r)}}}function Xl(i,e,t){let r;return Cn(i,G,o=>t(0,r=o)),[r,{"/":Io,"/books/list":fa,"/books/create":wa,"/books/update/:id":Ca,"/chapters/list/:id":Ga,"/chapters/create/:book_id":Za,"/chapters/update/:id":sl,"/questions/list/:id":gl,"/questions/create/:chapter_id":Al,"/questions/update/:id":kl,"/lession/prepare/:id":Bl,"/lession/process":Vl,"/cache":zo,"*":Ko},[{label:"Home",path:"#/"},{label:"Books",path:"#/books/list"},{label:"Cache",path:"#/cache"}]]}class Zl extends B{constructor(e){super(),q(this,e,Xl,Yl,N,{})}}new Zl({target:document.getElementById("app")});
